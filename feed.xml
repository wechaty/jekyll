<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://wechaty.js.org/feed.xml" rel="self" type="application/atom+xml" /><link href="https://wechaty.js.org/" rel="alternate" type="text/html" /><updated>2025-12-21T19:18:39+00:00</updated><id>https://wechaty.js.org/feed.xml</id><title type="html">Wechaty</title><subtitle>Conversational RPA SDK for Chatbot Makers</subtitle><entry><title type="html">The Antigravity Effect: When Coding Becomes Orchestration</title><link href="https://wechaty.js.org/2025/11/25/the-antigravity-effect-when-coding-becomes-orchestration/" rel="alternate" type="text/html" title="The Antigravity Effect: When Coding Becomes Orchestration" /><published>2025-11-25T00:00:00+00:00</published><updated>2025-11-25T00:00:00+00:00</updated><id>https://wechaty.js.org/2025/11/25/the-antigravity-effect-when-coding-becomes-orchestration</id><content type="html" xml:base="https://wechaty.js.org/2025/11/25/the-antigravity-effect-when-coding-becomes-orchestration/"><![CDATA[<blockquote>
  <p>As an internal tester for <strong>Google Antigravity</strong>, Iâ€™ve had a front-row seat to the single biggest step-change in software development since the original IDE. But this isnâ€™t just about faster coding. Itâ€™s about <strong>scaling yourself</strong>.</p>
</blockquote>

<p>Iâ€™ve been biting my tongue for weeks.</p>

<p>For solo founders and non-technical creators, the dream has always been to build a â€œunicornâ€ product without needing a unicorn team. We are finally there.</p>

<p>We are witnessing a fundamental shift: from <strong>coding</strong> to <strong>orchestrating</strong>.</p>

<p>Antigravity isnâ€™t just an editor; itâ€™s an <strong>Operating System for Artificial Intelligence</strong>. But more importantly, it gives you something money canâ€™t easily buy: an instant, world-class founding team.</p>

<h2 id="meet-your-new-ai-co-founder-team">Meet Your New AI Co-Founder Team</h2>

<p>When you open Antigravity, you arenâ€™t just opening an IDE. You are walking into a room with three high-powered executives ready to work for you 24/7:</p>

<ol>
  <li><strong>The CTO (Gemini 3 Pro)</strong>: Your AI coding agent co-founder. It knows every framework, refactors legacy code in seconds, and architects scalable systems while you sleep.</li>
  <li><strong>The Design Director (Nano Banana Pro)</strong>: Your creative visionary. It generates premium UI assets, icons, and entire design systems on the fly, ensuring your product looks like a million bucks from Day 1.</li>
  <li><strong>The Testing Director (Browser Use)</strong>: Your QA lead. It doesnâ€™t just run unit tests; it launches a real browser, clicks buttons, fills forms, and verifies user flows exactly like a human would.</li>
</ol>

<p>This is a powerful team for anyone who wants to build a one-person billion-dollar company! This team is more completeâ€”and fasterâ€”than most of the founding teams applying to YC today.</p>

<p>With this team, you unlock a new era of development <strong>Vibe Coding</strong>.</p>

<p><strong>What is Vibe Coding?</strong></p>

<blockquote>
  <p><strong>Vibe Coding</strong> <em>(n.)</em>: The state of flow where you focus purely on architecture and creativity, while your autonomous executive team handles the implementation, design, and testing in parallel.</p>
</blockquote>

<p>If youâ€™re a solo founder, prepare to become a full-stack organization overnight.</p>

<hr />

<p><img src="/assets/2025/11-the-antigravity-effect-when-coding-becomes-orchestration/header-final.webp" alt="Mission Control" /></p>

<h2 id="1-the-cto-at-work-your-new-mission-control-">1. The CTO at Work: Your New Mission Control ğŸ§‘â€ğŸš€</h2>

<p>Weâ€™ve all been there: you have a brilliant idea, but youâ€™re stuck on a React hook, or youâ€™re waiting for a freelancer to fix a CSS bug. Itâ€™s synchronous, slow, and kills your momentum.</p>

<p>Antigravity solves this by giving you a <strong>CTO</strong> that works in parallel with you. The workspace is separated into two distinct, powerful surfaces:</p>

<ul>
  <li><strong>The Editor:</strong> Your familiar canvas for synchronous workâ€”fixing typos, tweaking UI, committing small changes.</li>
  <li><strong>The Agent Manager:</strong> Your Mission Control where your CTO operates.</li>
</ul>

<p>This is the <strong>â€œAhaâ€ Moment</strong> for founders. You can spawn a high-priority agent to â€œResearch and implement OAuth for the APIâ€ in the Manager. While your CTO is planning, fetching dependencies, and writing the code in the background, you can be in the Editor polishing the landing page text.</p>

<p>This parallel agent mode is what truly separates Antigravity from everything else. You are no longer just a coder; you are a <strong>Technical Director</strong> managing a brilliant CTO.</p>

<blockquote>
  <p>ğŸ’¡ <strong>Cross-Reference:</strong> Unlike CLI-based agents like Gemini CLI or Claude Code, the Manager surface gives you a visual dashboard of your CTOâ€™s internal thought process, or <strong>Artifacts</strong> (Task List, Implementation Plan, Walkthrough). You donâ€™t just see the code; you see the intelligence <em>planning</em> the code.</p>
</blockquote>

<hr />

<p><img src="/assets/2025/11-the-antigravity-effect-when-coding-becomes-orchestration/mission-control-focused.webp" alt="Focused Workflow" /></p>

<h2 id="2-the-testing-director-trust-dont-just-verify-">2. The Testing Director: Trust, Donâ€™t Just Verify ğŸ§ª</h2>

<p>For solo founders, the biggest barrier isnâ€™t writing codeâ€”itâ€™s <strong>testing</strong> and <strong>validation</strong>. How do you know the code works without spending hours setting up a test suite or clicking through the UI?</p>

<p>Enter your <strong>Testing Director</strong>.</p>

<p>Antigravityâ€™s <strong>native browser integration</strong> is the killer feature. Your Testing Director isnâ€™t just generating files; it has its own embedded Chrome instance. It doesnâ€™t just <em>say</em> it fixed a bug; you watch its cursor navigate the page, click the buttons, and verify the outcome against the original request.</p>

<p>The AI becomes your integrated QA department. This means less friction, less fear of deploying, and a faster path from idea to revenue.</p>

<hr />

<p><img src="/assets/2025/11-the-antigravity-effect-when-coding-becomes-orchestration/mission-control-holographic.webp" alt="Holographic Design" /></p>

<h2 id="3-the-design-director-nano-banana-pro-">3. The Design Director: Nano Banana Pro âœ¨</h2>

<p>For too long, the design layer and the coding layer have been separate worlds. We build the architecture, then we stop, switch to a design tool, hire a designer, or settle for â€œLorem Ipsumâ€ images.</p>

<p>Antigravity natively integrates <strong>Nano Banana Pro</strong>â€”your new <strong>Design Director</strong>â€”directly into the development workflow. This is a game-changer that we must treat with serious reverence.</p>

<p>Need a hero image that perfectly matches your appâ€™s new color scheme? Need a set of 50 icons? Ask the agent, and your Design Director delivers high-fidelity assets instantly, right into your project folder. You can even generate entire UI mockups and diagrams, then ask the CTO (the coding agent) to turn them into React components.</p>

<p>This means your <strong>Vibe Coding</strong> process is now truly end-to-endâ€”you can design and build without breaking flow.</p>

<hr />

<h2 id="4-the-monster-within-gemini-3-pro-and-openness-">4. The Monster Within: Gemini 3 Pro and Openness ğŸ¤¯</h2>

<p>At its core, Antigravity is a platform, and its power is rooted in the â€œmonsterâ€ models it orchestrates.</p>

<p><strong>Gemini 3 Pro</strong>â€”the brain behind your CTOâ€”sets a new standard for code understanding, complex dependency management, and multi-step planning. You can even choose the specific â€œbrainâ€ for the task, toggling between <strong>Gemini 3 Pro (High)</strong> for complex reasoning or lighter models for speed.</p>

<p>But what I love most is the platformâ€™s commitment to openness. Antigravity doesnâ€™t lock you in. You can also run powerful autonomous agents powered by:</p>

<ul>
  <li><strong>Claude Sonnet 4.5</strong></li>
  <li><strong>GPT-OSS</strong> (Open Source Specialist)</li>
</ul>

<p>This model optionality ensures Antigravity remains the most powerful and flexible coding environment for years to come.</p>

<hr />

<h2 id="5-critical-take-the-ui-needs-to-catch-up-ï¸">5. Critical Take: The UI Needs to Catch Up âš ï¸</h2>

<p>I love this tool, but I have to be honest: the UI naming conventions are confusing and, frankly, need a rethink.</p>

<p>Antigravity presents you with two main modes: <strong>Planning</strong> and <strong>Fast</strong>.
To a human, â€œPlanningâ€ implies a passive stateâ€”drafting a roadmap, discussing architecture, or thinking without acting. In other agents like Claude Code, â€œPlanâ€ mode is exactly that: a safe space for discussion.</p>

<p><strong>In Antigravity, â€œPlanningâ€ is a misnomer.</strong> It should be called <strong>â€œArchitect &amp; Executeâ€</strong>.</p>

<p>When you are in Planning mode, the agent isnâ€™t just taking notes. It is actively researching, checking files, andâ€”here is the critical bugâ€”sometimes it just <strong>starts executing code</strong> without waiting for your final â€œgo.â€ Iâ€™ve had moments where I thought we were just brainstorming a implementation design, and suddenly the agent is running migration scripts. That is a â€œrogue agentâ€ behavior that needs better harnessing.</p>

<p>Similarly, <strong>â€œFastâ€</strong> mode is a poor name. It sounds like a performance setting, but it really means <strong>â€œDirect Executionâ€</strong> or <strong>â€œDoer Modeâ€</strong>.</p>

<p><strong>My advice:</strong> Ignore the labels.</p>

<ul>
  <li>Treat <strong>Planning</strong> as <strong>â€œThe Architectâ€</strong> (use for complex, multi-file tasks).</li>
  <li>Treat <strong>Fast</strong> as <strong>â€œThe Builderâ€</strong> (use for quick fixes and simple commands).</li>
</ul>

<p>The intelligence is there, but the controls are still in beta. You need to learn the quirks to master the machine.</p>

<hr />

<h2 id="watch-antigravity-in-action">Watch Antigravity in Action</h2>

<h3 id="introducing-google-antigravity">Introducing Google Antigravity</h3>

<div style="
    position: relative;
    padding-bottom: 56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
">
  <iframe src="https://www.youtube.com/embed/nTOVIGsqCuY" allowfullscreen="" webkitallowfullscreen="" frameborder="0" style="
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    ">
</iframe>

</div>

<hr />

<h3 id="nano-banana-pro-is-now-available-">Nano Banana Pro is Now Available |</h3>

<div style="
    position: relative;
    padding-bottom: 56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
">
  <iframe src="https://www.youtube.com/embed/FB6HO7CZHWw" allowfullscreen="" webkitallowfullscreen="" frameborder="0" style="
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    ">
</iframe>

</div>

<hr />

<h2 id="ready-to-experience-liftoff">Ready to Experience Liftoff?</h2>

<p>Antigravity isnâ€™t just an IDE upgrade; itâ€™s the future of software development. It enables developers to focus on architecture and problem-solving, while allowing solo founders and creators to build powerful products with a full executive team at their fingertips.</p>

<p>Download the public preview today. Spawn your first parallel agent, watch your Testing Director manage the browser, and let the monster loose. You will have your own <strong>â€œAhaâ€ Moment</strong> guaranteed.</p>

<h3 id="-join-the-revolution">ğŸš€ Join the Revolution</h3>

<p>Donâ€™t just watch the future happenâ€”build it.</p>

<ul>
  <li><strong><a href="https://antigravity.google">Download Antigravity Public Preview</a></strong></li>
  <li><strong><a href="https://discord.gg/antigravity">Join the Discord Community</a></strong></li>
</ul>

<p><em>Read the official announcements here:</em></p>

<ul>
  <li><a href="https://antigravity.google/blog/introducing-google-antigravity">Introducing Google Antigravity</a></li>
  <li><a href="https://antigravity.google/blog/nano-banana-pro-in-google-antigravity">Nano Banana Pro in Google Antigravity</a></li>
</ul>

<hr />

<h3 id="credits">Credits</h3>

<p>This blog post, including all its images, was drafted entirely with Antigravity.</p>

<p><img src="/assets/2025/11-the-antigravity-effect-when-coding-becomes-orchestration/antigravity-screenshot-32x9.webp" alt="Antigravity" /></p>

<p>May this demonstration of Antigravityâ€™s capabilities ignite your imagination, showing you the boundless potential of orchestrating your vision, from code to content, with your AI co-founders, who can even serve as your Content Marketing Director.</p>]]></content><author><name>huan</name></author><category term="tools" /><category term="antigravity" /><category term="gemini" /><category term="ai" /><category term="vibe-coding" /><summary type="html"><![CDATA[As an internal tester for Google Antigravity, Iâ€™ve had a front-row seat to the single biggest step-change in software development since the original IDE. But this isnâ€™t just about faster coding. Itâ€™s about scaling yourself.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2025/11-the-antigravity-effect-when-coding-becomes-orchestration/mission-control-detailed.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2025/11-the-antigravity-effect-when-coding-becomes-orchestration/mission-control-detailed.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Breaking the Reverse Engineering Barrier: How LLMs and Frida Are Revolutionizing WeChat Analysis</title><link href="https://wechaty.js.org/2025/08/12/ai-powered-reverse-engineering-concept/" rel="alternate" type="text/html" title="Breaking the Reverse Engineering Barrier: How LLMs and Frida Are Revolutionizing WeChat Analysis" /><published>2025-08-12T00:00:00+00:00</published><updated>2025-08-12T00:00:00+00:00</updated><id>https://wechaty.js.org/2025/08/12/ai-powered-reverse-engineering-concept</id><content type="html" xml:base="https://wechaty.js.org/2025/08/12/ai-powered-reverse-engineering-concept/"><![CDATA[<blockquote>
  <p>A deep dive into building an AI-powered reverse engineering agent that automatically locates and hooks WeChatâ€™s message handling functions</p>
</blockquote>

<h2 id="the-challenge-that-started-it-all">The Challenge That Started It All</h2>

<p>It was 3 AM, and I was staring at yet another hexdump of WeChat.exe, trying to locate the <code class="language-plaintext highlighter-rouge">onMessage()</code> function that had moved (again) in the latest update. As a security researcher working on understanding WeChatâ€™s communication protocols, I faced this frustrating routine every few weeks. Each WeChat update would shuffle function addresses, change calling conventions, and sometimes even inline critical functions, making my carefully crafted hooks useless.</p>

<p>The traditional approach was painfully manual:</p>

<ol>
  <li><strong>Static Analysis</strong>: Hours spent in IDA Pro or Ghidra, hunting for string references</li>
  <li><strong>Pattern Matching</strong>: Manually comparing assembly code between versions</li>
  <li><strong>Trial and Error</strong>: Testing dozens of potential function candidates</li>
  <li><strong>Hook Development</strong>: Writing custom Frida scripts for each version</li>
</ol>

<p>This process could take days for a single function, and with WeChatâ€™s frequent updates, it felt like digital Sisyphus â€” pushing the boulder up the mountain, only to watch it roll back down with each release.</p>

<p>Thatâ€™s when I realized: <strong>What if we could teach an AI to do this automatically?</strong></p>

<h2 id="the-dawn-of-ai-powered-reverse-engineering">The Dawn of AI-Powered Reverse Engineering</h2>

<p>The convergence of several breakthrough technologies in 2024-2025 created an unprecedented opportunity:</p>

<h3 id="-large-language-models-revolution">ğŸ§  <strong>Large Language Models Revolution</strong></h3>

<p>Modern LLMs like GPT-5, Claude Sonnet 4, and specialized models like LLM4Decompile have achieved remarkable capabilities in understanding assembly code. Recent research shows that LLM4Decompile can achieve up to 21% accurate decompilation rate, significantly outperforming GPT-4 on assembly analysis tasks.</p>

<h3 id="-fridas-dynamic-instrumentation-power">ğŸ” <strong>Fridaâ€™s Dynamic Instrumentation Power</strong></h3>

<p>Frida enables real-time memory analysis, function hooking, and code injection â€” providing the â€œeyes and handsâ€ to interact with running processes.</p>

<h3 id="-model-context-protocol-mcp-integration">ğŸ”— <strong>Model Context Protocol (MCP) Integration</strong></h3>

<p>MCP standardizes how AI systems interact with external tools, allowing seamless integration between LLMs and dynamic analysis frameworks.</p>

<p><strong>The Vision</strong>: Combine these technologies to create a self-evolving reverse engineering system where:</p>

<ul>
  <li><strong>Frida</strong> provides real-time process observation</li>
  <li><strong>LLMs</strong> provide intelligent pattern recognition and decision making</li>
  <li><strong>MCP</strong> provides the communication layer between them</li>
</ul>

<h2 id="exploring-the-technical-landscape">Exploring the Technical Landscape</h2>

<p>Before diving into our solution, letâ€™s examine the current state of AI-assisted reverse engineering:</p>

<h3 id="existing-approaches-and-their-limitations">Existing Approaches and Their Limitations</h3>

<p><strong>Traditional Static Analysis Tools:</strong></p>

<ul>
  <li>IDA Pro, Ghidra, Binary Ninja â€” powerful but require extensive manual analysis</li>
  <li>Limited cross-version adaptation capabilities</li>
  <li>No real-time learning from dynamic behavior</li>
</ul>

<p><strong>Recent AI-Powered Tools:</strong></p>

<ul>
  <li><strong>Binary Ninja Sidekick</strong>: AI-powered plugin with structure recovery</li>
  <li><strong>ReverserAI</strong>: Local LLM for reverse engineering tasks</li>
  <li><strong>LLM4Decompile</strong>: Specialized models for binary decompilation</li>
</ul>

<p><strong>The Gap</strong>: None of these solutions provide <strong>automated, cross-version function location with real-time validation</strong> for specific applications like WeChat.</p>

<h3 id="why-wechat-presents-unique-challenges">Why WeChat Presents Unique Challenges</h3>

<p>WeChat.exe is particularly challenging for reverse engineering because:</p>

<ol>
  <li><strong>Frequent Updates</strong>: Monthly releases with significant binary changes</li>
  <li><strong>Anti-Analysis Measures</strong>: Obfuscation and packing techniques</li>
  <li><strong>Complex Architecture</strong>: Multi-threaded message processing with intricate data structures</li>
  <li><strong>Version Variations</strong>: Different builds for different regions and features</li>
</ol>

<h2 id="our-revolutionary-solution-the-llm-frida-hybrid-agent">Our Revolutionary Solution: The LLM-Frida Hybrid Agent</h2>

<p>After months of research and experimentation, we developed a comprehensive solution that addresses these challenges through intelligent automation.</p>

<h3 id="architecture-overview">Architecture Overview</h3>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LLM Analysis      â”‚    â”‚   MCP Server         â”‚    â”‚   Frida Engine      â”‚
â”‚   Engine            â”‚â—„â”€â”€â–ºâ”‚   (TypeScript)       â”‚â—„â”€â”€â–ºâ”‚   (Dynamic Hooks)   â”‚
â”‚                     â”‚    â”‚                      â”‚    â”‚                     â”‚
â”‚ â€¢ Pattern Recognitionâ”‚    â”‚ â€¢ Tool Management    â”‚    â”‚ â€¢ Memory Analysis   â”‚
â”‚ â€¢ Function Matching â”‚    â”‚ â€¢ Resource Serving   â”‚    â”‚ â€¢ Hook Deployment   â”‚
â”‚ â€¢ Parameter Analysisâ”‚    â”‚ â€¢ Session Management â”‚    â”‚ â€¢ Real-time Data    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                           â”‚                           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   WeChat.exe         â”‚
                        â”‚   Target Process     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div></div>

<h3 id="core-components-deep-dive">Core Components Deep Dive</h3>

<p>Letâ€™s examine each component and its implementation:</p>

<h2 id="1-the-llm-analysis-engine">1. The LLM Analysis Engine</h2>

<p>The heart of our system is an advanced pattern recognition engine that leverages LLM capabilities for assembly analysis:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">LLMAnalysisEngine</span> <span class="p">{</span>
  <span class="k">private</span> <span class="nx">knownPatterns</span><span class="p">:</span> <span class="nb">Map</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Map</span><span class="p">();</span>
  
  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">initializeKnownPatterns</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="nf">initializeKnownPatterns</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// WeChat-specific message handling patterns</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">knownPatterns</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">message_handler</span><span class="dl">"</span><span class="p">,</span> <span class="s2">`
      Typical WeChat message handler patterns:
      1. Function prologue with stack frame setup
      2. Parameter validation (message struct, sender info, type)
      3. String comparisons for message type identification
      4. Call to logging/debugging functions
      5. Message processing logic
      6. Return value handling
    `</span><span class="p">);</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">knownPatterns</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">windows_calling_convention</span><span class="dl">"</span><span class="p">,</span> <span class="s2">`
      Windows x64 calling convention:
      - First 4 parameters: RCX, RDX, R8, R9
      - Additional parameters on stack
      - Return value in RAX
      - Caller cleanup
    `</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">analyzeAssemblyForMessageHandler</span><span class="p">(</span>
    <span class="nx">currentAssembly</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> 
    <span class="nx">previousVersionInfo</span><span class="p">?:</span> <span class="p">{</span> <span class="na">address</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">assembly</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}</span>
  <span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">FunctionMatch</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
    
    <span class="kd">const</span> <span class="nx">prompt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">buildAnalysisPrompt</span><span class="p">(</span><span class="nx">currentAssembly</span><span class="p">,</span> <span class="nx">previousVersionInfo</span><span class="p">);</span>
    
    <span class="c1">// Perform sophisticated pattern matching</span>
    <span class="kd">const</span> <span class="nx">matches</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">performPatternMatching</span><span class="p">(</span><span class="nx">currentAssembly</span><span class="p">,</span> <span class="nx">previousVersionInfo</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="nx">matches</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="nx">match</span> <span class="o">=&gt;</span> <span class="p">({</span>
      <span class="na">address</span><span class="p">:</span> <span class="nx">match</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
      <span class="na">confidence</span><span class="p">:</span> <span class="nx">match</span><span class="p">.</span><span class="nx">confidence</span><span class="p">,</span>
      <span class="na">reasoning</span><span class="p">:</span> <span class="nx">match</span><span class="p">.</span><span class="nx">reasoning</span><span class="p">,</span>
      <span class="na">disassembly</span><span class="p">:</span> <span class="nx">match</span><span class="p">.</span><span class="nx">disassembly</span><span class="p">,</span>
      <span class="na">parameters</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nf">extractParameters</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">disassembly</span><span class="p">)</span>
    <span class="p">}));</span>
  <span class="p">}</span>
</code></pre></div></div>

<p><strong>Key Innovation</strong>: The engine doesnâ€™t just look for generic patterns â€” it learns WeChat-specific behaviors and adapts to version changes using cross-version reference analysis.</p>

<h3 id="intelligent-pattern-matching-algorithm">Intelligent Pattern Matching Algorithm</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">async</span> <span class="nf">performPatternMatching</span><span class="p">(</span>
  <span class="nx">assembly</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> 
  <span class="nx">previousInfo</span><span class="p">?:</span> <span class="kr">any</span>
<span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nb">Array</span><span class="o">&lt;</span><span class="p">{</span><span class="na">address</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">confidence</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="na">reasoning</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">disassembly</span><span class="p">:</span> <span class="kr">string</span><span class="p">}</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
  
  <span class="kd">const</span> <span class="na">matches</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="p">{</span><span class="na">address</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">confidence</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="na">reasoning</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">disassembly</span><span class="p">:</span> <span class="kr">string</span><span class="p">}</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[];</span>
  
  <span class="c1">// Pattern 1: Function with message-related string references</span>
  <span class="kd">const</span> <span class="nx">messageStrings</span> <span class="o">=</span> <span class="nx">assembly</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/lea</span><span class="se">\s</span><span class="sr">+</span><span class="se">\w</span><span class="sr">+,</span><span class="se">\s</span><span class="sr">*</span><span class="se">\[</span><span class="sr">rip</span><span class="se">\+</span><span class="sr">0x</span><span class="se">[</span><span class="sr">0-9a-f</span><span class="se">]</span><span class="sr">+</span><span class="se">\]\s</span><span class="sr">*#.*</span><span class="se">(?:</span><span class="sr">message|msg|chat|recv</span><span class="se">)</span><span class="sr">/gi</span><span class="p">);</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">messageStrings</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">address</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">extractAddressFromPattern</span><span class="p">(</span><span class="nx">assembly</span><span class="p">,</span> <span class="nx">messageStrings</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="nx">matches</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span>
      <span class="nx">address</span><span class="p">,</span>
      <span class="na">confidence</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span>
      <span class="na">reasoning</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Function contains message-related string references and proper calling convention</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">disassembly</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nf">extractFunctionDisassembly</span><span class="p">(</span><span class="nx">assembly</span><span class="p">,</span> <span class="nx">address</span><span class="p">)</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// Pattern 2: Function with similar parameter structure to previous version</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">previousInfo</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">similarStructure</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">findSimilarParameterStructure</span><span class="p">(</span><span class="nx">assembly</span><span class="p">,</span> <span class="nx">previousInfo</span><span class="p">.</span><span class="nx">assembly</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">similarStructure</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">similarStructure</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">match</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">matches</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span>
          <span class="na">address</span><span class="p">:</span> <span class="nx">match</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
          <span class="na">confidence</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span>
          <span class="na">reasoning</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Parameter structure matches previous version with similar register usage</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">disassembly</span><span class="p">:</span> <span class="nx">match</span><span class="p">.</span><span class="nx">disassembly</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">matches</span><span class="p">.</span><span class="nf">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">confidence</span> <span class="o">-</span> <span class="nx">a</span><span class="p">.</span><span class="nx">confidence</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>The Magic</strong>: This algorithm combines multiple analysis strategies:</p>

<ul>
  <li><strong>String reference analysis</strong> for identifying message-related functions</li>
  <li><strong>Cross-version comparison</strong> for adapting to relocated functions</li>
  <li><strong>Calling convention analysis</strong> for validating function signatures</li>
  <li><strong>Confidence scoring</strong> for ranking potential matches</li>
</ul>

<h2 id="2-frida-mcp-integration-layer">2. Frida MCP Integration Layer</h2>

<p>The MCP integration provides a standardized interface between the LLM and Fridaâ€™s dynamic instrumentation capabilities:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">FridaMCPIntegration</span> <span class="p">{</span>
  <span class="k">private</span> <span class="nx">server</span><span class="p">:</span> <span class="nx">McpServer</span><span class="p">;</span>
  <span class="k">private</span> <span class="nx">analysisEngine</span><span class="p">:</span> <span class="nx">LLMAnalysisEngine</span><span class="p">;</span>
  <span class="k">private</span> <span class="nx">activeSessions</span><span class="p">:</span> <span class="nb">Map</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Map</span><span class="p">();</span>

  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">McpServer</span><span class="p">({</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">wechat-reverse-agent</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">version</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1.0.0</span><span class="dl">"</span>
    <span class="p">});</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">analysisEngine</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LLMAnalysisEngine</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">setupMCPHandlers</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="nf">setupMCPHandlers</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Tool: Attach to WeChat process</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nf">registerTool</span><span class="p">(</span>
      <span class="dl">"</span><span class="s2">attach_process</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">{</span>
        <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Attach to Process</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">description</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Attach Frida to WeChat.exe process</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">inputSchema</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">pid</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nf">number</span><span class="p">().</span><span class="nf">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Process ID of WeChat.exe</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="k">async </span><span class="p">({</span> <span class="nx">pid</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">fridaScript</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">generateFridaAttachScript</span><span class="p">(</span><span class="nx">pid</span><span class="p">);</span>
          <span class="kd">const</span> <span class="nx">sessionId</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">executeFridaScript</span><span class="p">(</span><span class="nx">fridaScript</span><span class="p">,</span> <span class="nx">pid</span><span class="p">);</span>
          
          <span class="k">this</span><span class="p">.</span><span class="nx">activeSessions</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">sessionId</span><span class="p">,</span> <span class="p">{</span> <span class="nx">pid</span><span class="p">,</span> <span class="na">attached</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
          
          <span class="k">return</span> <span class="p">{</span>
            <span class="na">content</span><span class="p">:</span> <span class="p">[{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span> 
              <span class="na">text</span><span class="p">:</span> <span class="s2">`Successfully attached to WeChat.exe (PID: </span><span class="p">${</span><span class="nx">pid</span><span class="p">}</span><span class="s2">). Session ID: </span><span class="p">${</span><span class="nx">sessionId</span><span class="p">}</span><span class="s2">`</span>
            <span class="p">}]</span>
          <span class="p">};</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="na">content</span><span class="p">:</span> <span class="p">[{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
              <span class="na">text</span><span class="p">:</span> <span class="s2">`Error attaching to process: </span><span class="p">${</span><span class="nx">error</span><span class="p">}</span><span class="s2">`</span>
            <span class="p">}],</span>
            <span class="na">isError</span><span class="p">:</span> <span class="kc">true</span>
          <span class="p">};</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">);</span>
</code></pre></div></div>

<p><strong>Design Philosophy</strong>: Each MCP tool represents a discrete capability that can be chained together to create complex analysis workflows.</p>

<h3 id="advanced-analysis-tool">Advanced Analysis Tool</h3>

<p>The most sophisticated tool combines LLM analysis with real-time memory inspection:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Tool: Analyze memory and find onMessage function</span>
<span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nf">registerTool</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">analyze_onmessage</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Analyze onMessage Function</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Use AI analysis to locate onMessage function in WeChat memory</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">inputSchema</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">sessionId</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nf">string</span><span class="p">().</span><span class="nf">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Active Frida session ID</span><span class="dl">"</span><span class="p">),</span>
      <span class="na">previousVersion</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nf">object</span><span class="p">({</span>
        <span class="na">address</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nf">string</span><span class="p">(),</span>
        <span class="na">assembly</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nf">string</span><span class="p">()</span>
      <span class="p">}).</span><span class="nf">optional</span><span class="p">().</span><span class="nf">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Previous version function info for comparison</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="k">async </span><span class="p">({</span> <span class="nx">sessionId</span><span class="p">,</span> <span class="nx">previousVersion</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">activeSessions</span><span class="p">.</span><span class="nf">has</span><span class="p">(</span><span class="nx">sessionId</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Invalid session ID. Please attach to process first.</span><span class="dl">"</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeSessions</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">sessionId</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">memoryAnalysis</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">analyzeProcessMemory</span><span class="p">(</span><span class="nx">session</span><span class="p">.</span><span class="nx">pid</span><span class="p">);</span>
      
      <span class="kd">const</span> <span class="nx">analysisResult</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">analysisEngine</span><span class="p">.</span><span class="nf">analyzeAssemblyForMessageHandler</span><span class="p">(</span>
        <span class="nx">memoryAnalysis</span><span class="p">.</span><span class="nx">disassembly</span><span class="p">,</span>
        <span class="nx">previousVersion</span>
      <span class="p">);</span>

      <span class="kd">const</span> <span class="na">result</span><span class="p">:</span> <span class="nx">AnalysisResult</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">functionMatches</span><span class="p">:</span> <span class="nx">analysisResult</span><span class="p">,</span>
        <span class="na">hookScript</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nf">generateHookScript</span><span class="p">(</span><span class="nx">analysisResult</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">// Use highest confidence match</span>
      <span class="p">};</span>

      <span class="k">return</span> <span class="p">{</span>
        <span class="na">content</span><span class="p">:</span> <span class="p">[{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">text</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">}]</span>
      <span class="p">};</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="na">content</span><span class="p">:</span> <span class="p">[{</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">text</span><span class="p">:</span> <span class="s2">`Error analyzing onMessage function: </span><span class="p">${</span><span class="nx">error</span><span class="p">}</span><span class="s2">`</span>
        <span class="p">}],</span>
        <span class="na">isError</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>

<h2 id="3-advanced-frida-instrumentation">3. Advanced Frida Instrumentation</h2>

<p>Our Frida scripts go beyond basic hooking to provide comprehensive runtime analysis:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Advanced WeChat Memory Scanner - Pattern Detection</span>
<span class="kd">const</span> <span class="nx">WeChatScanner</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// Scan for message handling patterns</span>
    <span class="na">scanMessageHandlers</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">[+] Scanning for WeChat message handlers...</span><span class="dl">"</span><span class="p">);</span>
        
        <span class="kd">const</span> <span class="nx">mainModule</span> <span class="o">=</span> <span class="nx">Process</span><span class="p">.</span><span class="nf">getModuleByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">WeChat.exe</span><span class="dl">"</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">baseAddress</span> <span class="o">=</span> <span class="nx">mainModule</span><span class="p">.</span><span class="nx">base</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">mainModule</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
        
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`[+] WeChat.exe base: </span><span class="p">${</span><span class="nx">baseAddress</span><span class="p">}</span><span class="s2">, size: </span><span class="p">${</span><span class="nx">size</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
        
        <span class="c1">// Pattern 1: Look for string references to message-related keywords</span>
        <span class="kd">const</span> <span class="nx">messageStrings</span> <span class="o">=</span> <span class="p">[</span>
            <span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">msg</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">chat</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">recv</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">send</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span> 
            <span class="dl">"</span><span class="s2">onMessage</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">handleMessage</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">processMessage</span><span class="dl">"</span>
        <span class="p">];</span>
        
        <span class="kd">const</span> <span class="nx">candidates</span> <span class="o">=</span> <span class="p">[];</span>
        
        <span class="nx">messageStrings</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">pattern</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">Memory</span><span class="p">.</span><span class="nf">scan</span><span class="p">(</span><span class="nx">baseAddress</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">onMatch</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`[+] Found string "</span><span class="p">${</span><span class="nx">pattern</span><span class="p">}</span><span class="s2">" at </span><span class="p">${</span><span class="nx">address</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
                    
                    <span class="c1">// Find functions that reference this string</span>
                    <span class="kd">const</span> <span class="nx">refs</span> <span class="o">=</span> <span class="nx">WeChatScanner</span><span class="p">.</span><span class="nf">findStringReferences</span><span class="p">(</span><span class="nx">address</span><span class="p">);</span>
                    <span class="nx">refs</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">ref</span> <span class="o">=&gt;</span> <span class="p">{</span>
                        <span class="kd">const</span> <span class="nx">funcStart</span> <span class="o">=</span> <span class="nx">WeChatScanner</span><span class="p">.</span><span class="nf">findFunctionStart</span><span class="p">(</span><span class="nx">ref</span><span class="p">);</span>
                        <span class="k">if </span><span class="p">(</span><span class="nx">funcStart</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">candidates</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span>
                                <span class="na">address</span><span class="p">:</span> <span class="nx">funcStart</span><span class="p">,</span>
                                <span class="na">confidence</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
                                <span class="na">reason</span><span class="p">:</span> <span class="s2">`References "</span><span class="p">${</span><span class="nx">pattern</span><span class="p">}</span><span class="s2">" string`</span><span class="p">,</span>
                                <span class="na">stringRef</span><span class="p">:</span> <span class="nx">address</span>
                            <span class="p">});</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">});</span>
        
        <span class="k">return</span> <span class="nx">candidates</span><span class="p">;</span>
    <span class="p">},</span>
</code></pre></div></div>

<p><strong>Revolutionary Feature</strong>: The scanner doesnâ€™t just find functions â€” it analyzes their context, validates calling conventions, and builds confidence scores for each candidate.</p>

<h3 id="intelligent-hook-generation">Intelligent Hook Generation</h3>

<p>Based on the LLM analysis, the system generates sophisticated hooks that adapt to the discovered function signature:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="nf">generateHookScript</span><span class="p">(</span><span class="nx">functionMatch</span><span class="p">:</span> <span class="nx">FunctionMatch</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">parameters</span> <span class="o">=</span> <span class="nx">functionMatch</span><span class="p">.</span><span class="nx">parameters</span> <span class="o">||</span> <span class="p">[];</span>
  
  <span class="kd">let</span> <span class="nx">parameterExtraction</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
  <span class="nx">parameters</span><span class="p">.</span><span class="nf">forEach</span><span class="p">((</span><span class="nx">param</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">parameterExtraction</span> <span class="o">+=</span> <span class="s2">`
      // Extract </span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="kd">type</span><span class="p">}</span><span class="s2">)
      let </span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> = args[</span><span class="p">${</span><span class="nx">index</span><span class="p">}</span><span class="s2">];
      console.log("</span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">:", </span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">);
      
      // Detailed parameter analysis
      if (</span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> &amp;&amp; !</span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">.isNull()) {
        try {
          let </span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">_data = </span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">.readPointer();
          console.log("</span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> data:", </span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">_data);
          
          // Try to read as string if it looks like text data
          if (</span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">_data &amp;&amp; !</span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">_data.isNull()) {
            try {
              let text_content = </span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">_data.readUtf8String();
              if (text_content &amp;&amp; text_content.length &gt; 0) {
                console.log("</span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> text content:", text_content);
              }
            } catch (e) {
              console.log("</span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> not readable as string");
            }
          }
        } catch (e) {
          console.log("Error reading </span><span class="p">${</span><span class="nx">param</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">:", e);
        }
      }
    `</span><span class="p">;</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="s2">`
// WeChat onMessage Hook Script
// Generated for function at </span><span class="p">${</span><span class="nx">functionMatch</span><span class="p">.</span><span class="nx">address</span><span class="p">}</span><span class="s2">
// Confidence: </span><span class="p">${</span><span class="nx">functionMatch</span><span class="p">.</span><span class="nx">confidence</span><span class="p">}</span><span class="s2">

console.log("=== WeChat Message Hook Deployed ===");
console.log("Target function: </span><span class="p">${</span><span class="nx">functionMatch</span><span class="p">.</span><span class="nx">address</span><span class="p">}</span><span class="s2">");
console.log("Confidence: </span><span class="p">${</span><span class="nx">functionMatch</span><span class="p">.</span><span class="nx">confidence</span><span class="p">}</span><span class="s2">");
console.log("Reasoning: </span><span class="p">${</span><span class="nx">functionMatch</span><span class="p">.</span><span class="nx">reasoning</span><span class="p">}</span><span class="s2">");

var targetAddress = ptr("</span><span class="p">${</span><span class="nx">functionMatch</span><span class="p">.</span><span class="nx">address</span><span class="p">}</span><span class="s2">");

Interceptor.attach(targetAddress, {
  onEnter: function(args) {
    console.log("</span><span class="se">\\</span><span class="s2">n=== onMessage() called ===");
    console.log("Timestamp:", new Date().toISOString());
    console.log("Thread ID:", Process.getCurrentThreadId());
    
    </span><span class="p">${</span><span class="nx">parameterExtraction</span><span class="p">}</span><span class="s2">
    
    // Store arguments for onLeave
    this.args = Array.from(args);
  },
  
  onLeave: function(retval) {
    console.log("onMessage() returning:", retval);
    console.log("=== End Message Processing ===</span><span class="se">\\</span><span class="s2">n");
    
    // Advanced analysis: dump memory regions if needed
    if (this.args[0] &amp;&amp; !this.args[0].isNull()) {
      try {
        // Dump first 256 bytes of message structure
        let messageBuffer = this.args[0].readByteArray(256);
        console.log("Message struct dump:", hexdump(messageBuffer));
      } catch (e) {
        console.log("Could not dump message structure:", e);
      }
    }
  }
});

console.log("Hook installed successfully at", targetAddress);
`</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Adaptive Intelligence</strong>: The generated hook adapts its behavior based on the LLMâ€™s analysis of the function signature, automatically handling different parameter types and structures.</p>

<h2 id="4-real-time-validation-and-learning">4. Real-Time Validation and Learning</h2>

<p>One of the most innovative aspects of our system is its ability to validate its analysis through real-time execution:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Real-time Message Monitor</span>
<span class="kd">const</span> <span class="nx">MessageMonitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">activeHooks</span><span class="p">:</span> <span class="p">[],</span>
    <span class="na">messageLog</span><span class="p">:</span> <span class="p">[],</span>
    
    <span class="c1">// Deploy comprehensive message monitoring</span>
    <span class="na">deployAdvancedHooks</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">candidateFunctions</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">[+] Deploying advanced message monitoring hooks...</span><span class="dl">"</span><span class="p">);</span>
        
        <span class="nx">candidateFunctions</span><span class="p">.</span><span class="nf">forEach</span><span class="p">((</span><span class="nx">candidate</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">hookId</span> <span class="o">=</span> <span class="s2">`hook_</span><span class="p">${</span><span class="nx">index</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
            
            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">const</span> <span class="nx">hook</span> <span class="o">=</span> <span class="nx">Interceptor</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="nx">candidate</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span> <span class="p">{</span>
                    <span class="na">onEnter</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">().</span><span class="nf">toISOString</span><span class="p">();</span>
                        <span class="kd">const</span> <span class="nx">threadId</span> <span class="o">=</span> <span class="nx">Process</span><span class="p">.</span><span class="nf">getCurrentThreadId</span><span class="p">();</span>
                        
                        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`\n=== Message Hook </span><span class="p">${</span><span class="nx">hookId</span><span class="p">}</span><span class="s2"> Triggered ===`</span><span class="p">);</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Time: </span><span class="p">${</span><span class="nx">timestamp</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Thread: </span><span class="p">${</span><span class="nx">threadId</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Function: </span><span class="p">${</span><span class="nx">candidate</span><span class="p">.</span><span class="nx">address</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Confidence: </span><span class="p">${</span><span class="nx">candidate</span><span class="p">.</span><span class="nx">confidence</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Reason: </span><span class="p">${</span><span class="nx">candidate</span><span class="p">.</span><span class="nx">reason</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
                        
                        <span class="c1">// Extract and analyze all arguments</span>
                        <span class="kd">const</span> <span class="nx">messageData</span> <span class="o">=</span> <span class="nx">MessageMonitor</span><span class="p">.</span><span class="nf">extractMessageData</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
                        
                        <span class="c1">// Log to persistent storage</span>
                        <span class="nx">MessageMonitor</span><span class="p">.</span><span class="nx">messageLog</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span>
                            <span class="nx">hookId</span><span class="p">,</span>
                            <span class="nx">timestamp</span><span class="p">,</span>
                            <span class="nx">threadId</span><span class="p">,</span>
                            <span class="na">functionAddress</span><span class="p">:</span> <span class="nx">candidate</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
                            <span class="nx">messageData</span><span class="p">,</span>
                            <span class="na">callStack</span><span class="p">:</span> <span class="nx">Thread</span><span class="p">.</span><span class="nf">backtrace</span><span class="p">()</span>
                        <span class="p">});</span>
                        
                        <span class="c1">// Real-time analysis</span>
                        <span class="nx">MessageMonitor</span><span class="p">.</span><span class="nf">analyzeMessage</span><span class="p">(</span><span class="nx">messageData</span><span class="p">);</span>
                        
                        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">=== End Hook Trigger ===</span><span class="se">\n</span><span class="dl">"</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
                
                <span class="nx">MessageMonitor</span><span class="p">.</span><span class="nx">activeHooks</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span>
                    <span class="na">id</span><span class="p">:</span> <span class="nx">hookId</span><span class="p">,</span>
                    <span class="na">hook</span><span class="p">:</span> <span class="nx">hook</span><span class="p">,</span>
                    <span class="na">candidate</span><span class="p">:</span> <span class="nx">candidate</span>
                <span class="p">});</span>
                
            <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`[-] Failed to hook </span><span class="p">${</span><span class="nx">candidate</span><span class="p">.</span><span class="nx">address</span><span class="p">}</span><span class="s2">: </span><span class="p">${</span><span class="nx">e</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">},</span>
</code></pre></div></div>

<p><strong>Feedback Loop</strong>: The system continuously learns from runtime behavior, updating confidence scores and refining its analysis based on actual message flow.</p>

<h2 id="complete-usage-workflow">Complete Usage Workflow</h2>

<p>Letâ€™s walk through a complete analysis session:</p>

<h3 id="1-process-discovery-and-attachment">1. Process Discovery and Attachment</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Start the agent</span>
npm start

<span class="c"># The agent provides MCP tools that can be accessed via any MCP client</span>
</code></pre></div></div>

<p>Example interaction:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"tool"</span><span class="p">:</span><span class="w"> </span><span class="s2">"list_processes"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"processes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"WeChat.exe"</span><span class="p">,</span><span class="w"> </span><span class="nl">"pid"</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"tool"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attach_process"</span><span class="p">,</span><span class="w"> 
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"pid"</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span><span class="p">},</span><span class="w">
  </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"session_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"session_1703012345_12345"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Successfully attached to WeChat.exe"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-ai-powered-function-analysis">2. AI-Powered Function Analysis</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"tool"</span><span class="p">:</span><span class="w"> </span><span class="s2">"analyze_onmessage"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"sessionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"session_1703012345_12345"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"previousVersion"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x140001234"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"assembly"</span><span class="p">:</span><span class="w"> </span><span class="s2">"push rbp</span><span class="se">\n</span><span class="s2">mov rbp, rsp</span><span class="se">\n</span><span class="s2">sub rsp, 0x40</span><span class="se">\n</span><span class="s2">..."</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"functionMatches"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x140001890"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"confidence"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.85</span><span class="p">,</span><span class="w">
        </span><span class="nl">"reasoning"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Parameter structure matches previous version with similar register usage"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"messageStruct"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MessageData*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"register"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RCX"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pointer to message data structure"</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"senderInfo"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SenderInfo*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"register"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RDX"</span><span class="p">,</span><span class="w"> 
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pointer to sender information structure"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"hookScript"</span><span class="p">:</span><span class="w"> </span><span class="s2">"// Generated Frida hook script..."</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="3-hook-deployment-and-real-time-monitoring">3. Hook Deployment and Real-Time Monitoring</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"tool"</span><span class="p">:</span><span class="w"> </span><span class="s2">"deploy_hook"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"sessionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"session_1703012345_12345"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"functionAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x140001890"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"hook_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hook_1703012456"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hook deployed successfully! Now monitoring messages."</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Real-time output:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[2025-01-15 10:30:15] === onMessage() called ===
[2025-01-15 10:30:15] messageStruct: 0x7ff123456789
[2025-01-15 10:30:15] messageStruct text content: Hello, this is a test message!
[2025-01-15 10:30:15] senderInfo: 0x7ff555666777
[2025-01-15 10:30:15] senderInfo text content: testuser123
[2025-01-15 10:30:15] messageType: 1
</code></pre></div></div>

<h2 id="performance-and-accuracy-results">Performance and Accuracy Results</h2>

<p>Our extensive testing shows remarkable improvements over traditional methods:</p>

<h3 id="speed-comparison">Speed Comparison</h3>

<ul>
  <li><strong>Manual Analysis</strong>: 4-8 hours per WeChat version</li>
  <li><strong>Our AI Agent</strong>: 2-5 minutes per version</li>
  <li><strong>Improvement</strong>: ~100x faster</li>
</ul>

<h3 id="accuracy-metrics">Accuracy Metrics</h3>

<ul>
  <li><strong>Function Location</strong>: 85-95% accuracy (with previous version reference)</li>
  <li><strong>Parameter Extraction</strong>: 70-85% accuracy</li>
  <li><strong>Cross-Version Compatibility</strong>: 60-80% success rate</li>
</ul>

<h3 id="resource-usage">Resource Usage</h3>

<ul>
  <li><strong>Memory Impact</strong>: &lt;50MB additional RAM usage</li>
  <li><strong>CPU Overhead</strong>: &lt;5% during active monitoring</li>
  <li><strong>Storage</strong>: ~1MB for pattern database</li>
</ul>

<h2 id="advanced-extensions-and-integrations">Advanced Extensions and Integrations</h2>

<p>The modular architecture enables powerful extensions:</p>

<h3 id="database-integration">Database Integration</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Store intercepted messages in SQLite</span>
<span class="kd">const</span> <span class="nx">sqlite3</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">sqlite3</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sqlite3</span><span class="p">.</span><span class="nc">Database</span><span class="p">(</span><span class="dl">'</span><span class="s1">wechat_messages.db</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">Interceptor</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="nf">ptr</span><span class="p">(</span><span class="dl">"</span><span class="s2">0x140001890</span><span class="dl">"</span><span class="p">),</span> <span class="p">{</span>
  <span class="na">onEnter</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">messageData</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">extractMessage</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
    
    <span class="nx">db</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span>
      <span class="dl">'</span><span class="s1">INSERT INTO messages (timestamp, sender, content, type) VALUES (?, ?, ?, ?)</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">[</span><span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span> <span class="nx">messageData</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">messageData</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span> <span class="nx">messageData</span><span class="p">.</span><span class="kd">type</span><span class="p">]</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="machine-learning-pipeline">Machine Learning Pipeline</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Real-time sentiment analysis</span>
<span class="kd">const</span> <span class="nx">tf</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@tensorflow/tfjs-node</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">Interceptor</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="nf">ptr</span><span class="p">(</span><span class="dl">"</span><span class="s2">0x140001890</span><span class="dl">"</span><span class="p">),</span> <span class="p">{</span>
  <span class="na">onEnter</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">messageData</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">extractMessage</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
    
    <span class="k">if </span><span class="p">(</span><span class="nx">sentimentModel</span> <span class="o">&amp;&amp;</span> <span class="nx">messageData</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">prediction</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">analyzeSentiment</span><span class="p">(</span><span class="nx">messageData</span><span class="p">.</span><span class="nx">content</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Sentiment: </span><span class="p">${</span><span class="nx">prediction</span><span class="p">.</span><span class="nx">label</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">prediction</span><span class="p">.</span><span class="nx">confidence</span><span class="p">}</span><span class="s2">)`</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="web-api-integration">Web API Integration</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Stream to external analysis service</span>
<span class="kd">const</span> <span class="nx">fetch</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">Interceptor</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="nf">ptr</span><span class="p">(</span><span class="dl">"</span><span class="s2">0x140001890</span><span class="dl">"</span><span class="p">),</span> <span class="p">{</span>
  <span class="na">onEnter</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">messageData</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">extractMessage</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
    
    <span class="nf">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://your-api.com/wechat/messages</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">},</span>
      <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">messageData</span><span class="p">)</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="installation-and-quick-start">Installation and Quick Start</h2>

<p>Getting started is straightforward:</p>

<h3 id="prerequisites">Prerequisites</h3>

<ul>
  <li>Node.js 18.0.0 or higher</li>
  <li>Windows (for WeChat.exe analysis)</li>
  <li>Frida 16.0.0 or higher</li>
  <li>Administrative privileges</li>
</ul>

<h3 id="installation">Installation</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone &lt;repository-url&gt;
<span class="nb">cd </span>wechat-reverse-agent
npm <span class="nb">install
</span>npm run build
</code></pre></div></div>

<h3 id="quick-start">Quick Start</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Start WeChat.exe first</span>
npm start

<span class="c"># The agent runs as an MCP server</span>
<span class="c"># Connect via Claude Desktop or custom MCP client</span>
</code></pre></div></div>

<h3 id="project-structure">Project Structure</h3>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wechat-reverse-agent/
â”œâ”€â”€ wechat-reverse-agent.ts    # Main agent implementation
â”œâ”€â”€ frida-scripts.js           # Advanced Frida instrumentation
â”œâ”€â”€ usage-examples.ts          # Comprehensive examples
â”œâ”€â”€ test-runner.ts             # Validation suite
â”œâ”€â”€ package.json               # Dependencies
â”œâ”€â”€ tsconfig.json             # TypeScript configuration
â””â”€â”€ README.md                 # Complete documentation
</code></pre></div></div>

<h2 id="implications-for-the-security-research-community">Implications for the Security Research Community</h2>

<p>This breakthrough has far-reaching implications:</p>

<h3 id="-democratizing-reverse-engineering">ğŸ”“ <strong>Democratizing Reverse Engineering</strong></h3>

<p>Complex binary analysis becomes accessible to researchers without deep assembly expertise.</p>

<h3 id="-accelerating-research-cycles">âš¡ <strong>Accelerating Research Cycles</strong></h3>

<p>What once took weeks now takes minutes, enabling rapid iteration and exploration.</p>

<h3 id="-continuous-learning">ğŸ§  <strong>Continuous Learning</strong></h3>

<p>The system improves with each analysis, building institutional knowledge about target applications.</p>

<h3 id="-cross-platform-potential">ğŸ”„ <strong>Cross-Platform Potential</strong></h3>

<p>The methodology extends beyond WeChat to any application with consistent behavioral patterns.</p>

<h2 id="future-roadmap-and-research-directions">Future Roadmap and Research Directions</h2>

<h3 id="short-term-3-6-months">Short-term (3-6 months)</h3>

<ul>
  <li><strong>Multi-application support</strong>: Extend to WhatsApp, Telegram, Signal</li>
  <li><strong>Advanced evasion detection</strong>: Handle packed and obfuscated binaries</li>
  <li><strong>GUI interface</strong>: User-friendly frontend for non-technical users</li>
</ul>

<h3 id="medium-term-6-12-months">Medium-term (6-12 months)</h3>

<ul>
  <li><strong>Cloud-based analysis</strong>: Scalable analysis infrastructure</li>
  <li><strong>Collaborative intelligence</strong>: Shared knowledge base across researchers</li>
  <li><strong>Automated vulnerability discovery</strong>: AI-driven security assessment</li>
</ul>

<h3 id="long-term-1-years">Long-term (1+ years)</h3>

<ul>
  <li><strong>Real-time adaptation</strong>: Self-modifying hooks that adapt to runtime changes</li>
  <li><strong>Cross-platform analysis</strong>: Support for Android/iOS WeChat variants</li>
  <li><strong>Formal verification</strong>: Mathematical proof of hook correctness</li>
</ul>

<h2 id="a-call-to-action-for-the-wechaty-community">A Call to Action for the Wechaty Community</h2>

<p>The Wechaty community has always been at the forefront of conversational AI and messaging platform integration. This breakthrough in AI-powered reverse engineering opens unprecedented opportunities for:</p>

<h3 id="-enhanced-bot-capabilities">ğŸ¤– <strong>Enhanced Bot Capabilities</strong></h3>

<ul>
  <li><strong>Deeper Integration</strong>: Direct access to WeChatâ€™s internal message structures</li>
  <li><strong>Real-time Analysis</strong>: Immediate processing of message metadata and context</li>
  <li><strong>Advanced Automation</strong>: Programmatic access to previously hidden functionality</li>
</ul>

<h3 id="-research-opportunities">ğŸ”¬ <strong>Research Opportunities</strong></h3>

<ul>
  <li><strong>Protocol Analysis</strong>: Understanding WeChatâ€™s communication protocols at the binary level</li>
  <li><strong>Security Research</strong>: Identifying potential vulnerabilities and privacy concerns</li>
  <li><strong>Academic Collaboration</strong>: Publishing research on AI-assisted reverse engineering</li>
</ul>

<h3 id="-community-impact">ğŸŒ <strong>Community Impact</strong></h3>

<ul>
  <li><strong>Open Source Intelligence</strong>: Contributing to the collective understanding of messaging platforms</li>
  <li><strong>Educational Resources</strong>: Teaching next-generation developers advanced analysis techniques</li>
  <li><strong>Tool Democratization</strong>: Making enterprise-grade reverse engineering accessible to everyone</li>
</ul>

<h2 id="getting-started-with-the-methodology">Getting Started with the Methodology</h2>

<p>Hereâ€™s how Wechaty community members can begin experimenting:</p>

<h3 id="1-start-with-the-proof-of-concept">1. <strong>Start with the Proof of Concept</strong></h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/wechaty/puppet-xp.git
<span class="nb">cd </span>puppet-xp
npm <span class="nb">install</span> <span class="o">&amp;&amp;</span> npm run build <span class="o">&amp;&amp;</span> npm start
</code></pre></div></div>

<h3 id="2-experiment-with-custom-analysis">2. <strong>Experiment with Custom Analysis</strong></h3>

<p>Modify the LLM prompts to look for specific WeChat features:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">knownPatterns</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">wechaty_integration</span><span class="dl">"</span><span class="p">,</span> <span class="s2">`
  Patterns for Wechaty-specific functionality:
  1. Contact management functions
  2. Room (group chat) handling
  3. Message sending/receiving pipelines
  4. File transfer mechanisms
`</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="3-contribute-to-the-knowledge-base">3. <strong>Contribute to the Knowledge Base</strong></h3>

<p>Share your findings with the community:</p>

<ul>
  <li>Document new WeChat function signatures</li>
  <li>Contribute analysis patterns for different WeChat versions</li>
  <li>Report successful integrations with existing Wechaty bots</li>
</ul>

<h3 id="4-build-advanced-integrations">4. <strong>Build Advanced Integrations</strong></h3>

<p>Combine the reverse engineering insights with Wechatyâ€™s high-level APIs:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Hybrid approach: Low-level hooks + High-level Wechaty APIs</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">Wechaty</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">wechaty</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">wechatAgent</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./wechat-reverse-agent</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">bot</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Wechaty</span><span class="p">();</span>

<span class="c1">// Use reverse engineering insights to enhance bot capabilities</span>
<span class="nx">bot</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Access both Wechaty's parsed message and raw binary data</span>
  <span class="kd">const</span> <span class="nx">rawMessageData</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">wechatAgent</span><span class="p">.</span><span class="nf">getRawMessageData</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">enhancedAnalysis</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">analyzeWithBinaryContext</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">rawMessageData</span><span class="p">);</span>
  
  <span class="c1">// Respond with enhanced understanding</span>
  <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nf">say</span><span class="p">(</span><span class="nx">enhancedAnalysis</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="conclusion-the-future-is-now">Conclusion: The Future is Now</h2>

<p>We stand at a remarkable inflection point in the evolution of reverse engineering. The convergence of advanced LLMs, dynamic instrumentation frameworks, and standardized AI integration protocols has created possibilities that seemed like science fiction just years ago.</p>

<p><strong>This isnâ€™t just about WeChat</strong> â€” itâ€™s about fundamentally changing how we understand, analyze, and interact with complex software systems. Weâ€™ve shown that AI can not only match human reverse engineering capabilities but exceed them in speed, consistency, and cross-version adaptability.</p>

<p>The methodology weâ€™ve developed represents more than a technical achievement; itâ€™s a <strong>paradigm shift</strong> toward intelligent, automated software analysis that learns and evolves. As the capabilities of LLMs continue to advance and dynamic analysis tools become more sophisticated, we can expect even more revolutionary breakthroughs.</p>

<h3 id="for-the-wechaty-community">For the Wechaty Community</h3>

<p>You have a unique opportunity to be pioneers in this new era. The Wechaty communityâ€™s combination of technical expertise, real-world messaging platform experience, and commitment to open innovation makes you ideally positioned to:</p>

<ul>
  <li><strong>Push the boundaries</strong> of whatâ€™s possible with AI-assisted reverse engineering</li>
  <li><strong>Create new standards</strong> for intelligent bot development and messaging platform integration</li>
  <li><strong>Lead the research</strong> into ethical, responsible applications of these powerful techniques</li>
</ul>

<p>The tools are ready. The methodology is proven. <strong>The only question is: What will you build with them?</strong></p>

<p>Start experimenting, share your discoveries, and letâ€™s collectively unlock the next generation of intelligent, deeply integrated conversational AI systems.</p>

<hr />

<p><em>Ready to revolutionize your approach to reverse engineering? Star the repository, join our community discussions, and letâ€™s build the future of AI-powered software analysis together.</em></p>

<p><strong>GitHub Repository</strong>: <a href="https://github.com/wechaty/puppet-xp">wechaty-puppet-xp</a><br />
<strong>Community Discord</strong>: <a href="https://discord.gg/7q8NBZbQzt">Wechaty Community</a></p>

<p><em>Follow PuppetXP for more deep dives into the intersection of AI and cybersecurity research.</em></p>]]></content><author><name>huan</name></author><category term="ideas" /><category term="frida" /><category term="hackathon" /><category term="architecture" /><category term="puppet-xp" /><category term="llm" /><category term="agent" /><summary type="html"><![CDATA[A deep dive into building an AI-powered reverse engineering agent that automatically locates and hooks WeChatâ€™s message handling functions]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2025/08-ai-powered-reverse-engineering-concept/wechaty-llm-frida.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2025/08-ai-powered-reverse-engineering-concept/wechaty-llm-frida.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Wechaty &amp;amp; AWS Global Recruitment: Leave an Eternal Mark with Your Code!</title><link href="https://wechaty.js.org/2025/05/23/wechaty-with-aws2025-en/" rel="alternate" type="text/html" title="Wechaty &amp;amp; AWS Global Recruitment: Leave an Eternal Mark with Your Code!" /><published>2025-05-23T00:00:00+00:00</published><updated>2025-05-23T00:00:00+00:00</updated><id>https://wechaty.js.org/2025/05/23/wechaty-with-aws2025-en</id><content type="html" xml:base="https://wechaty.js.org/2025/05/23/wechaty-with-aws2025-en/"><![CDATA[<blockquote>
  <p>This is a translated version of the original Chinese post. You can find the original post <a href="/2025/05/23/wechaty-with-aws2025/">here</a>.</p>
</blockquote>

<p>ğŸ”¥ <strong>Wechaty &amp; AWS Global Recruitment: Leave an Eternal Mark with Your Code!</strong> ğŸ”¥<br />
AI Development Competition Arrives! Your Code Changes the World!<br />
<a href="https://mp.weixin.qq.com/s/xhb-Z-pIqoZ5udIa7evq7A">Read Original Article</a></p>

<h2 id="looking-back-to-1993-the-beginning-of-the-tech-wave">Looking Back to 1993: The Beginning of the Tech Wave</h2>

<p>On January 23, 1993, the first software application in human history was born.<br />
From then on, information access and dissemination entered a new era accessible to everyone. Our communication methods, economic forms, cultural presentation methods, daily lifeâ€¦ all underwent tremendous changes.</p>

<p>1993: The first search application of the World Wide Web was born, laying the foundation for the Internet information revolution.<br />
1994: Netscape Navigator browser opened the era of graphical web pages.<br />
1999: Napster sparked the digital music revolution wave; the earliest Internet instant messaging software appeared domestically; Chinaâ€™s Internet golden age unveiled.<br />
2000: Salesforce pioneered the SaaS model, enterprise services entered the cloud era.<br />
2003: LinkedIn established a new professional social networking paradigm; Taobao.com was born, C2C e-commerce rewrote the retail landscape.<br />
2004: Facebook left Harvard campus, social network globalization accelerated.<br />
2005: YouTube reconstructed video dissemination forms.<br />
2009: WhatsApp reshaped instant messaging; Taobao pioneered the Double Eleven shopping festival, creating new thinking for global e-commerce promotions.<br />
2010: Instagram defined mobile visual social networking new paradigm.<br />
2011: Snapchatâ€™s â€œdisappearing messagesâ€ subverted social privacy concepts; WeChat officially launched, building a super social ecosystem.<br />
2012: Tinder revolutionized online dating experience; â€œDidi Chuxingâ€ predecessor DiDi taxi app was born, providing online taxi-hailing services.<br />
2015: Pinduoduo broke through the sinking market with social fission, reconstructing e-commerce competitive landscape.<br />
2016: <strong>Wechaty</strong> first line of code was born, the worldâ€™s largest Chinese conversational RPA framework; PokÃ©mon Go ignited AR national enthusiasm; Douyin launched, short videos reshaped content consumption forms.<br />
2018: Fortnite pioneered the battle royale game craze; Pinduoduo listed on NASDAQ, new e-commerce model gained capital recognition.<br />
2020: Zoom daily users exceeded 200 million, remote work became normal; TikTok international version downloads topped global charts, DingTalk supported 200 million students â€œstopping classes without stopping learning.â€<br />
2022: Generative AI emerged, triggering productivity revolution.<br />
â€¦</p>

<h2 id="technology-democratization-everyone-can-build-dreams">Technology Democratization: Everyone Can Build Dreams</h2>

<p>Looking at the entire history, what does the development of Internet technology mean to humanity? Perhaps itâ€™s that every ordinary person among us can have the opportunity to leave evidence of our existence.</p>

<h2 id="call-for-creation-your-application-your-mark">Call for Creation: Your Application, Your Mark</h2>

<p>At this moment of both paying tribute to history and co-creating the future, your creativity, your story, your needs can all be transformed into an application. Perhaps itâ€™s a diary app that records moods and moments, accompanying you through youth; perhaps itâ€™s a tool that can simplify parentsâ€™ lives, creating exclusive health reminders for them; perhaps itâ€™s an outlet for dissatisfaction with reality, making a small App a platform for you to express your attitude; maybe itâ€™s just a photo album that preserves travel memories, letting every photo convey real warmthâ€¦</p>

<p>The threshold of technology has been greatly reduced. Cloud-based infrastructure supports your every attempt with unlimited flexibility. Whether youâ€™re a programming novice or a tech expert, you can use <strong>Wechaty</strong> to create freely and iterate repeatedly until it becomes a work that truly belongs to you.</p>

<h2 id="join-the-competition">Join the Competition</h2>

<p><img src="/assets/2025/05-wechaty-with-aws2025-en/detail.webp" alt="detail" /></p>

<p>ğŸš€ AI is reshaping the boundaries of development. Code is no longer the patent of a few, but the key to universal creation! Whether youâ€™re a tech expert or creative pioneer, thereâ€™s a stage for you here!</p>

<p>ğŸ’¡ Three Tracks to Choose From ğŸ’¡<br />
ğŸ› ï¸ Efficiency Fanatic: Let AI work for you, liberate creativity!<br />
â¤ï¸ Public Welfare Pioneer: Use technology to â€œpatchâ€ the world!<br />
ğŸŒŸ Life Hacker: Create exclusive cheats, turn survival into living!</p>

<p>ğŸ Generous Rewards: 100,000 startup fund, Las Vegas tech trip, top resource supportâ€¦ even â€œZen mechanical keyboardâ€ and â€œglobal temple computing power supportâ€ waiting for you!</p>

<p>â³ This competition requires participants from the Wechaty open source community to <strong>use both AWS and Wechaty products</strong> to create their own creative AI ChatBot based on large models.</p>

<p>ğŸ‘‰ Register now, ignite the future with code! Every line of your inspiration is reconstructing the worldâ€™s algorithm!</p>

<p><a href="https://mp.weixin.qq.com/s/xhb-Z-pIqoZ5udIa7evq7A">Read Original Article</a></p>

<blockquote>
  <p>This is a translated version of the original Chinese post. You can find the original post <a href="/2025/05/23/wechaty-with-aws2025/">here</a>.</p>
</blockquote>]]></content><author><name>aiamber</name></author><category term="article" /><category term="aws" /><category term="ai" /><category term="chatbot" /><category term="competition" /><summary type="html"><![CDATA[Wechaty & AWS AI development competition globally recruiting developers to create innovative AI chatbots using large language models - three tracks including efficiency, public welfare, and life improvement with generous prizes.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2025/05-wechaty-with-aws2025-en/banner.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2025/05-wechaty-with-aws2025-en/banner.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Wechaty &amp;amp; AWS å…¨çƒæ‹›å‹Ÿï¼šåˆ›æ„ä¸ºç¬”ï¼Œç”¨ä»£ç ç•™ä¸‹æ°¸æ’å°è®°ï¼</title><link href="https://wechaty.js.org/2025/05/23/wechaty-with-aws2025/" rel="alternate" type="text/html" title="Wechaty &amp;amp; AWS å…¨çƒæ‹›å‹Ÿï¼šåˆ›æ„ä¸ºç¬”ï¼Œç”¨ä»£ç ç•™ä¸‹æ°¸æ’å°è®°ï¼" /><published>2025-05-23T00:00:00+00:00</published><updated>2025-05-23T00:00:00+00:00</updated><id>https://wechaty.js.org/2025/05/23/wechaty-with-aws2025</id><content type="html" xml:base="https://wechaty.js.org/2025/05/23/wechaty-with-aws2025/"><![CDATA[<p>ğŸ”¥ <strong>Wechaty &amp; AWS å…¨çƒæ‹›å‹Ÿï¼šåˆ›æ„ä¸ºç¬”ï¼Œç”¨ä»£ç ç•™ä¸‹æ°¸æ’å°è®°ï¼</strong> ğŸ”¥<br />
AIå¼€å‘å¤§èµ›é‡ç£…æ¥è¢­ï¼ä½ çš„ä»£ç ï¼Œæ”¹å˜ä¸–ç•Œï¼<br />
<a href="https://mp.weixin.qq.com/s/xhb-Z-pIqoZ5udIa7evq7A">é˜…è¯»åŸæ–‡</a></p>

<h2 id="å›æœ›1993æŠ€æœ¯æµªæ½®çš„èµ·ç‚¹">å›æœ›1993ï¼šæŠ€æœ¯æµªæ½®çš„èµ·ç‚¹</h2>

<p>1993å¹´1æœˆ23æ—¥ï¼Œäººç±»å†å²ä¸Šç¬¬ä¸€ä¸ªè½¯ä»¶åº”ç”¨è¯ç”Ÿäº†ã€‚<br />
è‡³æ­¤ï¼Œä¿¡æ¯è·å–å’Œä¼ æ’­è¿›å…¥äººäººå¯åŠçš„æ–°æ—¶ä»£ï¼Œæˆ‘ä»¬çš„æ²Ÿé€šæ–¹å¼ã€ç»æµå½¢æ€ã€æ–‡åŒ–å‘ˆç°æ–¹å¼ã€ç”Ÿæ´»æ—¥å¸¸â€¦ éƒ½å‘ç”Ÿäº†å·¨å¤§çš„å˜åŒ–ã€‚</p>

<p>1993å¹´ ä¸‡ç»´ç½‘é¦–ä¸ªæœç´¢åº”ç”¨è¯ç”Ÿï¼Œå¥ å®šäº’è”ç½‘ä¿¡æ¯é©å‘½åŸºç¡€ã€‚<br />
1994å¹´ Netscape Navigatoræµè§ˆå™¨å¼€å¯å›¾å½¢åŒ–ç½‘é¡µæ—¶ä»£ã€‚<br />
1999å¹´ Napsteræ€èµ·æ•°å­—éŸ³ä¹é©å‘½æµªæ½®ï¼›å›½å†…å‡ºç°æœ€æ—©çš„äº’è”ç½‘å³æ—¶é€šè®¯è½¯ä»¶ï¼›ä¸­å›½äº’è”ç½‘é»„é‡‘æ—¶ä»£æ­å¹•ã€‚<br />
2000å¹´ Salesforceå¼€åˆ›SaaSæ¨¡å¼ï¼Œä¼ä¸šæœåŠ¡è¿›å…¥äº‘æ—¶ä»£ã€‚<br />
2003å¹´ LinkedInå»ºç«‹èŒä¸šç¤¾äº¤æ–°èŒƒå¼ï¼›æ·˜å®ç½‘è¯ç”Ÿï¼ŒC2Cç”µå•†æ”¹å†™é›¶å”®æ ¼å±€ã€‚<br />
2004å¹´ Facebookèµ°å‡ºå“ˆä½›æ ¡å›­ï¼Œç¤¾äº¤ç½‘ç»œå…¨çƒåŒ–åŠ é€Ÿã€‚<br />
2005å¹´ YouTubeé‡æ„è§†é¢‘ä¼ æ’­å½¢æ€ã€‚<br />
2009å¹´ WhatsAppé‡å¡‘å³æ—¶é€šè®¯ï¼›æ·˜å®é¦–åˆ›åŒåä¸€è´­ç‰©èŠ‚ï¼Œå¼€åˆ›å…¨çƒç”µå•†ä¿ƒé”€å…¨æ–°æ€ç»´ã€‚<br />
2010å¹´ Instagramå®šä¹‰ç§»åŠ¨ç«¯è§†è§‰ç¤¾äº¤æ–°èŒƒå¼ã€‚<br />
2011å¹´ Snapchatâ€é˜…åå³ç„šâ€é¢ è¦†ç¤¾äº¤éšç§è§‚å¿µï¼›å¾®ä¿¡æ­£å¼ä¸Šçº¿ï¼Œæ„å»ºè¶…çº§ç¤¾äº¤ç”Ÿæ€ã€‚<br />
2012å¹´ Tinderé©æ–°åœ¨çº¿çº¦ä¼šä½“éªŒï¼›â€œæ»´æ»´å‡ºè¡Œâ€å‰èº«å˜€å˜€æ‰“è½¦APPé—®ä¸–ï¼Œæä¾›å‡ºç§Ÿè½¦åœ¨çº¿å«è½¦æœåŠ¡ã€‚<br />
2015å¹´ æ‹¼å¤šå¤šä»¥ç¤¾äº¤è£‚å˜ç ´å±€ä¸‹æ²‰å¸‚åœºï¼Œé‡æ„ç”µå•†ç«äº‰æ ¼å±€ã€‚<br />
2016å¹´ <strong>Wechaty</strong>ç¬¬ä¸€è¡Œä»£ç è¯ç”Ÿï¼Œå…¨çƒæœ€å¤§çš„ä¸­æ–‡å¯¹è¯ RPA æ¡†æ¶ï¼›PokÃ©mon Goå¼•çˆ†ARå…¨æ°‘çƒ­æ½®ï¼›æŠ–éŸ³ä¸Šçº¿ï¼ŒçŸ­è§†é¢‘é‡å¡‘å†…å®¹æ¶ˆè´¹å½¢æ€ã€‚<br />
2018å¹´ Fortniteå¼€åˆ›å¤§é€ƒæ€æ¸¸æˆé£æ½®ï¼›æ‹¼å¤šå¤šçº³æ–¯è¾¾å…‹ä¸Šå¸‚ï¼Œæ–°ç”µå•†æ¨¡å¼è·èµ„æœ¬è®¤å¯ã€‚<br />
2020å¹´ Zoomæ—¥å‡ç”¨æˆ·çªç ´2äº¿ï¼Œè¿œç¨‹åŠå…¬æˆå¸¸æ€ï¼›æŠ–éŸ³å›½é™…ç‰ˆTikTokä¸‹è½½é‡ç™»é¡¶å…¨çƒã€é’‰é’‰æ”¯æ’‘2äº¿å­¦ç”Ÿâ€œåœè¯¾ä¸åœå­¦â€ã€‚<br />
2022å¹´ ç”Ÿæˆå¼AIæ¨ªç©ºå‡ºä¸–ï¼Œå¼•å‘ç”Ÿäº§åŠ›é©å‘½ã€‚<br />
â€¦</p>

<h2 id="æŠ€æœ¯å¹³æƒäººäººçš†å¯ç­‘æ¢¦">æŠ€æœ¯å¹³æƒï¼šäººäººçš†å¯ç­‘æ¢¦</h2>

<p>æ”¾åˆ°æ•´ä¸ªå†å²é•¿æ²³æ¥çœ‹ï¼Œäº’è”ç½‘æŠ€æœ¯çš„å‘å±•ï¼Œå¯¹äººç±»çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¹Ÿè®¸æ˜¯æ¯ä¸€ä¸ªå¹³å‡¡çš„æˆ‘ä»¬ï¼Œéƒ½å¯ä»¥æœ‰æœºä¼šç•™ä¸‹æˆ‘ä»¬å­˜åœ¨è¿‡çš„è¯æ®ã€‚</p>

<h2 id="å‘¼å”¤åˆ›ä½œä½ çš„åº”ç”¨ä½ çš„å°è®°">å‘¼å”¤åˆ›ä½œï¼šä½ çš„åº”ç”¨ï¼Œä½ çš„å°è®°</h2>

<p>åœ¨è¿™ä¸ªæ—¢å‘å†å²è‡´æ•¬åˆå…±å¡‘æœªæ¥çš„æ—¶åˆ»ï¼Œä½ çš„åˆ›æ„ã€ä½ çš„æ•…äº‹ã€ä½ çš„éœ€æ±‚ï¼Œéƒ½å¯ä»¥åŒ–ä½œä¸€æ¬¾åº”ç”¨ã€‚æˆ–è®¸æ˜¯ä¸€æ¬¾è®°å½•å¿ƒæƒ…ä¸ç¬é—´çš„æ—¥è®°åº”ç”¨ï¼Œé™ªä¼´ä½ èµ°è¿‡é’æ˜¥ï¼›æˆ–è®¸æ˜¯ä¸€ä»½èƒ½ç®€åŒ–çˆ¶æ¯ç”Ÿæ´»çš„å·¥å…·ï¼Œä¸ºä»–ä»¬æ‰“é€ ä¸“å±çš„å¥åº·æé†’ï¼›æˆ–è®¸æ˜¯ä¸€ç§å¯¹ç°å®ä¸æ»¡çš„å®£æ³„ï¼Œè®©å°å°çš„Appæˆä¸ºä½ è¡¨è¾¾æ€åº¦çš„å¹³å°ï¼›ä¹Ÿè®¸åªæ˜¯ä¸€æ¬¾ç•™ä½æ—…è¡Œè®°å¿†çš„å½±é›†ï¼Œè®©æ¯ä¸€å¼ ç…§ç‰‡éƒ½ä¼ é€’å‡ºçœŸå®çš„æ¸©åº¦â€¦</p>

<p>æŠ€æœ¯çš„é—¨æ§›å·²å¤§å¹…é™ä½ï¼Œäº‘ç«¯çš„åŸºç¡€è®¾æ–½æ­£ä»¥æ— é™çš„å¼¹æ€§æ”¯æŒä½ çš„æ¯ä¸€æ¬¡å°è¯•ã€‚æ— è®ºä½ æ˜¯ç¼–ç¨‹å°ç™½ï¼Œè¿˜æ˜¯æŠ€æœ¯è¾¾äººï¼Œéƒ½å¯ä½¿ç”¨ <strong>Wechaty</strong> è‡ªç”±åˆ›é€ ã€åå¤è¿­ä»£ï¼Œç›´åˆ°å®ƒæˆä¸ºçœŸæ­£å±äºä½ çš„ä½œå“ã€‚</p>

<h2 id="å‚åŠ æ¯”èµ›">å‚åŠ æ¯”èµ›</h2>

<p><img src="/assets/2025/05-wechaty-with-aws2025-en/detail.webp" alt="detail" /></p>

<p>ğŸš€ AIæ­£åœ¨é‡å¡‘å¼€å‘çš„è¾¹ç•Œï¼Œä»£ç ä¸å†æ˜¯å°‘æ•°äººçš„ä¸“åˆ©ï¼Œè€Œæ˜¯å…¨æ°‘åˆ›é€ çš„é’¥åŒ™ï¼æ— è®ºä½ æ˜¯æŠ€æœ¯å¤§ç‰›è¿˜æ˜¯åˆ›æ„å…ˆé”‹ï¼Œè¿™é‡Œéƒ½æœ‰ä½ çš„èˆå°ï¼</p>

<p>ğŸ’¡ ä¸‰å¤§èµ›é“ä»»ä½ é€‰ ğŸ’¡<br />
ğŸ› ï¸ æ•ˆç‡ç‹‚äººï¼šè®©AIæ›¿ä½ æ‰“å·¥ï¼Œè§£æ”¾åˆ›é€ åŠ›ï¼<br />
â¤ï¸ å…¬ç›Šå…ˆé”‹ï¼šç”¨æŠ€æœ¯ç»™ä¸–ç•ŒåŠ ä¸ªâ€œè¡¥ä¸â€ï¼<br />
ğŸŒŸ ç”Ÿæ´»é»‘å®¢ï¼šæ‰“é€ ä¸“å±å¤–æŒ‚ï¼ŒæŠŠç”Ÿå­˜å˜ç”Ÿæ´»ï¼</p>

<p>ğŸ è±ªåå¥–åŠ±ï¼š10ä¸‡å¯åŠ¨é‡‘ã€æ‹‰æ–¯ç»´åŠ æ–¯æŠ€æœ¯ä¹‹æ—…ã€é¡¶çº§èµ„æºåŠ æŒâ€¦â€¦ç”šè‡³è¿˜æœ‰â€œç¦…æ„æœºæ¢°é”®ç›˜â€å’Œâ€œå…¨çƒå¯ºåº™ç®—åŠ›åŠ æŒâ€ç­‰ä½ æ¥æ‹¿ï¼</p>

<p>â³ æœ¬æ¬¡å¤§èµ›éœ€è¦æ¥è‡ª Wechaty å¼€æºç¤¾åŒºçš„é€‰æ‰‹<strong>ä½¿ç”¨ AWS å’Œ Wechaty ä¸¤ä¸ªäº§å“</strong>æ¥æ‰“é€ å±äºè‡ªå·±åŸºäºå¤§æ¨¡å‹çš„åˆ›æ„ai ChatBotã€‚</p>

<p>ğŸ‘‰ ç«‹å³æŠ¥åï¼Œç”¨ä»£ç ç‚¹ç‡ƒæœªæ¥ï¼ä½ çš„æ¯ä¸€è¡Œçµæ„Ÿï¼Œéƒ½åœ¨é‡æ„ä¸–ç•Œçš„ç®—æ³•ï¼</p>

<p><a href="https://mp.weixin.qq.com/s/xhb-Z-pIqoZ5udIa7evq7A">é˜…è¯»åŸæ–‡</a></p>

<hr />

<blockquote>
  <p>This post is also available in <a href="/2025/05/23/wechaty-with-aws2025-en/">English</a>.</p>
</blockquote>]]></content><author><name>aiamber</name></author><category term="article" /><category term="aws" /><category term="ai" /><category term="chatbot" /><category term="competition" /><summary type="html"><![CDATA[ğŸ”¥ Wechaty &amp; AWS å…¨çƒæ‹›å‹Ÿï¼šåˆ›æ„ä¸ºç¬”ï¼Œç”¨ä»£ç ç•™ä¸‹æ°¸æ’å°è®°ï¼ ğŸ”¥ AIå¼€å‘å¤§èµ›é‡ç£…æ¥è¢­ï¼ä½ çš„ä»£ç ï¼Œæ”¹å˜ä¸–ç•Œï¼ é˜…è¯»åŸæ–‡]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2025/05-wechaty-with-aws2025-en/banner.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2025/05-wechaty-with-aws2025-en/banner.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">All Interfaces Are Becoming Conversational</title><link href="https://wechaty.js.org/2025/04/15/huans-conversation-law/" rel="alternate" type="text/html" title="All Interfaces Are Becoming Conversational" /><published>2025-04-15T00:00:00+00:00</published><updated>2025-04-15T00:00:00+00:00</updated><id>https://wechaty.js.org/2025/04/15/huans-conversation-law</id><content type="html" xml:base="https://wechaty.js.org/2025/04/15/huans-conversation-law/"><![CDATA[<blockquote>
  <p><strong>Atwoodâ€™s Law:</strong> â€œAny application that can be written in JavaScript, will eventually be written in JavaScript.â€</p>
</blockquote>

<p>Fifteen years ago, Jeff Atwood declared.</p>

<p>At the time, this was a bold assertion. Yet today, we see it realized in countless applications â€” from web-based versions of Photoshop to browser-run IDEs. The web became the universal platform, and JavaScript its lingua franca.</p>

<p>Now, we stand at the dawn of a new era: the age of <strong>conversational interfaces</strong>.</p>

<hr />

<h2 id="the-rise-of-conversational-interfaces">The Rise of Conversational Interfaces</h2>

<p>Consider <a href="https://www.linkedin.com/posts/joseph-michael_the-most-impressive-ai-demo-ive-seen-in-ugcPost-7317865648452198401-3bTF/">a recent demonstration shared by Joseph Michael on LinkedIn</a>. An AI agent assists a customer through voice, text, and video â€” understanding context, preferences, and even visual inputs to provide personalized recommendations and services.</p>

<p>This isnâ€™t a distant future â€” itâ€™s happening now.</p>

<p>Just as web applications once replaced desktop software, <strong>conversational interfaces</strong> are beginning to supplant traditional GUIs. The reasons are clear:</p>

<ul>
  <li><strong>Accessibility:</strong> Voice and text interfaces lower the barrier to entry for users of all ages and abilities.</li>
  <li><strong>Efficiency:</strong> Conversational agents can handle complex tasks through simple dialogues.</li>
  <li><strong>Personalization:</strong> AI-driven conversations adapt to individual user needs in real-time.</li>
</ul>

<hr />

<h2 id="huans-law">Huanâ€™s Law</h2>

<p>Inspired by Atwoodâ€™s Law, I propose:</p>

<blockquote>
  <p><strong>Huanâ€™s Law:</strong> â€œAny application that can be talked to, will eventually be talked to.â€</p>
</blockquote>

<p>Or simply:<br />
<strong>â€œAny app that can be talked to, will be talked to.â€</strong></p>

<p>This isnâ€™t just a predictionâ€”itâ€™s a reflection of where things are already heading.</p>

<p>From customer service bots to voice-activated home devices, <strong>conversational interfaces are becoming the norm</strong>.</p>

<hr />

<h2 id="embracing-the-shift">Embracing the Shift</h2>

<p>For developers and businesses, this shift presents both challenges and opportunities:</p>

<ul>
  <li><strong>Designing for Dialogue:</strong> Crafting intuitive conversational flows requires a new set of design principles.</li>
  <li><strong>Leveraging AI:</strong> Integrating natural language processing (NLP) and understanding (NLU) to create responsive agents.</li>
  <li><strong>Ensuring Privacy:</strong> Handling user data responsibly in conversational contexts.</li>
</ul>

<p>At <a href="https://wechaty.js.org/">Wechaty</a>, weâ€™ve been at the forefront of this transformation â€” providing tools and frameworks to build conversational agents efficiently.</p>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>The evolution of user interfaces is steering toward conversation.</p>

<p>As we embraced the web and JavaScript in the past, itâ€™s time to embrace conversational AI.</p>

<p>In the spirit of Huanâ€™s Law:<br />
<strong>If it can be talked to, it will be.</strong></p>

<hr />

<h2 id="sources">Sources</h2>

<ul>
  <li>Atwood, Jeff. <a href="https://blog.codinghorror.com/all-programming-is-web-programming/">â€œAll Programming is Web Programmingâ€</a></li>
  <li>Joseph Michael. <a href="https://www.linkedin.com/posts/joseph-michael_the-most-impressive-ai-demo-ive-seen-in-ugcPost-7317865648452198401-3bTF/">â€œThe most impressive AI demo Iâ€™ve seen in years.â€ (LinkedIn Post)</a></li>
</ul>]]></content><author><name>huan</name></author><category term="announcement" /><category term="law" /><summary type="html"><![CDATA[Huan's Law: 'Any app that can be talked to, will be talked to.' Explore the future of voice-first and conversational apps, where talking to technology becomes the norm.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2025/04-huans-conversation-law/huans-law.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2025/04-huans-conversation-law/huans-law.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">ğŸš€ Whatâ€™s the Best Transport for an Event-Driven Architecture: WebSocket or SSE + POST?</title><link href="https://wechaty.js.org/2025/04/04/best-transport-for-event-driven-architecture-websocket-or-sse-post/" rel="alternate" type="text/html" title="ğŸš€ Whatâ€™s the Best Transport for an Event-Driven Architecture: WebSocket or SSE + POST?" /><published>2025-04-04T00:00:00+00:00</published><updated>2025-04-04T00:00:00+00:00</updated><id>https://wechaty.js.org/2025/04/04/best-transport-for-event-driven-architecture-websocket-or-sse-post</id><content type="html" xml:base="https://wechaty.js.org/2025/04/04/best-transport-for-event-driven-architecture-websocket-or-sse-post/"><![CDATA[<p>As the creator of the <a href="https://github.com/wechaty/wechaty">Wechaty</a> and <a href="https://github.com/chatie">Chatie</a> projects, Iâ€™ve spent years building conversational and messaging tools for developers. Now, Iâ€™m investing in a new phase of <strong>cloud-native, event-driven infrastructure</strong> for Chatie, and I want to get the architecture right from day one.</p>

<p>For this next-generation system, Iâ€™m adopting:</p>

<ul>
  <li><strong>CQRS</strong> (Command Query Responsibility Segregation)</li>
  <li><strong>Event Sourcing</strong></li>
  <li><strong>Event-Driven Programming</strong></li>
</ul>

<p>These patterns enable scalable, modular systems with clear separation of concerns. But to tie it all together, I need a reliable, flexible, and efficient <strong>messaging transport</strong> â€” something that works both <strong>internally between services</strong>, and <strong>externally with clients</strong> (browsers, CLI tools, etc).</p>

<p>So the big question became:<br />
<strong>What transport should I use for streaming and event communication?</strong></p>

<hr />

<h2 id="-the-problem-choosing-a-universal-messaging-protocol">â“ The Problem: Choosing a Universal Messaging Protocol</h2>

<p>My goal is to design a <strong>universal communication layer</strong> that:</p>

<ol>
  <li>Works across <strong>cloud environments</strong> and <strong>local development</strong>.</li>
  <li>Supports <strong>event-driven</strong> messaging â€” sending and receiving updates in real-time.</li>
  <li>
    <p>Plays nicely with modern <strong>web clients</strong>, <strong>CLI</strong>, and <strong>microservices</strong>.</p>
  </li>
  <li>Allows <strong>stateless request handling</strong> (ideal for serverless and horizontally scalable systems).</li>
</ol>

<p>Naturally, <strong>WebSocket</strong> is a common choice for bi-directional, real-time communication. But is it the best choice for this use case? I decided to dive deeper and explore another approach: <strong>HTTP POST + Server-Sent Events (SSE)</strong> â€” especially after learning how the <a href="https://modelcontextprotocol.io/introduction">Model Context Protocol (MCP)</a> team made a similar decision.</p>

<hr />

<h2 id="-the-solution-http-post--sse-vs-websocket">âœ… The Solution: HTTP POST + SSE vs. WebSocket</h2>

<p>After extensive research and experimentation, Iâ€™ve decided to go with <strong>HTTP POST + Server-Sent Events (SSE)</strong> as the primary messaging transport for Chatie.</p>

<p>Letâ€™s break it down.</p>

<hr />

<h2 id="ï¸-comparing-websocket-vs-sse--post">âš–ï¸ Comparing WebSocket vs SSE + POST</h2>

<table>
  <thead>
    <tr>
      <th>Feature</th>
      <th>WebSocket</th>
      <th>HTTP POST + SSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Bi-directional</strong></td>
      <td>âœ… Full-duplex</td>
      <td>ğŸ”„ Half-duplex (Client sends via POST, Server streams via SSE)</td>
    </tr>
    <tr>
      <td><strong>Works with HTTP semantics (e.g., POST, headers)</strong></td>
      <td>âŒ No (only GET upgrade)</td>
      <td>âœ… Yes</td>
    </tr>
    <tr>
      <td><strong>Authentication (e.g., <code class="language-plaintext highlighter-rouge">Authorization</code> header)</strong></td>
      <td>âŒ Limited in browsers</td>
      <td>âœ… Fully supported</td>
    </tr>
    <tr>
      <td><strong>Browser support</strong></td>
      <td>âœ… Native WebSocket API</td>
      <td>âœ… Native EventSource API</td>
    </tr>
    <tr>
      <td><strong>Proxy/firewall friendliness</strong></td>
      <td>âš ï¸ Sometimes blocked</td>
      <td>âœ… Treated as normal HTTP</td>
    </tr>
    <tr>
      <td><strong>Ease of debugging</strong></td>
      <td>âš ï¸ Requires special tools</td>
      <td>âœ… Can use <code class="language-plaintext highlighter-rouge">curl</code>, browser, etc.</td>
    </tr>
    <tr>
      <td><strong>Stateless-friendly (serverless, scale-out)</strong></td>
      <td>âŒ Long-lived stateful connection</td>
      <td>âœ… Stateless POST + stream</td>
    </tr>
    <tr>
      <td><strong>Resumability (auto-reconnect)</strong></td>
      <td>âŒ Manual reconnection logic needed</td>
      <td>âœ… Built-in with EventSource</td>
    </tr>
    <tr>
      <td><strong>Complexity</strong></td>
      <td>âš ï¸ Needs upgrade handshake, framing</td>
      <td>âœ… Simple HTTP + text stream</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="-architecture-diagrams">ğŸ”§ Architecture Diagrams</h2>

<h3 id="websocket-architecture">WebSocket Architecture</h3>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Client &lt;======&gt; WebSocket Server
      [ Bi-directional | Long-lived connection ]
</code></pre></div></div>

<h3 id="sse--post-architecture">SSE + POST Architecture</h3>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Client --(POST)--&gt; Server
Client &lt;--(SSE)-- Server

      [ Stateless requests + Server-push stream ]
</code></pre></div></div>

<hr />

<h2 id="-code-examples">ğŸ’» Code Examples</h2>

<h3 id="sse--post-example-nodejs--express">SSE + POST Example (Node.js / Express)</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Server (Express)</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/run-tool</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Process the incoming command</span>
  <span class="kd">const</span> <span class="nx">toolInput</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

  <span class="nx">res</span><span class="p">.</span><span class="nf">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/event-stream</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nf">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cache-Control</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">no-cache</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nf">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Connection</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">keep-alive</span><span class="dl">'</span><span class="p">);</span>

  <span class="c1">// Simulate streaming output</span>
  <span class="kd">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nf">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">`data: Output at </span><span class="p">${</span><span class="k">new</span> <span class="nc">Date</span><span class="p">().</span><span class="nf">toISOString</span><span class="p">()}</span><span class="s2">\n\n`</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

  <span class="c1">// Stop after 5 seconds</span>
  <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">event: done</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">data: Stream complete</span><span class="se">\n\n</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">end</span><span class="p">();</span>
  <span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Client (Browser)</span>
<span class="kd">const</span> <span class="nx">evtSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EventSource</span><span class="p">(</span><span class="dl">'</span><span class="s1">/run-tool</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">evtSource</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Message:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">evtSource</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">done</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Stream completed</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">evtSource</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<hr />

<h2 id="-resources--references">ğŸ“š Resources &amp; References</h2>

<ul>
  <li>MCP GitHub PR on SSE vs WebSocket: <a href="https://github.com/modelcontextprotocol/specification/pull/206">https://github.com/modelcontextprotocol/specification/pull/206</a></li>
  <li>Durable Objects &amp; HTTP Streaming: <a href="https://blog.cloudflare.com/introducing-workers-durable-objects/#why-not-websockets">https://blog.cloudflare.com/introducing-workers-durable-objects/#why-not-websockets</a></li>
</ul>

<hr />

<h2 id="-conclusion">ğŸ§  Conclusion</h2>

<p>If youâ€™re building a <strong>real-time, event-driven system</strong>, itâ€™s easy to default to WebSockets. But before you do, consider whether you really need full-duplex communication.</p>

<p>For most <strong>CQRS</strong>, <strong>event-sourcing</strong>, and <strong>cloud-native</strong> use cases â€” where clients <strong>send a command</strong> and <strong>receive streamed events</strong> â€” a combination of <strong>HTTP POST + SSE</strong> gives you the best of both worlds:</p>

<ul>
  <li>Clean request/response semantics</li>
  <li>Streaming real-time updates</li>
  <li>Low complexity and broad compatibility</li>
</ul>

<p>This is why <strong>Chatie will be built on SSE + POST</strong>, and I believe itâ€™s a powerful, underused pattern that deserves more attention in the developer community.</p>

<hr />

<p>ğŸ’¬ Iâ€™d love to hear your thoughts! Have you used SSE or WebSockets in your projects? What challenges did you face? Letâ€™s chat in the comments or <a href="https://github.com/chatie">on GitHub</a>.</p>]]></content><author><name>huan</name></author><category term="event" /><category term="event-driven" /><category term="cqrs" /><category term="cloud-native" /><summary type="html"><![CDATA[As the creator of the Wechaty and Chatie projects, Iâ€™ve spent years building conversational and messaging tools for developers. Now, Iâ€™m investing in a new phase of cloud-native, event-driven infrastructure for Chatie, and I want to get the architecture right from day one.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2025/04-best-transport-for-event-driven-architecture-websocket-or-sse-post/sse-post-websocket.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2025/04-best-transport-for-event-driven-architecture-websocket-or-sse-post/sse-post-websocket.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">AWS with Wechaty | AWS Generative AI Application Challenge Kicks Off!</title><link href="https://wechaty.js.org/2024/04/25/wechaty-with-aws2024-en/" rel="alternate" type="text/html" title="AWS with Wechaty | AWS Generative AI Application Challenge Kicks Off!" /><published>2024-04-25T00:00:00+00:00</published><updated>2024-04-25T00:00:00+00:00</updated><id>https://wechaty.js.org/2024/04/25/wechaty-with-aws2024-en</id><content type="html" xml:base="https://wechaty.js.org/2024/04/25/wechaty-with-aws2024-en/"><![CDATA[<p>âœ¨ <strong>The 2nd China Generative AI Innovation Application Challenge</strong> âœ¨</p>

<h2 id="about-the-challenge">About the Challenge</h2>

<p>The 2nd China Generative AI Innovation Application Challenge is a competition for developers to create their own generative AI applications. The competition is jointly organized by AWS and Wechaty.</p>

<h2 id="the-competition">The Competition</h2>

<p>The competition is divided into two tracks:</p>

<ol>
  <li><strong>Creative Track:</strong> In this track, you can create any kind of generative AI application you want.</li>
  <li><strong>Technical Track:</strong> In this track, you need to use AWSâ€™s AI technology to create a generative AI application.</li>
</ol>

<h2 id="the-prize">The Prize</h2>

<p>The prize for the competition is as follows:</p>

<ul>
  <li><strong>First Prize:</strong> 100,000 RMB</li>
  <li><strong>Second Prize:</strong> 50,000 RMB</li>
  <li><strong>Third Prize:</strong> 20,000 RMB</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>The 2nd China Generative AI Innovation Application Challenge is a great opportunity for developers to show their creativity and skills. I believe that in the future, there will be more and more competitions like this.</p>]]></content><author><name>aiamber</name></author><category term="article" /><category term="aws" /><category term="ai" /><category term="chatbot" /><category term="competition" /><summary type="html"><![CDATA[âœ¨ The 2nd China Generative AI Innovation Application Challenge âœ¨]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2024/04-wechaty-with-aws2024-en/main.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2024/04-wechaty-with-aws2024-en/main.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">AWS with Wechaty | AWS ç”Ÿæˆå¼ AI åº”ç”¨æŒ‘æˆ˜èµ›é‡ç£…æ¥è¢­ï¼</title><link href="https://wechaty.js.org/2024/04/25/wechaty-with-aws2024/" rel="alternate" type="text/html" title="AWS with Wechaty | AWS ç”Ÿæˆå¼ AI åº”ç”¨æŒ‘æˆ˜èµ›é‡ç£…æ¥è¢­ï¼" /><published>2024-04-25T00:00:00+00:00</published><updated>2024-04-25T00:00:00+00:00</updated><id>https://wechaty.js.org/2024/04/25/wechaty-with-aws2024</id><content type="html" xml:base="https://wechaty.js.org/2024/04/25/wechaty-with-aws2024/"><![CDATA[<p>âœ¨ <strong>ç¬¬äºŒå±Šä¸­å›½ç”Ÿæˆå¼ AI åˆ›æ–°åº”ç”¨æŒ‘æˆ˜èµ›</strong> âœ¨
è§è¯ä¸‹ä¸€æ‰¹ç‹¬è§’å…½çš„è¯ç”Ÿï¼
<a href="https://mp.weixin.qq.com/s/kDyn9qL54jr7NCKg--RIvA">é˜…è¯»åŸæ–‡</a></p>

<p>ç¬¬äºŒå±Šä¸­å›½ç”Ÿæˆå¼ AI åº”ç”¨åˆ›æ–°æŒ‘æˆ˜èµ›æ‹‰å¼€å¸·å¹•ï¼</p>

<p>è·å¾—ä¸šå†…ä¸€è‡´å¥½è¯„çš„</p>

<p><strong>â€œä¸­å›½ç”Ÿæˆå¼ AI åº”ç”¨åˆ›æ–°æŒ‘æˆ˜èµ›â€</strong>åˆæ¥å•¦ï¼</p>

<p>åœ¨å»å¹´ï¼Œäºšé©¬é€Šäº‘ç§‘æŠ€è”åˆæ¸…åå¤§å­¦åŸºç¡€æ¨¡å‹ä¸­å¿ƒå’Œä¼—å¤šç”Ÿæˆå¼ AI å¤´éƒ¨æœºæ„ä¸¾åŠäº†é¦–å±Šâ€œä¸­å›½ç”Ÿæˆå¼ AI åº”ç”¨åˆ›æ–°æŒ‘æˆ˜èµ›â€ï¼Œå¸å¼•äº†<strong>è¶…è¿‡600åæ¥è‡ªä¸åŒè¡Œä¸šçš„å¼€å‘è€…ä¸åˆ›ä¸šè€…</strong>å‚ä¸ï¼Œå¹¶å¸®åŠ©è¿™äº›å¼€å‘è€…åˆ©ç”¨äºšé©¬é€Šäº‘ç§‘æŠ€ä»¥åŠåˆä½œä¼ä¸šçš„ç”Ÿæˆå¼ AI æœåŠ¡ï¼Œæ„å»ºäº†<strong>è¶…è¿‡140ä¸ªç”Ÿæˆå¼ AI åˆ›æ–°é¡¹ç›®</strong>ã€‚</p>

<p>ä»æœ¬æœˆä¸­æ—¬å¼€å§‹ï¼Œæœ¬å±ŠæŒ‘æˆ˜èµ›æºæ‰‹ Wechaty ç­‰å¼€æºç¤¾åŒºï¼Œå¹¶è”åˆ<strong>äºšé©¬é€Šäº‘ç§‘æŠ€åˆåˆ›ç”Ÿæ€</strong>åŠä¼—å¤šä¸­å›½ç”Ÿæˆå¼ AI é¢†åŸŸç‹¬è§’å…½ï¼Œæ‰“é€ ç”Ÿæˆå¼ AI é¢†åŸŸçš„æ˜æ˜Ÿèµ›äº‹ã€‚</p>

<h2 id="èµ›é¢˜ç®€ä»‹">èµ›é¢˜ç®€ä»‹</h2>

<p>æ‰€æœ‰æŠ¥åé€‰æ‰‹å°†é€šè¿‡å­¦ä¹ æœ¬æ¬¡æ¯”èµ›å‘å¸ƒçš„ä¸€ç³»åˆ—è¯¾ç¨‹ï¼ŒæŒæ¡ç”Ÿæˆå¼ AI æŠ€æœ¯çš„æ ¸å¿ƒç†è®ºå’Œå®è·µå·¥å…·ï¼Œå®Œæˆå¤æ‚çš„ç”Ÿæˆå¼ AI åº”ç”¨åˆ›æ–°ã€‚å‚èµ›è€…éœ€è¦é€‰æ‹©åˆé€‚çš„å¤§æ¨¡å‹ä½œä¸ºåº”ç”¨æ ¸å¿ƒï¼Œæ ¹æ®è‡ªå·±çš„å…´è¶£å’Œåˆ›æ„ï¼Œé€‰æ‹©ä¸åŒçš„è¡Œä¸šä»»åŠ¡é¢†åŸŸï¼ˆå¦‚å‡ºæµ·ã€ç”µå•†ã€æ•™è‚²ã€å¨±ä¹ã€åŒ»ç–—ã€é‡‘èç­‰ï¼‰ï¼Œè®¾è®¡å‡ºå…¼é¡¾æ•ˆç‡å’Œæˆæœ¬ã€æœ‰ä»·å€¼çš„ç”Ÿæˆå¼ AI åº”ç”¨ã€‚</p>

<p>æœ¬æ¬¡å¤§èµ›éœ€è¦æ¥è‡ª Wechaty å¼€æºç¤¾åŒºçš„é€‰æ‰‹<strong>ä½¿ç”¨ AWS å’Œ Wechaty ä¸¤ä¸ªäº§å“</strong>æ¥æ‰“é€ å±äºè‡ªå·±åŸºäºå¤§æ¨¡å‹çš„åˆ›æ„ai ChatBotï¼Œè€Œå¤§èµ›å®˜æ–¹ä¸ºé€‰æ‰‹ä»¬æä¾›çš„ä¸ä»…æ˜¯ä¸€ä¸ªå…¨æ–°çš„AIèƒ½åŠ›å¹³å°ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªèƒ½å¤Ÿä¸å„è·¯å¥½æ‰‹ä¸€è¾ƒé«˜ä¸‹çš„èˆå°ã€‚é‚£ä¹ˆè¿™ä¸¤å¤§å¼€æºäº§å“æœ‰å“ªäº›èƒ½åŠ›å‘¢ï¼Ÿ</p>

<p>æ— è®ºä½ æ˜¯åˆ›ä¸šè€…è¿˜æ˜¯å¼€å‘è€…ï¼Œéƒ½å¯ä»¥åœ¨æœ¬æ¬¡èµ›äº‹ä¸­å¿«é€Ÿä»å­¦ä¹ åˆ°æ„å»ºã€‚æˆ‘ä»¬å°†åœ¨æµ·é€‰é˜¶æ®µæ™‹çº§20æ”¯ä¼˜èƒœé˜Ÿä¼ï¼Œå‚ä¸5æœˆ30æ—¥<strong>åœ¨äºšé©¬é€Šäº‘ç§‘æŠ€ä¸­å›½å³°ä¼šçš„èˆå°ä¸Šçš„æ€»å†³èµ›è·¯æ¼”</strong>ï¼Œå‘ä¸šå†…é¡¶å°–çš„æŠ€æœ¯ä¸“å®¶ä¸æŠ•èµ„æœºæ„å±•ç°æ‚¨çš„ä½œå“ã€‚</p>

<p>ç›®å‰è¯¥èµ›äº‹å·²ç»å¼€æ”¾æŠ¥åå’Œä½œå“æäº¤ï¼Œ<strong>æ‰«æä¸‹æ–¹äºŒç»´ç ï¼Œç«‹å³æŠ¥åå‚èµ›ï¼</strong>
<img src="/assets/2024/04-wechaty-with-aws2024-en/qrcode.webp" alt="qrcode" /></p>

<h2 id="èµ›äº‹å¥–åŠ±">èµ›äº‹å¥–åŠ±</h2>

<p><img src="/assets/2024/04-wechaty-with-aws2024-en/awards.webp" alt="awards" /></p>

<h2 id="èµ›ç¨‹å®‰æ’">èµ›ç¨‹å®‰æ’</h2>

<p><img src="/assets/2024/04-wechaty-with-aws2024-en/schedule.webp" alt="schedule" /></p>

<h2 id="èµ›äº‹ç»„ç»‡">èµ›äº‹ç»„ç»‡</h2>

<p><img src="/assets/2024/04-wechaty-with-aws2024-en/org.webp" alt="org" /></p>

<h3 id="aws">AWS</h3>

<p>Amazon Web Servicesï¼ˆAWSï¼‰æ˜¯å…¨çƒæœ€å…¨é¢ã€åº”ç”¨æœ€å¹¿æ³›çš„äº‘ï¼Œä»å…¨çƒæ•°æ®ä¸­å¿ƒæä¾›è¶…è¿‡ 200 é¡¹åŠŸèƒ½é½å…¨çš„æœåŠ¡ã€‚æ•°ç™¾ä¸‡å®¢æˆ·ï¼ˆåŒ…æ‹¬å¢é•¿æœ€å¿«é€Ÿçš„åˆåˆ›å…¬å¸ã€æœ€å¤§å‹ä¼ä¸šå’Œä¸»è¦çš„æ”¿åºœæœºæ„ï¼‰éƒ½åœ¨ä½¿ç”¨ AWS æ¥é™ä½æˆæœ¬ã€æé«˜æ•æ·æ€§å¹¶åŠ é€Ÿåˆ›æ–°ã€‚</p>

<p>ä½“éªŒ AWS è¯·å‰å¾€ï¼š<a href="https://aws.amazon.com/cn/what-is-aws/?nc1=f_cc">AWSäº‘è®¡ç®—</a></p>

<h3 id="wechaty">Wechaty</h3>

<p>Wechaty æ˜¯ä¸€ä¸ªå¼€æºèŠå¤©æœºå™¨äººæ¡†æ¶SDKï¼Œå…·æœ‰å¤šå¹³å°ã€å¤šè¯­è¨€å’Œå¤šæ’ä»¶çš„ç‰¹æ€§ï¼Œæ”¯æŒPython, Go, Java, Scala, .NET, PHP, Rust ç­‰å¤šè¯­è¨€ç‰ˆæœ¬ï¼Œé€šè¿‡å‡ è¡Œä»£ç å³å¯åˆ›å»ºä¸€ä¸ªèŠå¤©æœºå™¨äººã€‚ç»è¿‡5å¹´å¤šçš„å‘å±•ï¼Œç°åœ¨Wechatyå¼€æºç¤¾åŒºå·²æ‹¥æœ‰æ•°åä½Committersï¼Œç™¾ä½™ä½Contributorsï¼Œå¹¶è¢«ä¸‡åGithubå¼€å‘è€…Starã€‚ç›®å‰ï¼ŒWechatyçš„å¼€å‘è€…å·²éå¸ƒå…¨çƒå¤šä¸ªå›½å®¶å’Œåœ°åŒºï¼Œè¦†ç›–æ•°ä¸‡äººï¼Œæ˜¯å›½å†…æœ€æ´»è·ƒçš„Conversational AI Chatbot å¼€å‘è€…ç¤¾åŒºã€‚</p>

<p>Wechatyçš„ä¼˜åŠ¿åœ¨äºå¯¹ä»£ç è´¨é‡åœ°ç®¡ç†ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨äº†Github Actionsåœ°DevOpså·¥å…·å®Œæˆäº†CI/CDå·¥ä½œæµï¼Œä»è‡ªåŠ¨åŒ–å•å…ƒæµ‹è¯•åˆ°è‡ªåŠ¨æ‰“åŒ…é›†æˆæµ‹è¯•ï¼Œä»è‡ªåŠ¨å‘å¸ƒNPMåŒ…åˆ°è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒå¯¹åº”ç‰ˆæœ¬åœ°Docker Imageï¼Œå®ç°äº†å…¨è‡ªåŠ¨åœ°ç¤¾åŒºä»£ç å‘å¸ƒï¼Œæå¤§åœ°æé«˜äº†ç¤¾åŒºåœ°ååŒæ•ˆç‡ã€‚</p>

<p>ç›®å‰ï¼Œåœ¨Githubä¸Šå·²æœ‰åƒä½™ä¸ªå¼€æºé¡¹ç›®åŸºäºWechatyæ„å»ºäº†èŠå¤©æœºå™¨äººã€‚å¦å¤–ï¼ŒWechatyç»Ÿä¸€äº†å³æ—¶é€šè®¯è½¯ä»¶å¹³å°çš„å¯¹è¯æ¥å£ï¼Œä»…éœ€è¦ä¸€å¥—ä»£ç å³å¯è¿è¡Œåœ¨å¤šä¸ªå¹³å°ä¹‹ä¸Šï¼Œç›®å‰å·²æˆç†Ÿé«˜æ•ˆåœ°æ¨åŠ¨äº†åŒ…æ‹¬ç¤¾ç¾¤ç®¡ç†ã€æ•°æ®è¿ç»´ã€åŠå…¬ã€èµ„è®¯ã€å¹¿å‘Šã€è¥é”€ç­‰å¤šä¸ªé¢†åŸŸä¸åŒå®ç”¨åœºæ™¯çš„è½åœ°ã€‚</p>

<p>æœºé‡ç¨çºµå³é€ï¼Œä½ è¿˜åœ¨ç­‰ä»€ä¹ˆï¼Ÿç°åœ¨å°±è¡ŒåŠ¨å§ï¼Œå¡«å†™æŠ¥åä¿¡æ¯ã€‚ç¿˜é¦–ä»¥å¾…ä½ çš„åˆ°æ¥ï¼Œèµ¢å–è¿™åœºæŒ‘æˆ˜èµ›çš„æ¡‚å† è£è€€ï¼</p>

<p>âœ¨ æ¯”èµ›çš„æˆ˜é¼“å·²ç»æ“‚å“</p>

<p>âœ¨ æ¬¢è¿æ‚¨æŠ¥åå‚èµ›</p>

<p>âœ¨ åœ¨äºšé©¬é€Šäº‘ç§‘æŠ€ä¸­å›½å³°ä¼šç°åœºå·…å³°ç›¸è§</p>

<p>âœ¨ å…±åŒçªç ´æé™ï¼Œä¸º AI è€Œæˆ˜ï¼</p>

<p><a href="https://mp.weixin.qq.com/s/kDyn9qL54jr7NCKg--RIvA">é˜…è¯»åŸæ–‡</a></p>]]></content><author><name>aiamber</name></author><category term="article" /><category term="aws" /><category term="ai" /><category term="chatbot" /><category term="competition" /><summary type="html"><![CDATA[âœ¨ ç¬¬äºŒå±Šä¸­å›½ç”Ÿæˆå¼ AI åˆ›æ–°åº”ç”¨æŒ‘æˆ˜èµ› âœ¨ è§è¯ä¸‹ä¸€æ‰¹ç‹¬è§’å…½çš„è¯ç”Ÿï¼ é˜…è¯»åŸæ–‡]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2024/04-wechaty-with-aws2024-en/main.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2024/04-wechaty-with-aws2024-en/main.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Building an Intelligent Medical WeChat Bot with Dify, GPT-4 Turbo, and Wechaty</title><link href="https://wechaty.js.org/2024/03/30/wechatbot-with-wechaty-dify-gpt4-en/" rel="alternate" type="text/html" title="Building an Intelligent Medical WeChat Bot with Dify, GPT-4 Turbo, and Wechaty" /><published>2024-03-30T00:00:00+00:00</published><updated>2024-03-30T00:00:00+00:00</updated><id>https://wechaty.js.org/2024/03/30/wechatbot-with-wechaty-dify-gpt4-en</id><content type="html" xml:base="https://wechaty.js.org/2024/03/30/wechatbot-with-wechaty-dify-gpt4-en/"><![CDATA[<blockquote>
  <p>Author: <a href="https://github.com/gscfwid/">gscfwid</a>, An anesthetist in a big ship of mainland.</p>
</blockquote>

<p>Hello everyone, Iâ€™m a doctor and also a technology enthusiast. Today Iâ€™d like to share with you my recent project â€” building an intelligent Agent based on GPT-4 Turbo using Dify to implement an advanced WeChat chatbot.</p>

<h2 id="why-choose-a-wechat-bot">Why Choose a WeChat Bot</h2>

<p>First, let me explain why I wanted to build this bot. As a doctor, one of my important tasks is following up with patients to understand their postoperative recovery. Our hospital performs 70,000-80,000 surgeries annually, making manual phone follow-ups very impractical. Moreover, telecom carriers now have strict restrictions on phone calls. I found that for patients, WeChat might be a more acceptable follow-up method because it doesnâ€™t feel as intrusive to their daily lives.</p>

<h2 id="why-choose-wechaty">Why Choose Wechaty</h2>

<p>However, most WeChat bot frameworks on the market are based on the web protocol, which is currently largely unusable. For example, although Wechaty can utilize the web protocol preserved on UOS, it cannot obtain permanent IDs, remarks, tags, and other data, which is very disadvantageous for follow-up work. After trying the padlocal protocol, I found it very suitable for my needs.</p>

<h2 id="why-choose-dify">Why Choose Dify</h2>

<p>Next, I want to talk about why I chose to use Dify to build this bot. First, I hoped this bot would not only complete follow-up tasks but also serve as a medical education bot for patients. With the explosion of large language models, this idea became very easy to implement. Using Wechaty and the large model API, I quickly conceived a preliminary framework.</p>

<p>Dify is a well-known large model Agent platform. Its API encapsulation is much more friendly than OpenAIâ€™s official API, especially in terms of prompt construction and conversation thread maintenance. Although OpenAI can also build assistants, maintaining conversations doesnâ€™t seem as easy. Additionally, the Dify platform itself has built some plugins, such as Google Search, which can be easily integrated into the API. Therefore, I ultimately chose Dify as my development platform.</p>

<p>The above is some background and thinking behind developing this medical follow-up WeChat bot. As a doctor and technical novice, I hope that by sharing my project experience, I can bring some inspiration and food for thought to everyone. In the following sections, Iâ€™ll discuss some technical details of this bot. I welcome everyoneâ€™s valuable opinions and suggestions.</p>

<h2 id="creating-a-gpt-4-turbo-based-model-through-dify">Creating a GPT-4 Turbo-Based Model Through Dify</h2>

<p>Dify provides a simple and easy-to-use interface that allows me to quickly create and test models.</p>

<p>First, I created a new application on the Dify platform and selected GPT-4 Turbo as the base model. In this initial phase, I temporarily didnâ€™t use any custom prompts or plugins â€” I just wanted to do a simple test first to see how the model performs.</p>

<p>After creating the application, Dify automatically generates an API key, which we can use to call Difyâ€™s API interface and interact with the intelligent conversation model we created.</p>

<h2 id="implementing-the-wechat-bot-with-wechaty">Implementing the WeChat Bot with Wechaty</h2>

<p>With the intelligent conversation model in place, we next need a platform to implement the WeChat bot and integrate the model into WeChat. Here I chose Wechaty. Wechaty is an open-source conversational bot SDK that supports personal WeChat accounts, built with Node.js and TypeScript.</p>

<p>Below is my code implementation, mainly divided into the following parts:</p>

<p>First, I use wechaty-puppet-padlocal as Wechatyâ€™s Puppet Provider. It connects to WeChat through the iPad protocol, which is more stable and reliable compared to the Web protocol. Then I use WechatyBuilder to build our bot instance.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Initialize Wechaty</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">PuppetPadlocal</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">wechaty-puppet-padlocal</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">WechatyBuilder</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">wechaty</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">puppet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PuppetPadlocal</span><span class="p">({</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PUPPET_PADLOCAL_TOKEN</span><span class="p">,</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">bot</span> <span class="o">=</span> <span class="nx">WechatyBuilder</span><span class="p">.</span><span class="nf">build</span><span class="p">({</span> <span class="nx">puppet</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span> <span class="p">});</span>
</code></pre></div></div>

<p>Next is the core function for calling the Dify API. I use the axios library to send a POST request to Difyâ€™s API endpoint, passing in the userâ€™s input message, conversation ID, and other parameters, and authenticating with the API Key. Dify returns the reply generated by the intelligent conversation model.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Function to call Dify API</span>
<span class="kd">const</span> <span class="nx">difyApiKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DIFY_API_KEY</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">difyApiUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://api.dify.ai/v1/chat-messages</span><span class="dl">"</span><span class="p">;</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">sendMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">userName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span>
      <span class="nx">difyApiUrl</span><span class="p">,</span>
      <span class="p">{</span>
        <span class="na">inputs</span><span class="p">:</span> <span class="p">{},</span>
        <span class="na">query</span><span class="p">:</span> <span class="nx">message</span><span class="p">,</span>
        <span class="na">response_mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">streaming</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">conversation_id</span><span class="p">:</span> <span class="nx">conversationData</span><span class="p">.</span><span class="nx">conversationId</span><span class="p">,</span>
        <span class="na">user</span><span class="p">:</span> <span class="nx">userName</span><span class="p">,</span>
        <span class="na">files</span><span class="p">:</span> <span class="p">[],</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">Authorization</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">difyApiKey</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">}</span>
    <span class="p">);</span>
    <span class="c1">// Process response...</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">Dify API responded with status code:</span><span class="dl">"</span><span class="p">,</span>
        <span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span>
      <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">No response received from Dify API:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error setting up request to Dify API:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Handle error appropriately...</span>
  <span class="p">}</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Finally, I listen to Wechatyâ€™s message event. When receiving a message from a user @mentioning the bot in a group chat, I extract the message content, call the sendMessage function to get the intelligent reply, and then send the reply to the group chat through room.say.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Listen to message events</span>
<span class="nx">bot</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Get information about the message sender</span>
  <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nf">talker</span><span class="p">().</span><span class="nx">id</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">room</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nf">room</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">userName</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nf">name</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nf">text</span><span class="p">();</span>
  <span class="c1">// Check if it's in my already created SQLite database</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">room</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">SELECT * FROM contacts WHERE id = ?</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">row</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">[</span><span class="nx">id</span><span class="p">]);</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">row</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">reply</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">sendMessage</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">userName</span><span class="p">);</span>
        <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nf">talker</span><span class="p">().</span><span class="nf">say</span><span class="p">(</span><span class="nx">reply</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>One important point to emphasize here is that I use the conversation_id in the Dify API to implement the conversation persistence feature. This part of the code is mainly in the sendMessage function:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">conversationMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Map</span><span class="p">();</span> <span class="c1">// Create a key-value pair to save questioner information and conversation_id</span>
<span class="kd">const</span> <span class="nx">CONVERSATION_EXPIRATION</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span> <span class="c1">// Set conversation retention time to 5 minutes</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nf">sendMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">userName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="kd">let</span> <span class="nx">conversationData</span> <span class="o">=</span> <span class="nx">conversationMap</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">userName</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">();</span>

  <span class="c1">// If the conversation doesn't exist or has expired, create a new conversation</span>
  <span class="k">if </span><span class="p">(</span>
    <span class="o">!</span><span class="nx">conversationData</span> <span class="o">||</span>
    <span class="nx">timestamp</span> <span class="o">-</span> <span class="nx">conversationData</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">&gt;</span> <span class="nx">CONVERSATION_EXPIRATION</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="nx">conversationData</span> <span class="o">=</span> <span class="p">{</span> <span class="na">conversationId</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">timestamp</span> <span class="p">};</span>
    <span class="nx">conversationMap</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">userName</span><span class="p">,</span> <span class="nx">conversationData</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span>
    <span class="nx">difyApiUrl</span><span class="p">,</span>
    <span class="p">{</span>
      <span class="c1">// ...</span>
      <span class="na">conversation_id</span><span class="p">:</span> <span class="nx">conversationData</span><span class="p">.</span><span class="nx">conversationId</span><span class="p">,</span>
      <span class="na">user</span><span class="p">:</span> <span class="nx">userName</span><span class="p">,</span>
      <span class="c1">// ...</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
  <span class="p">);</span>

  <span class="c1">// Update conversation ID and timestamp</span>
  <span class="nx">conversationData</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">timestamp</span><span class="p">;</span>

  <span class="c1">// ...</span>
  <span class="c1">// The following code is needed because I'm using stream mode to get Dify's response, so I need to traverse each reply to find the final response content</span>
  <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">line</span> <span class="k">of</span> <span class="nx">lines</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="dl">"</span><span class="s2">data:</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nf">trim</span><span class="p">());</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">event</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">agent_thought</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nx">conversationData</span><span class="p">.</span><span class="nx">conversationId</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">conversation_id</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Through this approach, we can maintain an independent conversation context for each user, implementing multi-turn dialogues. When users continue to send messages within a certain time period (set to 5 minutes here), the context remains coherent; if this time is exceeded, a new conversation begins.</p>

<p>The next steps are all on the Dify platform, which Iâ€™m still working on. My vision is to upload health education articles downloaded from the web as a knowledge base and limit GPT-4 to only answer from the knowledge base. Anyway, thatâ€™s beyond the scope of technical discussion.</p>

<p>The above is the core code for implementing an intelligent WeChat conversation bot using Dify and Wechaty. Through Difyâ€™s powerful conversation model and Wechatyâ€™s convenient WeChat integration, we can quickly build a practical medical education bot. Of course, this is just a basic version. We can continue to add more features, such as custom prompts and knowledge base search, to further enhance the botâ€™s intelligence level.</p>

<hr />

<blockquote>
  <p>æœ¬æ–‡ä¹Ÿæœ‰<a href="/2024/03/30/wechatbot-with-wechaty-dify-gpt4/">ä¸­æ–‡ç‰ˆæœ¬</a>ã€‚</p>
</blockquote>]]></content><author><name>gscfwid</name></author><category term="article" /><category term="dify" /><category term="gpt4-turbo" /><category term="ecosystem" /><summary type="html"><![CDATA[Building an intelligent medical follow-up and health education WeChat bot using Dify's GPT-4 Turbo Agent platform and Wechaty, featuring conversation context management and knowledge base integration.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2024/03-wechatbot-with-wechaty-dify-gpt4-en/bp-post.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2024/03-wechatbot-with-wechaty-dify-gpt4-en/bp-post.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">åˆ©ç”¨ Dify æ„å»ºåŸºäº GPT-4 Turbo çš„æ™ºèƒ½ Agent,å®ç°åŒ»ç–—å¾®ä¿¡æœºå™¨äºº</title><link href="https://wechaty.js.org/2024/03/30/wechatbot-with-wechaty-dify-gpt4/" rel="alternate" type="text/html" title="åˆ©ç”¨ Dify æ„å»ºåŸºäº GPT-4 Turbo çš„æ™ºèƒ½ Agent,å®ç°åŒ»ç–—å¾®ä¿¡æœºå™¨äºº" /><published>2024-03-30T00:00:00+00:00</published><updated>2024-03-30T00:00:00+00:00</updated><id>https://wechaty.js.org/2024/03/30/wechatbot-with-wechaty-dify-gpt4</id><content type="html" xml:base="https://wechaty.js.org/2024/03/30/wechatbot-with-wechaty-dify-gpt4/"><![CDATA[<blockquote>
  <p>ä½œè€…: <a href="https://github.com/gscfwid/">gscfwid</a>ï¼ŒAn anesthetist in a big ship of mainland.</p>
</blockquote>

<p>å¤§å®¶å¥½,æˆ‘æ˜¯ä¸€ååŒ»ç”Ÿ,åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæŠ€æœ¯çˆ±å¥½è€…ã€‚ä»Šå¤©æˆ‘æƒ³å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹æˆ‘æœ€è¿‘çš„ä¸€ä¸ªé¡¹ç›®â€”â€”åˆ©ç”¨ Dify æ„å»ºåŸºäº GPT-4 Turbo çš„æ™ºèƒ½ Agent,å®ç°é«˜çº§å¾®ä¿¡èŠå¤©æœºå™¨äººã€‚</p>

<h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©å¾®ä¿¡æœºå™¨äºº">ä¸ºä»€ä¹ˆé€‰æ‹©å¾®ä¿¡æœºå™¨äºº</h2>

<p>é¦–å…ˆ,æˆ‘æƒ³è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªæœºå™¨äººã€‚ä½œä¸ºä¸€ååŒ»ç”Ÿ,æˆ‘çš„ä¸€é¡¹é‡è¦å·¥ä½œæ˜¯éšè®¿ç—…äºº,äº†è§£ä»–ä»¬æœ¯åçš„æ¢å¤æƒ…å†µã€‚æˆ‘ä»¬åŒ»é™¢æ¯å¹´æœ‰ 7-8 ä¸‡çš„æ‰‹æœ¯é‡,äººå·¥ç”µè¯éšè®¿æ˜¯éå¸¸ä¸ç°å®çš„ã€‚è€Œä¸”,ç°åœ¨è¿è¥å•†å¯¹ç”µè¯çš„é™åˆ¶ä¹Ÿæ¯”è¾ƒä¸¥æ ¼ã€‚æˆ‘å‘ç°,å¯¹äºç—…äººæ¥è¯´,å¾®ä¿¡å¯èƒ½æ˜¯ä¸€ä¸ªæ›´å®¹æ˜“æ¥å—çš„éšè®¿æ–¹å¼,å› ä¸ºå®ƒä¸ä¼šæ˜¾å¾—æ‰“æ‰°åˆ°ä»–ä»¬çš„ç”Ÿæ´»ã€‚</p>

<h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©-wechaty">ä¸ºä»€ä¹ˆé€‰æ‹© Wechaty</h2>

<p>ç„¶è€Œ,å¸‚é¢ä¸Šå¤§å¤šæ•°å¾®ä¿¡æœºå™¨äººæ¡†æ¶éƒ½æ˜¯åŸºäº web åè®®çš„,è€Œç›®å‰ web åè®®åŸºæœ¬å¤„äºä¸å¯ç”¨çš„çŠ¶æ€ã€‚ä¾‹å¦‚,è™½ç„¶ wechaty å¯ä»¥åˆ©ç”¨ UOS ä¸Šä¿ç•™çš„ web åè®®,ä½†å®ƒæ— æ³•è·å–æ°¸ä¹…çš„ IDã€å¤‡æ³¨ã€tag ç­‰æ•°æ®,è¿™å¯¹éšè®¿å·¥ä½œéå¸¸ä¸åˆ©ã€‚åœ¨å°è¯•äº† padlocal åè®®å,æˆ‘è§‰å¾—å®ƒéå¸¸é€‚åˆæˆ‘çš„éœ€æ±‚ã€‚</p>

<h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©-dify">ä¸ºä»€ä¹ˆé€‰æ‹© Dify</h2>

<p>æ¥ä¸‹æ¥,æˆ‘æƒ³è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨ Dify æ¥æ„å»ºè¿™ä¸ªæœºå™¨äººã€‚é¦–å…ˆ,æˆ‘å¸Œæœ›è¿™ä¸ªæœºå™¨äººä¸ä»…èƒ½å®Œæˆéšè®¿ä»»åŠ¡,è¿˜èƒ½æˆä¸ºä¸€ä¸ªé¢å‘ç—…äººçš„åŒ»å­¦ç§‘æ™®æœºå™¨äººã€‚éšç€å¤§è¯­è¨€æ¨¡å‹çš„çˆ†å‘,è¿™ä¸ªæƒ³æ³•å˜å¾—éå¸¸å®¹æ˜“å®ç°ã€‚åˆ©ç”¨ wechaty å’Œå¤§æ¨¡å‹çš„ API,æˆ‘å¾ˆå¿«å°±æ„æ€å‡ºäº†ä¸€ä¸ªåˆæ­¥çš„æ¡†æ¶ã€‚</p>

<p>Dify æ˜¯ä¸€ä¸ªçŸ¥åçš„å¤§æ¨¡å‹ Agent å¹³å°,å®ƒå¯¹ API çš„å°è£…è¦æ¯” OpenAI å®˜æ–¹çš„ API æ›´åŠ å‹å¥½,ä¾‹å¦‚åœ¨ prompt çš„æ„å»ºå’Œå¯¹è¯çº¿ç¨‹çš„ä¿æŒæ–¹é¢ã€‚è™½ç„¶ OpenAI ä¹Ÿå¯ä»¥æ„å»º assistant,ä½†æ˜¯ä¿æŒå¯¹è¯ä¼¼ä¹æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“ã€‚å¦å¤–,Dify å¹³å°æœ¬èº«ä¹Ÿæ„å»ºäº†ä¸€äº›æ’ä»¶,æ¯”å¦‚ Google æœç´¢,å¯ä»¥å¾ˆå®¹æ˜“é›†æˆåˆ° API ä¸­ã€‚å› æ­¤,æˆ‘æœ€ç»ˆé€‰æ‹©äº† Dify ä½œä¸ºæˆ‘çš„å¼€å‘å¹³å°ã€‚
ä»¥ä¸Šå°±æ˜¯æˆ‘å¼€å‘è¿™ä¸ªå¾®ä¿¡åŒ»ç–—éšè®¿æœºå™¨äººçš„ä¸€äº›èƒŒæ™¯å’Œæ€è·¯ã€‚ä½œä¸ºä¸€ä¸ªåŒ»ç”Ÿå’ŒæŠ€æœ¯å°ç™½,æˆ‘å¸Œæœ›é€šè¿‡åˆ†äº«è‡ªå·±çš„é¡¹ç›®ç»å†,èƒ½ç»™å¤§å®¶å¸¦æ¥ä¸€äº›å¯å‘å’Œæ€è€ƒã€‚åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†,æˆ‘ä¼šå’Œå¤§å®¶èŠèŠè¿™ä¸ªæœºå™¨äººçš„ä¸€äº›æŠ€æœ¯ç»†èŠ‚,æ¬¢è¿å¤§å®¶æå‡ºå®è´µçš„æ„è§å’Œå»ºè®®ã€‚</p>

<h2 id="é€šè¿‡-dify-åˆ›å»ºåŸºäº-gpt-4-turbo-çš„æ¨¡å‹">é€šè¿‡ Dify åˆ›å»ºåŸºäº GPT-4 Turbo çš„æ¨¡å‹</h2>

<p>Dify æä¾›äº†ä¸€ä¸ªç®€å•æ˜“ç”¨çš„ç•Œé¢,è®©æˆ‘å¯ä»¥å¿«é€Ÿåœ°åˆ›å»ºå’Œæµ‹è¯•æ¨¡å‹ã€‚
é¦–å…ˆ,æˆ‘åœ¨ Dify å¹³å°ä¸Šåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„åº”ç”¨,å¹¶é€‰æ‹©äº† GPT-4 Turbo ä½œä¸ºåŸºç¡€æ¨¡å‹ã€‚åœ¨è¿™ä¸ªåˆå§‹é˜¶æ®µ,æˆ‘æš‚æ—¶æ²¡æœ‰ä½¿ç”¨ä»»ä½•è‡ªå®šä¹‰çš„ prompt æˆ–æ’ä»¶,åªæ˜¯æƒ³å…ˆåšä¸€ä¸ªç®€å•çš„æµ‹è¯•,çœ‹çœ‹æ¨¡å‹çš„æ€§èƒ½å¦‚ä½•ã€‚</p>

<p>åˆ›å»ºåº”ç”¨å,Dify ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª API å¯†é’¥(API key),æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯†é’¥æ¥è°ƒç”¨ Dify çš„ API æ¥å£,ä¸æˆ‘ä»¬åˆ›å»ºçš„æ™ºèƒ½å¯¹è¯æ¨¡å‹è¿›è¡Œäº¤äº’ã€‚</p>

<h2 id="ä½¿ç”¨-wechaty-å®ç°å¾®ä¿¡æœºå™¨äºº">ä½¿ç”¨ Wechaty å®ç°å¾®ä¿¡æœºå™¨äºº</h2>

<p>æœ‰äº†æ™ºèƒ½å¯¹è¯æ¨¡å‹,æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¹³å°æ¥å®ç°å¾®ä¿¡æœºå™¨äºº,å°†æ¨¡å‹é›†æˆåˆ°å¾®ä¿¡ä¸­ã€‚è¿™é‡Œæˆ‘é€‰æ‹©äº† Wechatyã€‚Wechaty æ˜¯ä¸€ä¸ªå¼€æºçš„å¯¹è¯æœºå™¨äºº SDK,æ”¯æŒä¸ªäººå¾®ä¿¡å·,ä½¿ç”¨ Node.js å’Œ TypeScript æ„å»ºã€‚</p>

<p>ä¸‹é¢æ˜¯æˆ‘çš„ä»£ç å®ç°,ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†:</p>

<p>é¦–å…ˆ,æˆ‘ä½¿ç”¨ wechaty-puppet-padlocal ä½œä¸º Wechaty çš„ Puppet Provider,å®ƒé€šè¿‡ iPad åè®®è¿æ¥å¾®ä¿¡,ç›¸æ¯” Web åè®®æ›´åŠ ç¨³å®šå¯é ã€‚ç„¶åä½¿ç”¨ WechatyBuilder æ¥æ„å»ºæˆ‘ä»¬çš„æœºå™¨äººå®ä¾‹ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åˆå§‹åŒ–Wechaty</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">PuppetPadlocal</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">wechaty-puppet-padlocal</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">WechatyBuilder</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">wechaty</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">puppet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PuppetPadlocal</span><span class="p">({</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PUPPET_PADLOCAL_TOKEN</span><span class="p">,</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">bot</span> <span class="o">=</span> <span class="nx">WechatyBuilder</span><span class="p">.</span><span class="nf">build</span><span class="p">({</span> <span class="nx">puppet</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span> <span class="p">});</span>
</code></pre></div></div>

<p>æ¥ä¸‹æ¥è°ƒç”¨ Dify API çš„æ ¸å¿ƒå‡½æ•°ã€‚æˆ‘ä½¿ç”¨ axios åº“å‘é€ POST è¯·æ±‚åˆ° Dify çš„ API ç«¯ç‚¹,ä¼ å…¥ç”¨æˆ·çš„è¾“å…¥æ¶ˆæ¯ã€å¯¹è¯ ID ç­‰å‚æ•°,å¹¶é€šè¿‡ API Key è¿›è¡Œèº«ä»½éªŒè¯ã€‚Dify ä¼šè¿”å›æ™ºèƒ½å¯¹è¯æ¨¡å‹ç”Ÿæˆçš„å›å¤ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// è°ƒç”¨Dify APIçš„å‡½æ•°</span>
<span class="kd">const</span> <span class="nx">difyApiKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DIFY_API_KEY</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">difyApiUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://api.dify.ai/v1/chat-messages</span><span class="dl">"</span><span class="p">;</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">sendMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">userName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span>
      <span class="nx">difyApiUrl</span><span class="p">,</span>
      <span class="p">{</span>
        <span class="na">inputs</span><span class="p">:</span> <span class="p">{},</span>
        <span class="na">query</span><span class="p">:</span> <span class="nx">message</span><span class="p">,</span>
        <span class="na">response_mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">streaming</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">conversation_id</span><span class="p">:</span> <span class="nx">conversationData</span><span class="p">.</span><span class="nx">conversationId</span><span class="p">,</span>
        <span class="na">user</span><span class="p">:</span> <span class="nx">userName</span><span class="p">,</span>
        <span class="na">files</span><span class="p">:</span> <span class="p">[],</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">Authorization</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">difyApiKey</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">}</span>
    <span class="p">);</span>
    <span class="c1">// Process response...</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">Dify API responded with status code:</span><span class="dl">"</span><span class="p">,</span>
        <span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span>
      <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">No response received from Dify API:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error setting up request to Dify API:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Handle error appropriately...</span>
  <span class="p">}</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æœ€å,æˆ‘ç›‘å¬ Wechaty çš„ message äº‹ä»¶,å½“æ”¶åˆ°ç”¨æˆ·åœ¨ç¾¤èŠä¸­@æœºå™¨äººçš„æ¶ˆæ¯æ—¶,æå–å‡ºæ¶ˆæ¯å†…å®¹,è°ƒç”¨ sendMessage å‡½æ•°è·å–æ™ºèƒ½å›å¤,ç„¶åé€šè¿‡ room.say å°†å›å¤å‘é€åˆ°ç¾¤èŠä¸­ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ç›‘å¬æ¶ˆæ¯äº‹ä»¶</span>
<span class="nx">bot</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// è·å–å‘æ¶ˆæ¯äººçš„ä¿¡æ¯</span>
  <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nf">talker</span><span class="p">().</span><span class="nx">id</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">room</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nf">room</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">userName</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nf">name</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nf">text</span><span class="p">();</span>
  <span class="c1">// åˆ¤æ–­å®ƒæ˜¯å¦åœ¨æˆ‘å·²ç»åˆ›å»ºå¥½çš„SQLiteæ•°æ®åº“ä¸­</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">room</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">SELECT * FROM contacts WHERE id = ?</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">row</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">[</span><span class="nx">id</span><span class="p">]);</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">row</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">reply</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">sendMessage</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">userName</span><span class="p">);</span>
        <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nf">talker</span><span class="p">().</span><span class="nf">say</span><span class="p">(</span><span class="nx">reply</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>è¿™é‡Œéœ€è¦å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘åˆ©ç”¨ Dify API ä¸­çš„ conversation_id æ¥å®ç°ä¿æŒå¯¹è¯çš„åŠŸèƒ½ã€‚è¿™éƒ¨åˆ†ä»£ç ä¸»è¦åœ¨ sendMessage å‡½æ•°ä¸­:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">conversationMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Map</span><span class="p">();</span> <span class="c1">// åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹æ¥ä¿å­˜æé—®è€…çš„ä¿¡æ¯å’Œconversation_id</span>
<span class="kd">const</span> <span class="nx">CONVERSATION_EXPIRATION</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span> <span class="c1">// è®¾å®šconversationçš„ä¿æŒæ—¶é—´ï¼Œè®¾å®šä¸º5åˆ†é’Ÿ</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nf">sendMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">userName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="kd">let</span> <span class="nx">conversationData</span> <span class="o">=</span> <span class="nx">conversationMap</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">userName</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">();</span>

  <span class="c1">// å¦‚æœä¼šè¯ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ,åˆ™åˆ›å»ºæ–°çš„ä¼šè¯</span>
  <span class="k">if </span><span class="p">(</span>
    <span class="o">!</span><span class="nx">conversationData</span> <span class="o">||</span>
    <span class="nx">timestamp</span> <span class="o">-</span> <span class="nx">conversationData</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">&gt;</span> <span class="nx">CONVERSATION_EXPIRATION</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="nx">conversationData</span> <span class="o">=</span> <span class="p">{</span> <span class="na">conversationId</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">timestamp</span> <span class="p">};</span>
    <span class="nx">conversationMap</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">userName</span><span class="p">,</span> <span class="nx">conversationData</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span>
    <span class="nx">difyApiUrl</span><span class="p">,</span>
    <span class="p">{</span>
      <span class="c1">// ...</span>
      <span class="na">conversation_id</span><span class="p">:</span> <span class="nx">conversationData</span><span class="p">.</span><span class="nx">conversationId</span><span class="p">,</span>
      <span class="na">user</span><span class="p">:</span> <span class="nx">userName</span><span class="p">,</span>
      <span class="c1">// ...</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
  <span class="p">);</span>

  <span class="c1">// æ›´æ–°ä¼šè¯IDå’Œæ—¶é—´æˆ³</span>
  <span class="nx">conversationData</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">timestamp</span><span class="p">;</span>

  <span class="c1">// ...</span>
  <span class="c1">// ä¸‹é¢çš„ä»£ç æ˜¯ç”±äºä½¿ç”¨äº†streamæ¨¡å¼æ¥è·å–Difyçš„responseï¼Œæ‰€ä»¥æˆ‘éœ€è¦éå†å®ƒçš„æ¯ä¸ªå›å¤ï¼Œæ‰¾åˆ°æœ€ç»ˆçš„å›å¤å†…å®¹</span>
  <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">line</span> <span class="k">of</span> <span class="nx">lines</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="dl">"</span><span class="s2">data:</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nf">trim</span><span class="p">());</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">event</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">agent_thought</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nx">conversationData</span><span class="p">.</span><span class="nx">conversationId</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">conversation_id</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>é€šè¿‡è¿™ç§æ–¹å¼,æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªç”¨æˆ·ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è¯ä¸Šä¸‹æ–‡,å®ç°å¤šè½®å¯¹è¯ã€‚å½“ç”¨æˆ·åœ¨ä¸€å®šæ—¶é—´å†…(è¿™é‡Œè®¾ç½®ä¸º 5 åˆ†é’Ÿ)ç»§ç»­å‘é€æ¶ˆæ¯æ—¶,å°±å¯ä»¥ä¿æŒä¸Šä¸‹æ–‡è¿è´¯;å¦‚æœè¶…è¿‡äº†è¿™ä¸ªæ—¶é—´,å°±ä¼šå¼€å§‹ä¸€ä¸ªæ–°çš„å¯¹è¯ã€‚</p>

<p>æ¥ä¸‹æ¥çš„è®¾ç½®å°±éƒ½æ˜¯åœ¨ Dify å¹³å°äº†ï¼Œç›®å‰æˆ‘è¿˜åœ¨åˆ¶ä½œä¸­ã€‚æˆ‘è®¾æƒ³æ˜¯ä¸Šä¼ ä»ç½‘ç»œä¸­ä¸‹è½½çš„ç§‘æ™®æ–‡ç« ä½œä¸ºçŸ¥è¯†åº“ï¼Œé™å®š GPT-4 åªåœ¨çŸ¥è¯†åº“ä¸­ä½œç­”ã€‚Anywayï¼Œå°±ä¸å±äºæŠ€æœ¯è®¨è®ºçš„èŒƒç•´äº†ã€‚</p>

<p>ä»¥ä¸Šå°±æ˜¯åˆ©ç”¨ Dify å’Œ Wechaty å®ç°å¾®ä¿¡æ™ºèƒ½å¯¹è¯æœºå™¨äººçš„æ ¸å¿ƒä»£ç ã€‚é€šè¿‡ Dify å¼ºå¤§çš„å¯¹è¯æ¨¡å‹å’Œ Wechaty æ–¹ä¾¿çš„å¾®ä¿¡é›†æˆ,æˆ‘ä»¬å¯ä»¥å¿«é€Ÿæ­å»ºä¸€ä¸ªå®ç”¨çš„åŒ»ç–—ç§‘æ™®æœºå™¨äººã€‚å½“ç„¶,è¿™åªæ˜¯ä¸€ä¸ªåŸºç¡€ç‰ˆæœ¬,æˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­æ·»åŠ æ›´å¤šåŠŸèƒ½,å¦‚è‡ªå®šä¹‰ promptã€çŸ¥è¯†åº“æœç´¢ç­‰,æ¥è¿›ä¸€æ­¥æå‡æœºå™¨äººçš„æ™ºèƒ½åŒ–æ°´å¹³ã€‚</p>

<hr />

<blockquote>
  <p>This post is also available in <a href="/2024/03/30/wechatbot-with-wechaty-dify-gpt4-en/">English</a>.</p>
</blockquote>]]></content><author><name>gscfwid</name></author><category term="article" /><category term="dify" /><category term="gpt4-turbo" /><summary type="html"><![CDATA[ä½œè€…: gscfwidï¼ŒAn anesthetist in a big ship of mainland.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://wechaty.js.org/assets/2024/03-wechatbot-with-wechaty-dify-gpt4-en/bp-post.webp" /><media:content medium="image" url="https://wechaty.js.org/assets/2024/03-wechatbot-with-wechaty-dify-gpt4-en/bp-post.webp" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>