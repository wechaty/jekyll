<!DOCTYPE html>
<html lang="en">
<head>
    <!-- https://github.com/t-richards/jekyll-google-tag-manager -->
    <!-- Begin Jekyll GTM tag v1.0.3 -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PD2PL84');</script>
<!-- End Jekyll GTM tag v1.0.3 -->


    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    

    <title>
      wechaty+TypeChat: Control Your WeChat with Natural Language | Wechaty
    </title>

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>wechaty+TypeChat: Control Your WeChat with Natural Language | Wechaty</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="wechaty+TypeChat: Control Your WeChat with Natural Language" />
<meta name="author" content="atorber" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This post is also available in Chinese" />
<meta property="og:description" content="This post is also available in Chinese" />
<link rel="canonical" href="https://wechaty.js.org/2023/08/06/use-llm-control-your-wechat-en/" />
<meta property="og:url" content="https://wechaty.js.org/2023/08/06/use-llm-control-your-wechat-en/" />
<meta property="og:site_name" content="Wechaty" />
<meta property="og:image" content="https://wechaty.js.org/assets/2023/08-use-llm-control-your-wechat-en/rare-book.webp" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-06T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://wechaty.js.org/assets/2023/08-use-llm-control-your-wechat-en/rare-book.webp" />
<meta property="twitter:title" content="wechaty+TypeChat: Control Your WeChat with Natural Language" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"atorber"},"dateModified":"2023-08-06T00:00:00+00:00","datePublished":"2023-08-06T00:00:00+00:00","description":"This post is also available in Chinese","headline":"wechaty+TypeChat: Control Your WeChat with Natural Language","image":"https://wechaty.js.org/assets/2023/08-use-llm-control-your-wechat-en/rare-book.webp","mainEntityOfPage":{"@type":"WebPage","@id":"https://wechaty.js.org/2023/08/06/use-llm-control-your-wechat-en/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://wechaty.js.org/assets/images/logo.png"},"name":"atorber"},"url":"https://wechaty.js.org/2023/08/06/use-llm-control-your-wechat-en/"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico">

    <link rel="manifest" href="/manifest.json">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://s3.pstatp.com/cdn/expire-1-M/font-awesome/5.3.1/css/all.css" crossorigin="anonymous">

    <!-- Google Fonts in China Thanks @crossly @sidny -->
    <link href="https://fonts.loli.net/css?family=Lora" rel="stylesheet">

    <!-- Bootstrap Modified -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- Theme Stylesheet -->
    <link rel="stylesheet" href="/assets/css/theme.css">

    <!-- Highlight Stylesheet -->
    <link rel="stylesheet" href="/assets/css/highlight.css">

    <!-- Jquery on header to make sure everything works, the rest  of the scripts in footer for fast loading -->
    <script
    src="https://s0.pstatp.com/cdn/expire-1-M/jquery/3.3.1/jquery.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>

    




</head>

<body class="">
    <!-- https://github.com/t-richards/jekyll-google-tag-manager -->
    <!-- Begin Jekyll GTM tag v1.0.3 (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PD2PL84"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Jekyll GTM tag v1.0.3 (noscript) -->


    <!-- Navbar -->
    <nav id="MagicMenu" class="topnav navbar navbar-expand-lg navbar-light bg-white fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/"><strong>Wechaty</strong></a>
        <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-collapse collapse" id="navbarColor02">
            <ul class="navbar-nav mr-auto d-flex align-items-center">
               <!--  Replace menu links here -->

<li class="nav-item">
  <a class="nav-link" href="/news/">News</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="/blog/">Blog</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://ship.fail" target="_blank">Ship.Fail</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://preangel.ai" target="_blank">PreAngel.AI</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="/docs/">Docs</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="/contributors/">Contributors</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://github.com/wechaty/PMC#wechaty-committers" target="_blank">Talks</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://github.com/wechaty/wechaty#readme" target="_blank">GitHub</a>
</li>


            </ul>
            <ul class="navbar-nav ml-auto d-flex align-items-center">
                <li class="nav-item">
                  <a class="nav-link" href="/search/">Search</a>
                </li>
            </ul>
        </div>
    </div>
    </nav>

  <!-- Search results moved to a dedicated /search page -->

    <!-- Content -->
    <main role="main" class="site-content">
        

<div class="container">
<div class="jumbotron jumbotron-fluid mb-3 pl-0 pt-0 pb-0 bg-white position-relative">
		<div class="h-100 tofront">
			<div class="row  justify-content-between ">
				<div class=" col-md-6  pr-0 pr-md-4 pt-4 pb-4 align-self-center">
					<p class="text-uppercase font-weight-bold">
            <span class="catlist">

            
              <a class="sscroll text-danger" href="/categories.html#article">article</a><span class="sep">, </span>
            

            </span>
					</p>
					<h1 class="display-4 mb-4 article-headline">wechaty+TypeChat: Control Your WeChat with Natural Language</h1>
					<div class="d-flex align-items-center">
                        
                          <a href="/contributors/atorber">
                            <img class="rounded-circle" src="/assets/contributors/atorber/avatar.webp" alt="atorber" width="70"/>
                          </a>
                        
						<small class="ml-3"> <a href="/contributors/atorber">atorber</a> <span><a target="_blank" href="" class="btn btn-outline-success btn-sm btn-round ml-1">Follow</a></span>
                            <span class="text-muted d-block mt-1">Aug 06, 2023 · <span class="reading-time">
  
  
    6 mins read
  
</span>
</span>
						</small>
					</div>
				</div>
                
				<div class="col-md-6 pr-0 align-self-center">
					<img class="rounded" src="/assets/2023/08-use-llm-control-your-wechat-en/rare-book.webp" alt="wechaty+TypeChat: Control Your WeChat with Natural Language">
				</div>
                
			</div>
		</div>
	</div>
</div>





<div class="container-lg pt-4 pb-4">
	<div class="row justify-content-center">

    <!-- Share -->
<div class="col-lg-2 pr-4 mb-5 col-md-12">
  <div class="sticky-top sticky-top-offset text-center">
    <div class="text-muted">
    </div>
    <div class="share d-inline-block">
      <!-- AddToAny BEGIN -->
      <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
        <img id="qrcode" title="Wechat"
          src="/assets/contributors/wechaty/icon.png"
          width="64" height="64"
        />
        <a class="a2a_button_twitter" title='Twitter'></a>
        <a class="a2a_button_linkedin" title='LinkedIn'></a>
        <a class="a2a_button_facebook" title='FaceBook'></a>
        <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
      </div>
      <script async src="https://static.addtoany.com/menu/page.js"></script>
      <!-- AddToAny END -->
    </div>
  </div>
</div>

<script>
  var href = document.location.href
  var url = 'https://api.qrserver.com/v1/create-qr-code/?data='
            + href
            + '&size=512x512'
  var img = document.getElementById('qrcode')

  img.src=encodeURI(url)
</script>


		<div class="col-md-12 col-lg-8">

      <!-- Article -->
			<article class="article-post">
			<blockquote>
  <p>This post is also available in <a href="/2023/08/06/use-llm-control-your-wechat/">Chinese</a></p>
</blockquote>

<p>With ChatGPT’s explosive popularity, LLM applications are springing up like mushrooms after rain. Almost anyone can develop their own Tmall Genie, Xiao Ai, or Xiao Du based on large language models…</p>

<p>Today I’ll introduce a solution for controlling WeChat using natural language based on ChatGPT. Using LLM to control wechaty bots to execute various commands, the combination of wechaty + <a href="https://github.com/microsoft/TypeChat">TypeChat</a> has achieved the following features (view complete code at <a href="https://github.com/atorber/type-wechaty">type-wechaty https://github.com/atorber/type-wechaty</a> for experience):</p>

<ul>
  <li>
    <p>Use natural language to send messages to specified friends or groups (if you’re someone who daily needs to coordinate and arrange various different people or groups, this will be very helpful)</p>
  </li>
  <li>
    <p>More… well, not yet implemented</p>
  </li>
</ul>

<p>Thanks to Microsoft’s TypeChat <a href="https://github.com/microsoft/TypeChat">https://github.com/microsoft/TypeChat</a>, we only need to define types to quickly implement the above features, and expanding functionality only requires continuing to expand more types.</p>

<p>First, let me introduce TypeChat <a href="https://github.com/microsoft/TypeChat">https://github.com/microsoft/TypeChat</a></p>

<h2 id="typechat">TypeChat</h2>

<p>Official introduction:</p>

<pre><code class="language-TypeScript">TypeChat is a library that makes it easy to build natural language interfaces using types.

Building natural language interfaces has traditionally been difficult. These apps often relied on complex decision trees to determine intent and collect the required inputs to take action. Large language models (LLMs) have made this easier by enabling us to take natural language input from a user and match to intent. This has introduced its own challenges including the need to constrain the model's reply for safety, structure responses from the model for further processing, and ensuring that the reply from the model is valid. Prompt engineering aims to solve these problems, but comes with a steep learning curve and increased fragility as the prompt increases in size.

TypeChat replaces prompt engineering with schema engineering.

Simply define types that represent the intents supported in your natural language application. That could be as simple as an interface for categorizing sentiment or more complex examples like types for a shopping cart or music application. For example, to add additional intents to a schema, a developer can add additional types into a discriminated union. To make schemas hierarchical, a developer can use a "meta-schema" to choose one or more sub-schemas based on user input.

After defining your types, TypeChat takes care of the rest by:

Constructing a prompt to the LLM using types.
Validating the LLM response conforms to the schema. If the validation fails, repair the non-conforming output through further language model interaction.
Summarizing succinctly (without use of a LLM) the instance and confirm that it aligns with user intent.
Types are all you need!
</code></pre>

<p>In brief:</p>

<ol>
  <li>TypeChat is a library that makes it easy to build natural language interfaces using types.</li>
  <li>TypeChat replaces prompt engineering with schema engineering.</li>
  <li>After defining types, TypeChat handles the rest by: constructing prompts to LLM using types. Validating that LLM responses conform to the schema. If validation fails, repairing non-conforming output through further language model interaction. Succinctly summarizing (without using LLM) the instance and confirming it aligns with user intent. Types are all you need!</li>
</ol>

<p>For TypeScript developers, this project is incredibly cool.</p>

<h2 id="requirements-description">Requirements Description</h2>

<p>Our requirement is to send messages to specified friends or groups by talking to the WeChat bot. For example:</p>

<p>To send a message to friend Zhang San telling him tomorrow’s meeting is cancelled, just say to the bot “Tell Zhang San that tomorrow’s meeting is cancelled,” and the WeChat bot will automatically send a WeChat message to Zhang San.</p>

<p>Combined with voice recognition technology, we can even use voice to control WeChat like using a smart speaker to complete our needed actions.</p>

<h2 id="implementation">Implementation</h2>

<p>Based on TypeChat implementation, we only need to define a type file, and TypeChat will automatically help us extract the recipient and content from “Tell Zhang San that tomorrow’s meeting is cancelled.”</p>

<p>We want the formatted information to look like this:</p>

<pre><code class="language-TypeScript">{
    "actions": [
      {
        "actionType": "sendMessage",
        "event": {
          "text": "明天的会议取消了",
          "contacts": [
            "张三"
          ]
        }
      }
    ]
  }
</code></pre>

<p>This way we can search for WeChat friends through contacts and send the text message to them.</p>

<p>Build types, corresponding type file messageActionsSchema.ts:</p>

<pre><code class="language-TypeScript">// The following types define the structure of an object of type MessageActions that represents a list of requested message actions

// Notify [xxx]: meeting cancelled, tell [xxx]: meeting cancelled
export type Message = {
    // Some message content, such as coming to the meeting immediately and picking up the delivery at the door
    text: string;
    // a list of people like 'team'
    contacts: string[];
};

// Notify group [xxx]: meeting cancelled, group [xxx]: meeting cancelled
export type RoomMessage = {
    // Some message content, such as coming to the meeting immediately and picking up the delivery at the door
    text: string;
    // a list of room or named groups like 'team'
    rooms: string[];
};

export type SendMessageAction = {
    // Send message to someone or notify someone
    actionType: 'sendMessage';
    event: Message;
};

export type SendRoomMessageAction = {
    // Send message to a group or send notification to a group
    actionType: 'sendRoomMessage';
    event: RoomMessage;
};

// if the user types text that can not easily be understood as a calendar action, this action is used
export interface UnknownAction {
    actionType: 'unknown';
    // text typed by the user that the system did not understand
    text: string;
}

export type Action =
    | UnknownAction
    | SendRoomMessageAction
    | SendMessageAction;

export type MessageActions = {
    actions: Action[];
};
</code></pre>

<p>Use TypeChat to implement a messageStructuring function. Calling this function can return the target format we want.</p>

<p>[Code examples continue with implementation details…]</p>

<h2 id="effect">Effect</h2>

<p><img src="/assets/2023/08-use-llm-control-your-wechat-en/1.webp" alt="send" /></p>

<p><img src="/assets/2023/08-use-llm-control-your-wechat-en/2.webp" alt="res" /></p>

<p>Send control commands to the admin group:</p>

<pre><code class="language-TypeScript">/llm Tell Zhang San that tomorrow's meeting is cancelled

(Zhang San is not a bot friend)

luyuchao /llm &gt;
2023/8/6 22:10:20
All sending failed[1]: Zhang San
</code></pre>

<pre><code class="language-TypeScript">/llm Tell luyuchao that tomorrow's meeting is cancelled

(luyuchao is a bot friend)

luyuchao /llm &gt;
2023/8/6 22:31:19
All sending successful[1]: luyuchao
</code></pre>

<pre><code class="language-TypeScript">/llm Notify [Master, luyuchao]: Come to the company for a meeting tonight

(Both Master and luyuchao are bot friends)

luyuchao /llm &gt;
2023/8/6 22:33:13
All sending successful[2]: Master, luyuchao
</code></pre>

<blockquote>
  <p>View complete effect screenshots on GitHub <a href="https://github.com/atorber/type-wechaty">https://github.com/atorber/type-wechaty</a></p>
</blockquote>

<h2 id="historical-articles">Historical Articles</h2>

<ul>
  <li><a href="https://wechaty.js.org/2021/03/17/node-wechaty-and-wechaty-puppet-padlocal/">Wechaty + WeChat Mini Program for Group Activity Registration</a></li>
  <li><a href="https://wechaty.js.org/2021/04/22/how-to-publish-blog-on-wechaty/">Getting Started: How a Beginner Can Publish Their First Blog in the Wechaty Community (Part 1)</a></li>
  <li><a href="https://wechaty.js.org/2021/07/13/wechaty-puppet-xp-start-up/">New Windows Puppet Project wechaty-puppet-xp Startup</a></li>
</ul>

			</article>

			<!-- Tags -->
			<div class="mb-4">
				<span class="taglist">
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#blog">blog</a>
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#study">study</a>
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#introduction">introduction</a>
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#ecosystem">ecosystem</a>
				
				</span>
			</div>

            <!-- Mailchimp Subscribe Form -->
            
			<div class="border p-5 bg-lightblue">
				<div class="row justify-content-between">
					<div class="col-md-6 mb-2 mb-md-0">
						<h5 class="font-weight-bold">Join Newsletter</h5>
						 Get the latest news right in your inbox. We never spam!
					</div>
					<div class="col-md-6">
						<div class="row">
              <form action="https://zixia.us4.list-manage.com/subscribe/post?u=a8584b55dea5aa8bbc14bd1a0&amp;id=d9899f0d70" method="post" name="mc-embedded-subscribe-form" class="wj-contact-form validate w-100" target="_blank" novalidate>
                <input type="email" placeholder="Enter e-mail address" name="EMAIL" class="required email form-control w-100" id="mce-EMAIL" autocomplete="on" required>
                <input type="text"  placeholder="Name"                 name="FNAME" class="required form-control w-100"       id="mce-FNAME" autocomplete="on" required>
                <button type="submit" value="Subscribe" name="subscribe" class="heart btn btn-success btn-block w-100 mt-2">Subscribe</button>
              </form>
						</div>
					</div>
				</div>
			</div>
            


             <!-- Author Box -->
                
				<div class="row mt-5">
					<div class="col-md-2 align-self-center">
                        
                          <a href="/contributors/atorber">
                            <img class="rounded-circle" src="/assets/contributors/atorber/avatar.webp" alt="atorber" width="90"/>
                          </a>
                        
					</div>
					<div class="col-md-10">
                        <h5 class="font-weight-bold">Written by <a href="/contributors/atorber">atorber</a> </h5>
						一个酷爱编码的产品经理
					</div>
				</div>
                

            <!-- Comments -->
            
                <!--  Giscus embeds GitHub Discussions for per-post comments. Configuration intentionally hard-coded. -->

<div id="comments" class="mt-5">
    <script src="https://giscus.app/client.js"
            data-repo="wechaty/js.org"
            data-repo-id="R_kgDOHF4w6Q"
            data-category="General"
            data-category-id="DIC_kwDOHF4w6c4Cx6g7"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="1"
            data-input-position="bottom"
            data-theme="light"
            data-lang="en"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>
        Comments require JavaScript. You can also join the discussion on our
        <a href="https://github.com/wechaty/js.org/discussions/categories/general" rel="noopener" target="_blank">GitHub Discussions</a> page.
    </noscript>
</div>

            

		</div>


	</div>
</div>


<!-- Aletbar Prev/Next -->
<div class="alertbar">
    <div class="container">
        <div class="row prevnextlinks small font-weight-bold">
          
            <div class="col-md-6 rightborder pl-0">
                <a class="text-dark" href="/2023/07/08/wechaty-in-waic2023/"> <img height="30px" class="mr-1" src="https://wechaty.js.org/assets/2023/07-wechaty-in-waic2023/2023-waic.webp">  直击现场:Wechaty在WAIC2023开源集市</a>
            </div>
          
          
            <div class="col-md-6 text-right pr-0">
                <a class="text-dark" href="/2023/08/06/use-llm-control-your-wechat/"> wechaty+TypeChat:使用自然语言控制你的微信  <img height="30px" class="ml-1" src="https://wechaty.js.org/assets/2023/08-use-llm-control-your-wechat-en/rare-book.webp"> </a>
            </div>
          
        </div>
    </div>
</div>

    </main>


    <!-- Scripts: popper, bootstrap, theme, lunr -->
    <script src="https://cdnjs.loli.net/ajax/libs/popper.js/1.14.6/umd/popper.min.js" crossorigin="anonymous"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" crossorigin="anonymous"></script>

    <script src="/assets/js/theme.js"></script>

  





    <!-- Footer -->
    <footer class="bg-white border-top p-3 text-muted small">
        <div class="container">
        <div class="row align-items-center justify-content-between">
            <div>
                <a href="#" class="text-muted navbar-brand mr-2 mb-0">
                  <strong>Wechaty</strong>
                </a>
                <span>Copyright © <script>document.write(new Date().getFullYear())</script></span>
                |
                <a
                  class="text-muted"
                  target="_blank"
                  href="/branding/"
                >
                  Branding
                </a>

                <!--  Github Repo Star Btn-->
                <a class="text-dark ml-1" target="_blank" href="https://github.com/wechaty"><i class="fab fa-github"></i> </a>

            </div>

            <div class="text-gray">
              Powered by
              <a
                class="text-gray font-weight-bold"
                target="_blank"
                href="https://www.wowthemes.net/mundana-jekyll-theme/"
              >
                Mundana Jekyll Theme
              </a>
              .
            </div>
        </div>
        </div>
    </footer>

    <!-- All this area goes before             <script>
                window.onload = function () {
                    var script = document.createElement('script');
                    var firstScript = document.getElementsByTagName('script')[0];
                    script.type = 'text/javascript';
                    script.async = true;
                    script.src = '/sw-register.js?v=' + Date.now();
                    firstScript.parentNode.insertBefore(script, firstScript);
                };
            </script>
            </body>
 closing tag -->


</body>

</html>
