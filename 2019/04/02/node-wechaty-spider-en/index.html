<!DOCTYPE html>
<html lang="en">
<head>
    <!-- https://github.com/t-richards/jekyll-google-tag-manager -->
    <!-- Begin Jekyll GTM tag v1.0.3 -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PD2PL84');</script>
<!-- End Jekyll GTM tag v1.0.3 -->


    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    

    <title>
      Write a Web Scraper with Node + Wechaty to Send Daily Warm Messages to Your Girlfriend (or Boyfriend) | Wechaty
    </title>

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Write a Web Scraper with Node + Wechaty to Send Daily Warm Messages to Your Girlfriend (or Boyfriend) | Wechaty</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Write a Web Scraper with Node + Wechaty to Send Daily Warm Messages to Your Girlfriend (or Boyfriend)" />
<meta name="author" content="leochen-g" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This post is also available in Chinese" />
<meta property="og:description" content="This post is also available in Chinese" />
<link rel="canonical" href="https://wechaty.js.org/2019/04/02/node-wechaty-spider-en/" />
<meta property="og:url" content="https://wechaty.js.org/2019/04/02/node-wechaty-spider-en/" />
<meta property="og:site_name" content="Wechaty" />
<meta property="og:image" content="https://wechaty.js.org/assets/2019/node-wechaty-1.webp" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-02T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://wechaty.js.org/assets/2019/node-wechaty-1.webp" />
<meta property="twitter:title" content="Write a Web Scraper with Node + Wechaty to Send Daily Warm Messages to Your Girlfriend (or Boyfriend)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"leochen-g"},"dateModified":"2019-04-02T00:00:00+00:00","datePublished":"2019-04-02T00:00:00+00:00","description":"This post is also available in Chinese","headline":"Write a Web Scraper with Node + Wechaty to Send Daily Warm Messages to Your Girlfriend (or Boyfriend)","image":"https://wechaty.js.org/assets/2019/node-wechaty-1.webp","mainEntityOfPage":{"@type":"WebPage","@id":"https://wechaty.js.org/2019/04/02/node-wechaty-spider-en/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://wechaty.js.org/assets/images/logo.png"},"name":"leochen-g"},"url":"https://wechaty.js.org/2019/04/02/node-wechaty-spider-en/"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico">

    <link rel="manifest" href="/manifest.json">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://s3.pstatp.com/cdn/expire-1-M/font-awesome/5.3.1/css/all.css" crossorigin="anonymous">

    <!-- Google Fonts in China Thanks @crossly @sidny -->
    <link href="https://fonts.loli.net/css?family=Lora" rel="stylesheet">

    <!-- Bootstrap Modified -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- Theme Stylesheet -->
    <link rel="stylesheet" href="/assets/css/theme.css">

    <!-- Highlight Stylesheet -->
    <link rel="stylesheet" href="/assets/css/highlight.css">

    <!-- Jquery on header to make sure everything works, the rest  of the scripts in footer for fast loading -->
    <script
    src="https://s0.pstatp.com/cdn/expire-1-M/jquery/3.3.1/jquery.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>

    




</head>

<body class="">
    <!-- https://github.com/t-richards/jekyll-google-tag-manager -->
    <!-- Begin Jekyll GTM tag v1.0.3 (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PD2PL84"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Jekyll GTM tag v1.0.3 (noscript) -->


    <!-- Navbar -->
    <nav id="MagicMenu" class="topnav navbar navbar-expand-lg navbar-light bg-white fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/"><strong>Wechaty</strong></a>
        <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-collapse collapse" id="navbarColor02">
            <ul class="navbar-nav mr-auto d-flex align-items-center">
               <!--  Replace menu links here -->

<li class="nav-item">
  <a class="nav-link" href="/news/">News</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="/blog/">Blog</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://ship.fail" target="_blank">Ship.Fail</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://preangel.ai" target="_blank">PreAngel.AI</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="/docs/">Docs</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="/contributors/">Contributors</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://github.com/wechaty/PMC#wechaty-committers" target="_blank">Talks</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://github.com/wechaty/wechaty#readme" target="_blank">GitHub</a>
</li>


            </ul>
            <ul class="navbar-nav ml-auto d-flex align-items-center">
                <li class="nav-item">
                  <a class="nav-link" href="/search/">Search</a>
                </li>
            </ul>
        </div>
    </div>
    </nav>

  <!-- Search results moved to a dedicated /search page -->

    <!-- Content -->
    <main role="main" class="site-content">
        

<div class="container">
<div class="jumbotron jumbotron-fluid mb-3 pl-0 pt-0 pb-0 bg-white position-relative">
		<div class="h-100 tofront">
			<div class="row  justify-content-between ">
				<div class=" col-md-6  pr-0 pr-md-4 pt-4 pb-4 align-self-center">
					<p class="text-uppercase font-weight-bold">
            <span class="catlist">

            
              <a class="sscroll text-danger" href="/categories.html#project">project</a><span class="sep">, </span>
            

            </span>
					</p>
					<h1 class="display-4 mb-4 article-headline">Write a Web Scraper with Node + Wechaty to Send Daily Warm Messages to Your Girlfriend (or Boyfriend)</h1>
					<div class="d-flex align-items-center">
                        
                          <a href="/contributors/leochen-g">
                            <img class="rounded-circle" src="/assets/contributors/leochen-g/avatar.webp" alt="Leo chen" width="70"/>
                          </a>
                        
						<small class="ml-3"> <a href="/contributors/leochen-g">Leo chen</a> <span><a target="_blank" href="" class="btn btn-outline-success btn-sm btn-round ml-1">Follow</a></span>
                            <span class="text-muted d-block mt-1">Apr 02, 2019 · <span class="reading-time">
  
  
    17 mins read
  
</span>
</span>
						</small>
					</div>
				</div>
                
				<div class="col-md-6 pr-0 align-self-center">
					<img class="rounded" src="/assets/2019/node-wechaty-1.webp" alt="Write a Web Scraper with Node + Wechaty to Send Daily Warm Messages to Your Girlfriend (or Boyfriend)">
				</div>
                
			</div>
		</div>
	</div>
</div>





<div class="container-lg pt-4 pb-4">
	<div class="row justify-content-center">

    <!-- Share -->
<div class="col-lg-2 pr-4 mb-5 col-md-12">
  <div class="sticky-top sticky-top-offset text-center">
    <div class="text-muted">
    </div>
    <div class="share d-inline-block">
      <!-- AddToAny BEGIN -->
      <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
        <img id="qrcode" title="Wechat"
          src="/assets/contributors/wechaty/icon.png"
          width="64" height="64"
        />
        <a class="a2a_button_twitter" title='Twitter'></a>
        <a class="a2a_button_linkedin" title='LinkedIn'></a>
        <a class="a2a_button_facebook" title='FaceBook'></a>
        <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
      </div>
      <script async src="https://static.addtoany.com/menu/page.js"></script>
      <!-- AddToAny END -->
    </div>
  </div>
</div>

<script>
  var href = document.location.href
  var url = 'https://api.qrserver.com/v1/create-qr-code/?data='
            + href
            + '&size=512x512'
  var img = document.getElementById('qrcode')

  img.src=encodeURI(url)
</script>


		<div class="col-md-12 col-lg-8">

      <!-- Article -->
			<article class="article-post">
			<blockquote>
  <p>This post is also available in <a href="/2019/04/02/node-wechaty-spider/">Chinese</a></p>
</blockquote>

<p>WeChat Daily Talk—automatically send WeChat messages to your loved one every day.</p>

<h2 id="project-introduction">Project Introduction</h2>

<h3 id="inspiration">Inspiration</h3>

<p>After seeing an article on Juejin titled <a href="https://juejin.im/post/5c75fa4af265da2d84109219">《用Node + EJS写一个爬虫脚本每天定时女朋友发一封暖心邮件》</a>,
I accidentally saw a reader in the comments asking if it could be implemented with WeChat. I happened to be working on a WeChat bot mini-project recently, so I decided to put this scheduled task into WeChat. I decided to do it, and after an afternoon of work, I finally got it done.</p>

<h3 id="project-address">Project Address</h3>

<p>GitHub: <a href="https://github.com/gengchen528/wechatBot">https://github.com/gengchen528/wechatBot</a></p>

<h3 id="libraries-used">Libraries Used</h3>

<ul>
  <li><a href="https://github.com/wechaty/wechaty">wechaty</a> - WeChat operations</li>
  <li><a href="https://github.com/node-schedule/node-schedule">node-schedule</a> - Scheduled tasks</li>
  <li><a href="https://github.com/visionmedia/superagent">superagent</a> - Web scraping</li>
  <li><a href="https://github.com/cheeriojs/cheerio#readme">cheerio</a> - Page parsing</li>
  <li><a href="https://github.com/gtanner/qrcode-terminal">qrcode-terminal</a> - Display QR code in terminal</li>
</ul>

<h3 id="features">Features</h3>

<ul>
  <li>Send daily weather reminders and daily quotes to friends</li>
  <li>Auto-add friends and auto-invite to groups based on keywords</li>
  <li>Integrate Turing Robot</li>
  <li>More features to be added… (you’re welcome to submit PRs with good ideas)</li>
</ul>

<h3 id="data-sources">Data Sources</h3>

<ul>
  <li>Daily quote comes from <a href="http://wufazhuce.com/">ONE</a>, same as the referenced article</li>
  <li>Weather information comes from <a href="https://tianqi.moji.com/weather">Moji Weather</a></li>
</ul>

<h3 id="scheduled-tasks">Scheduled Tasks</h3>

<p><a href="https://github.com/node-schedule/node-schedule">node-schedule</a> is perfect for this,
allowing you to schedule tasks for specific times each month, week, or day.</p>

<h3 id="implementation-effect">Implementation Effect</h3>

<p>Since WeChat sends messages on a scheduled basis, unlike email, WeChat cannot put images and text in the same message box, so it may not be as aesthetically pleasing as email. However, the text can still be formatted nicely. Due to time constraints, there’s relatively little text content, but more will be added later.</p>

<p><img src="/assets/2019/node-wechaty-2.webp" alt="screenshot" /></p>

<p><img src="/assets/2019/node-wechaty-1.webp" alt="screenshot" /></p>

<h2 id="code-description">Code Description</h2>

<h3 id="directory-structure">Directory Structure</h3>

<p><img src="/assets/2019/node-wechaty-3.webp" alt="directory" /></p>

<ul>
  <li>config: Stores public variables and superagent configuration</li>
  <li>schedule: Task scheduling configuration</li>
  <li>superagent: Gets daily quote and weather information</li>
  <li>utils: Extracted common methods</li>
</ul>

<h3 id="core-code">Core Code</h3>

<p>index.js</p>

<p>This file handles WeChat login, scheduled task creation, and message sending.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">/**
     * WechatBot
     *  - https://github.com/gengchen528/wechatBot
     */</span>
    <span class="k">import</span> <span class="p">{</span><span class="nx">Wechaty</span><span class="p">,</span><span class="nx">Friendship</span><span class="p">}</span>  <span class="k">from</span> <span class="dl">'</span><span class="s1">wechaty</span><span class="dl">'</span>
    <span class="k">import</span> <span class="nx">schedule</span>  <span class="k">from</span> <span class="dl">'</span><span class="s1">./schedule/index</span><span class="dl">'</span>
    <span class="k">import</span> <span class="nx">config</span>  <span class="k">from</span> <span class="dl">'</span><span class="s1">./config/index</span><span class="dl">'</span>
    <span class="k">import</span> <span class="nx">untils</span>  <span class="k">from</span> <span class="dl">'</span><span class="s1">./untils/index</span><span class="dl">'</span>
    <span class="k">import</span> <span class="nx">superagent</span>  <span class="k">from</span> <span class="dl">'</span><span class="s1">./superagent/index</span><span class="dl">'</span>
    <span class="k">import</span> <span class="p">{</span><span class="nx">FileBox</span><span class="p">}</span>  <span class="k">from</span> <span class="dl">'</span><span class="s1">file-box</span><span class="dl">'</span> <span class="c1">// File reading module</span>
    <span class="c1">//  QR code generation</span>
    <span class="kd">function</span> <span class="nf">onScan</span> <span class="p">(</span><span class="nx">qrcode</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">qrcode-terminal</span><span class="dl">'</span><span class="p">).</span><span class="nf">generate</span><span class="p">(</span><span class="nx">qrcode</span><span class="p">)</span>  <span class="c1">// Display QR code in console</span>
      <span class="kd">const</span> <span class="nx">qrcodeImageUrl</span> <span class="o">=</span> <span class="p">[</span>
      <span class="dl">'</span><span class="s1">https://api.qrserver.com/v1/create-qr-code/?data=</span><span class="dl">'</span><span class="p">,</span>
      <span class="nf">encodeURIComponent</span><span class="p">(</span><span class="nx">qrcode</span><span class="p">),</span>
      <span class="p">].</span><span class="nf">join</span><span class="p">(</span><span class="dl">''</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">qrcodeImageUrl</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Login</span>
    <span class="k">async</span> <span class="kd">function</span> <span class="nf">onLogin</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Caring Assistant </span><span class="p">${</span><span class="nx">user</span><span class="p">}</span><span class="s2"> logged in`</span><span class="p">)</span>
      <span class="c1">// Create scheduled task after login</span>
      <span class="nx">schedule</span><span class="p">.</span><span class="nf">setSchedule</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">SENDDATE</span><span class="p">,()</span><span class="o">=&gt;</span><span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Your caring assistant starts working!</span><span class="dl">'</span><span class="p">)</span>
        <span class="nf">main</span><span class="p">()</span>
      <span class="p">})</span>
    <span class="p">}</span>

    <span class="c1">// Logout</span>
    <span class="kd">function</span> <span class="nf">onLogout</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">user</span><span class="p">}</span><span class="s2"> logged out`</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// Listen to messages and auto-join groups based on keywords</span>
    <span class="k">async</span> <span class="kd">function</span> <span class="nf">onMessage</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">contact</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="k">from</span><span class="p">()</span> <span class="c1">// Message sender</span>
      <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nf">text</span><span class="p">()</span> <span class="c1">// Message content</span>
      <span class="kd">const</span> <span class="nx">room</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nf">room</span><span class="p">()</span> <span class="c1">// Is it a group message</span>
      <span class="kd">const</span> <span class="nx">roomCodeUrl</span> <span class="o">=</span> <span class="nx">FileBox</span><span class="p">.</span><span class="nf">fromUrl</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">ROOMCODEURL</span><span class="p">)</span> <span class="c1">// File from URL</span>
      <span class="kd">const</span> <span class="nx">roomCodeLocal</span> <span class="o">=</span> <span class="nx">FileBox</span><span class="p">.</span><span class="nf">fromFile</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">ROOMLOCALPATH</span><span class="p">)</span> <span class="c1">// Add local file</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nf">self</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">return</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">room</span><span class="p">){</span> <span class="c1">// If it's a group message</span>
      <span class="kd">const</span> <span class="nx">topic</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">room</span><span class="p">.</span><span class="nf">topic</span><span class="p">()</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Group name: </span><span class="p">${</span><span class="nx">topic</span><span class="p">}</span><span class="s2"> Sender: </span><span class="p">${</span><span class="nx">contact</span><span class="p">.</span><span class="nf">name</span><span class="p">()}</span><span class="s2"> Content: </span><span class="p">${</span><span class="nx">content</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
      <span class="p">}</span><span class="k">else</span> <span class="p">{</span> <span class="c1">// If not a group message</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Sender: </span><span class="p">${</span><span class="nx">contact</span><span class="p">.</span><span class="nf">name</span><span class="p">()}</span><span class="s2"> Content: </span><span class="p">${</span><span class="nx">content</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">addRoomReg</span> <span class="o">=</span> <span class="nf">eval</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">ADDROOMWORD</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">roomReg</span> <span class="o">=</span> <span class="nf">eval</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">ROOMNAME</span><span class="p">)</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">addRoomReg</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="nx">room</span><span class="p">){</span>
        <span class="kd">let</span> <span class="nx">keyRoom</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">Room</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span><span class="na">topic</span><span class="p">:</span> <span class="nx">roomReg</span><span class="p">})</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">keyRoom</span><span class="p">){</span>
          <span class="k">try</span><span class="p">{</span>
            <span class="k">await</span> <span class="nx">contact</span><span class="p">.</span><span class="nf">say</span><span class="p">(</span><span class="nx">roomCodeLocal</span><span class="o">||</span><span class="nx">roomCodeUrl</span><span class="p">)</span>
            <span class="k">await</span> <span class="nx">keyRoom</span><span class="p">.</span><span class="nf">say</span><span class="p">(</span><span class="dl">'</span><span class="s1">WeChat Daily Talk: Welcome new friend</span><span class="dl">'</span><span class="p">,</span> <span class="nx">contact</span><span class="p">)</span>
          <span class="p">}</span><span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">contact</span><span class="p">.</span><span class="nf">say</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello, don</span><span class="se">\'</span><span class="s1">t tease me easily, I can only send group QR codes, I can</span><span class="se">\'</span><span class="s1">t chat!</span><span class="dl">'</span><span class="p">)</span>
        <span class="k">await</span> <span class="nx">contact</span><span class="p">.</span><span class="nf">say</span><span class="p">(</span><span class="dl">'</span><span class="s1">Please reply with the code word: join group to get the group QR code</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Auto-add friend feature</span>
    <span class="k">async</span> <span class="kd">function</span> <span class="nf">onFriendShip</span><span class="p">(</span><span class="nx">friendship</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">logMsg</span>
      <span class="k">try</span> <span class="p">{</span>
      <span class="nx">logMsg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Add friend </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">friendship</span><span class="p">.</span><span class="nf">contact</span><span class="p">().</span><span class="nf">name</span><span class="p">()</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">logMsg</span><span class="p">)</span>

      <span class="k">switch </span><span class="p">(</span><span class="nx">friendship</span><span class="p">.</span><span class="nf">type</span><span class="p">())</span> <span class="p">{</span>
        <span class="cm">/**
         *
         * 1. New Friend Request
         *
         * when request is set, we can get verify message from `request.hello`,
         * and accept this request by `request.accept()`
         */</span>
        <span class="k">case</span> <span class="nx">Friendship</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="na">Receive</span><span class="p">:</span>
          <span class="kd">let</span> <span class="nx">addFriendReg</span> <span class="o">=</span> <span class="nf">eval</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">ADDFRIENDWORD</span><span class="p">)</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">addFriendReg</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">friendship</span><span class="p">.</span><span class="nf">hello</span><span class="p">()))</span> <span class="p">{</span>
          <span class="nx">logMsg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Auto-add friend because verification message contains keyword "daily talk"</span><span class="dl">'</span>
          <span class="k">await</span> <span class="nx">friendship</span><span class="p">.</span><span class="nf">accept</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">logMsg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Did not pass verification </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">friendship</span><span class="p">.</span><span class="nf">hello</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">break</span>
        <span class="cm">/**
         *
         * 2. Friend Ship Confirmed
         *
         */</span>
        <span class="k">case</span> <span class="nx">Friendship</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="na">Confirm</span><span class="p">:</span>
        <span class="nx">logMsg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">friend ship confirmed with </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">friendship</span><span class="p">.</span><span class="nf">contact</span><span class="p">().</span><span class="nf">name</span><span class="p">()</span>
        <span class="k">break</span>
      <span class="p">}</span>
      <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">logMsg</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span>
      <span class="p">}</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">logMsg</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// Auto-send message feature</span>
    <span class="k">async</span> <span class="kd">function</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">let</span>  <span class="nx">contact</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">bot</span><span class="p">.</span><span class="nx">Contact</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span><span class="na">name</span><span class="p">:</span><span class="nx">config</span><span class="p">.</span><span class="nx">NICKNAME</span><span class="p">})</span> <span class="o">||</span> <span class="k">await</span> <span class="nx">bot</span><span class="p">.</span><span class="nx">Contact</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span><span class="na">alias</span><span class="p">:</span><span class="nx">config</span><span class="p">.</span><span class="nx">NAME</span><span class="p">})</span> <span class="c1">// Get the contact you want to send to</span>
      <span class="kd">let</span> <span class="nx">one</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">superagent</span><span class="p">.</span><span class="nf">getOne</span><span class="p">()</span> <span class="c1">// Get daily quote</span>
      <span class="kd">let</span> <span class="nx">weather</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">superagent</span><span class="p">.</span><span class="nf">getWeather</span><span class="p">()</span> <span class="c1">// Get weather info</span>
      <span class="kd">let</span> <span class="nx">today</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">untils</span><span class="p">.</span><span class="nf">formatDate</span><span class="p">(</span><span class="k">new</span> <span class="nc">Date</span><span class="p">())</span><span class="c1">// Get today's date</span>
      <span class="kd">let</span> <span class="nx">memorialDay</span> <span class="o">=</span> <span class="nx">untils</span><span class="p">.</span><span class="nf">getDay</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">MEMORIAL_DAY</span><span class="p">)</span><span class="c1">// Get memorial day count</span>
      <span class="kd">let</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">today</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;br&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">Today is day </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">memorialDay</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> of us being together</span><span class="dl">'</span>
        <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;br&gt;&lt;br&gt;Today</span><span class="se">\'</span><span class="s1">s weather forecast&lt;br&gt;&lt;br&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">weather</span><span class="p">.</span><span class="nx">weatherTips</span> <span class="o">+</span><span class="dl">'</span><span class="s1">&lt;br&gt;&lt;br&gt;</span><span class="dl">'</span> <span class="o">+</span><span class="nx">weather</span><span class="p">.</span><span class="nx">todayWeather</span><span class="o">+</span> <span class="dl">'</span><span class="s1">Daily quote:&lt;br&gt;&lt;br&gt;</span><span class="dl">'</span><span class="o">+</span><span class="nx">one</span><span class="o">+</span><span class="dl">'</span><span class="s1">&lt;br&gt;&lt;br&gt;</span><span class="dl">'</span><span class="o">+</span><span class="dl">'</span><span class="s1">------From the one who loves you most</span><span class="dl">'</span>
      <span class="k">await</span> <span class="nx">contact</span><span class="p">.</span><span class="nf">say</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span><span class="c1">// Send message</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">bot</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Wechaty</span><span class="p">()</span>

    <span class="nx">bot</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">scan</span><span class="dl">'</span><span class="p">,</span>    <span class="nx">onScan</span><span class="p">)</span>
    <span class="nx">bot</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">login</span><span class="dl">'</span><span class="p">,</span>   <span class="nx">onLogin</span><span class="p">)</span>
    <span class="nx">bot</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">logout</span><span class="dl">'</span><span class="p">,</span>  <span class="nx">onLogout</span><span class="p">)</span>
    <span class="nx">bot</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="nx">onMessage</span><span class="p">)</span>
    <span class="nx">bot</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">friendship</span><span class="dl">'</span><span class="p">,</span> <span class="nx">onFriendShip</span><span class="p">)</span>

    <span class="nx">bot</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
      <span class="p">.</span><span class="nf">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Starting WeChat login</span><span class="dl">'</span><span class="p">))</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span>
</code></pre></div></div>

<p>superagent/index.js</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">import</span> <span class="nx">superagent</span>  <span class="k">from</span> <span class="dl">'</span><span class="s1">../config/superagent</span><span class="dl">'</span>
    <span class="k">import</span> <span class="nx">config</span>  <span class="k">from</span> <span class="dl">'</span><span class="s1">../config/index</span><span class="dl">'</span>
    <span class="k">import</span> <span class="nx">cheerio</span>  <span class="k">from</span> <span class="dl">'</span><span class="s1">cheerio</span><span class="dl">'</span>

    <span class="k">async</span> <span class="kd">function</span> <span class="nf">getOne</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// Get daily quote</span>
      <span class="kd">let</span> <span class="nx">res</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">superagent</span><span class="p">.</span><span class="nf">req</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">ONE</span><span class="p">,</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">cheerio</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">todayOneList</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#carousel-one .carousel-inner .item</span><span class="dl">'</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">todayOne</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="nx">todayOneList</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nf">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">.fp-one-cita</span><span class="dl">'</span><span class="p">).</span><span class="nf">text</span><span class="p">().</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">(</span><span class="sr">^</span><span class="se">\s</span><span class="sr">*</span><span class="se">)</span><span class="sr">|</span><span class="se">(\s</span><span class="sr">*$</span><span class="se">)</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">""</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">todayOne</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="kd">function</span> <span class="nf">getWeather</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// Get Moji weather</span>
      <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">MOJI_HOST</span><span class="o">+</span><span class="nx">config</span><span class="p">.</span><span class="nx">CITY</span><span class="o">+</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="o">+</span><span class="nx">config</span><span class="p">.</span><span class="nx">LOCATION</span>
      <span class="kd">let</span> <span class="nx">res</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">superagent</span><span class="p">.</span><span class="nf">req</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">cheerio</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">weatherTips</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.wea_tips em</span><span class="dl">'</span><span class="p">).</span><span class="nf">text</span><span class="p">()</span>
      <span class="kd">const</span> <span class="nx">today</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.forecast .days</span><span class="dl">'</span><span class="p">).</span><span class="nf">first</span><span class="p">().</span><span class="nf">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">let</span> <span class="nx">todayInfo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">Day</span><span class="p">:</span><span class="nf">$</span><span class="p">(</span><span class="nx">today</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nf">text</span><span class="p">().</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">(</span><span class="sr">^</span><span class="se">\s</span><span class="sr">*</span><span class="se">)</span><span class="sr">|</span><span class="se">(\s</span><span class="sr">*$</span><span class="se">)</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">""</span><span class="p">),</span>
        <span class="na">WeatherText</span><span class="p">:</span><span class="nf">$</span><span class="p">(</span><span class="nx">today</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="nf">text</span><span class="p">().</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">(</span><span class="sr">^</span><span class="se">\s</span><span class="sr">*</span><span class="se">)</span><span class="sr">|</span><span class="se">(\s</span><span class="sr">*$</span><span class="se">)</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">""</span><span class="p">),</span>
        <span class="na">Temp</span><span class="p">:</span><span class="nf">$</span><span class="p">(</span><span class="nx">today</span><span class="p">[</span><span class="mi">2</span><span class="p">]).</span><span class="nf">text</span><span class="p">().</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">(</span><span class="sr">^</span><span class="se">\s</span><span class="sr">*</span><span class="se">)</span><span class="sr">|</span><span class="se">(\s</span><span class="sr">*$</span><span class="se">)</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">""</span><span class="p">),</span>
        <span class="na">Wind</span><span class="p">:</span><span class="nf">$</span><span class="p">(</span><span class="nx">today</span><span class="p">[</span><span class="mi">3</span><span class="p">]).</span><span class="nf">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">em</span><span class="dl">'</span><span class="p">).</span><span class="nf">text</span><span class="p">().</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">(</span><span class="sr">^</span><span class="se">\s</span><span class="sr">*</span><span class="se">)</span><span class="sr">|</span><span class="se">(\s</span><span class="sr">*$</span><span class="se">)</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">""</span><span class="p">),</span>
        <span class="na">WindLevel</span><span class="p">:</span><span class="nf">$</span><span class="p">(</span><span class="nx">today</span><span class="p">[</span><span class="mi">3</span><span class="p">]).</span><span class="nf">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">).</span><span class="nf">text</span><span class="p">().</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">(</span><span class="sr">^</span><span class="se">\s</span><span class="sr">*</span><span class="se">)</span><span class="sr">|</span><span class="se">(\s</span><span class="sr">*$</span><span class="se">)</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">""</span><span class="p">),</span>
        <span class="na">PollutionLevel</span><span class="p">:</span><span class="nf">$</span><span class="p">(</span><span class="nx">today</span><span class="p">[</span><span class="mi">4</span><span class="p">]).</span><span class="nf">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">strong</span><span class="dl">'</span><span class="p">).</span><span class="nf">text</span><span class="p">().</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">(</span><span class="sr">^</span><span class="se">\s</span><span class="sr">*</span><span class="se">)</span><span class="sr">|</span><span class="se">(\s</span><span class="sr">*$</span><span class="se">)</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">""</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="kd">let</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">weatherTips</span><span class="p">:</span><span class="nx">weatherTips</span><span class="p">,</span>
      <span class="na">todayWeather</span><span class="p">:</span><span class="nx">todayInfo</span><span class="p">.</span><span class="nx">Day</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">todayInfo</span><span class="p">.</span><span class="nx">WeatherText</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;br&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">Temperature:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">todayInfo</span><span class="p">.</span><span class="nx">Temp</span> <span class="o">+</span>  <span class="dl">'</span><span class="s1">&lt;br&gt;</span><span class="dl">'</span>
        <span class="o">+</span> <span class="nx">todayInfo</span><span class="p">.</span><span class="nx">Wind</span> <span class="o">+</span> <span class="nx">todayInfo</span><span class="p">.</span><span class="nx">WindLevel</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;br&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">Air Quality:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">todayInfo</span><span class="p">.</span><span class="nx">PollutionLevel</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;br&gt;</span><span class="dl">'</span>
      <span class="p">}</span>
      <span class="k">return</span>  <span class="nx">obj</span>
    <span class="p">}</span>
    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span><span class="p">{</span>
      <span class="nx">getOne</span><span class="p">,</span><span class="nx">getWeather</span>
    <span class="p">}</span>
</code></pre></div></div>

<h2 id="running-the-project">Running the Project</h2>

<p>Since chromium needs to be installed, you should configure the mirror first. Note that due to Wechaty limitations, it’s best to use Node 10 or above.</p>

<p>npm</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm config <span class="nb">set </span>registry https://registry.npm.taobao.org
npm config <span class="nb">set </span>disturl https://npm.taobao.org/dist
npm config <span class="nb">set </span>puppeteer_download_host https://npm.taobao.org/mirrors
</code></pre></div></div>

<p>yarn</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn config <span class="nb">set </span>registry https://registry.npm.taobao.org
yarn config <span class="nb">set </span>disturl https://npm.taobao.org/dist
yarn config <span class="nb">set </span>puppeteer_download_host https://npm.taobao.org/mirrors
</code></pre></div></div>

<p>Then install the project:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@github.com:gengchen528/wechatBot.git
<span class="nb">cd </span>wechatBot
npm <span class="nb">install </span>or cnpm <span class="nb">install</span>
</code></pre></div></div>

<p>Parameter Configuration</p>

<p>wechatBot/config/index.js</p>

<h2 id="project-configuration">Project Configuration</h2>

<p>config/index.js</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Configuration file</span>
    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span><span class="p">{</span>
      <span class="c1">// Basic scheduled sending feature configuration (required)</span>
      <span class="na">NAME</span><span class="p">:</span><span class="dl">'</span><span class="s1">A Bunny</span><span class="dl">'</span><span class="p">,</span><span class="c1">// Remark name</span>
      <span class="na">NICKNAME</span><span class="p">:</span><span class="dl">'</span><span class="s1">Uh-huh</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// Nickname</span>
      <span class="na">MEMORIAL_DAY</span><span class="p">:</span><span class="dl">'</span><span class="s1">2015/04/18</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// Your memorial day with the recipient</span>
      <span class="na">CITY</span><span class="p">:</span><span class="dl">'</span><span class="s1">shanghai</span><span class="dl">'</span><span class="p">,</span><span class="c1">// Recipient's city</span>
      <span class="na">LOCATION</span><span class="p">:</span><span class="dl">'</span><span class="s1">pudong-new-district</span><span class="dl">'</span><span class="p">,</span><span class="c1">// Recipient's district (you can visit Moji Weather website to check the English spelling)</span>
      <span class="na">SENDDATE</span><span class="p">:</span><span class="dl">'</span><span class="s1">0 0 8 * * *</span><span class="dl">'</span><span class="p">,</span><span class="c1">// Scheduled send time - send at 8:00:00 every day, see /schedule/index.js for rules</span>
      <span class="na">ONE</span><span class="p">:</span><span class="dl">'</span><span class="s1">http://wufazhuce.com/</span><span class="dl">'</span><span class="p">,</span><span class="c1">// ONE web version website</span>
      <span class="na">MOJI_HOST</span><span class="p">:</span><span class="dl">'</span><span class="s1">https://tianqi.moji.com/weather/china/</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// China Moji Weather URL</span>

      <span class="c1">// Advanced features configuration (optional)</span>
      <span class="na">AUTOADDFRIEND</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="c1">// Auto-add friend feature - disabled by default</span>
      <span class="na">AUTOADDROOM</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="c1">// Auto-invite to group feature - disabled by default</span>
      <span class="na">AUTOREPLY</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="c1">// Auto-chat feature - disabled by default</span>
      <span class="na">AIBOTAPI</span><span class="p">:</span><span class="dl">'</span><span class="s1">http://www.tuling123.com/openapi/api</span><span class="dl">'</span><span class="p">,</span><span class="c1">// Turing Robot API - register at http://www.turingapi.com/</span>
      <span class="na">APIKEY</span><span class="p">:</span><span class="dl">'</span><span class="s1">Your Turing Robot apikey</span><span class="dl">'</span><span class="p">,</span><span class="c1">// Turing Robot apikey</span>
      <span class="na">ROOMNAME</span><span class="p">:</span><span class="dl">'</span><span class="s1">/^Your group name/i</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// Group name (please only modify Chinese, don't delete symbols, this is regex)</span>
      <span class="na">ADDFRIENDWORD</span><span class="p">:</span><span class="dl">'</span><span class="s1">/Your trigger keyword/i</span><span class="dl">'</span><span class="p">,</span><span class="c1">// Auto-add friend trigger keyword (please only modify Chinese, don't delete symbols, this is regex)</span>
      <span class="na">ADDROOMWORD</span><span class="p">:</span><span class="dl">'</span><span class="s1">/join group/</span><span class="dl">'</span><span class="p">,</span><span class="c1">// Auto-send group image trigger keyword (please only modify Chinese, don't delete symbols, this is regex)</span>
      <span class="na">ROOMCODEURL</span><span class="p">:</span><span class="dl">'</span><span class="s1">http://image.bloggeng.com/qun.png</span><span class="dl">'</span><span class="p">,</span><span class="c1">// Group QR code URL link (choose one with local group QR code path)</span>
      <span class="na">ROOMLOCALPATH</span><span class="p">:</span><span class="dl">'</span><span class="s1">./static/qun.png</span><span class="dl">'</span><span class="p">,</span><span class="c1">// Local group QR code image path (choose one with group URL)</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Start Running</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm run start
</code></pre></div></div>

<p>Then take out your phone—preferably use a secondary account—and scan the QR code in the console.</p>

<h2 id="issues-to-resolve">Issues to Resolve</h2>

<ul>
  <li>Moji Weather page may have delays when fetching, sometimes unable to retrieve data</li>
</ul>

<h2 id="common-issues">Common Issues</h2>

<ol>
  <li>My WeChat account cannot log in</li>
</ol>

<p>Starting from late June 2017, there is a high probability of login restrictions when using solutions based on web WeChat. Main symptoms: unable to log in to Web WeChat, but does not affect mobile and other platforms. Verify if login is restricted: scan code at <a href="https://wx.qq.com">https://wx.qq.com</a> to check if you can log in. More details:</p>

<ul>
  <li><a href="https://github.com/wechaty/wechaty/issues/603">Can not login with error message: 当前登录环境异常。为了你的帐号安全，暂时不能登录web微信。</a></li>
  <li><a href="https://github.com/wechaty/wechaty/issues/990">[Rumor] WeChat will close the web version</a></li>
  <li><a href="https://github.com/wechaty/wechaty/issues/872">Newly registered WeChat accounts cannot log in</a></li>
</ul>

<ol>
  <li>Unable to install puppet-puppeteer &amp;&amp; Chromium when running npm run start</li>
</ol>

<p>Issues deploying on CentOS 7:</p>

<p><img src="/assets/2019/koa-wechaty-7.webp" alt="image" /></p>

<p>Reason: <a href="https://segmentfault.com/a/1190000011382062">https://segmentfault.com/a/1190000011382062</a></p>

<p>Solution:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Dependencies</span>
yum <span class="nb">install </span>pango.x86_64 libXcomposite.x86_64 libXcursor.x86_64 libXdamage.x86_64 libXext.x86_64 libXi.x86_64 libXtst.x86_64 cups-libs.x86_64 libXScrnSaver.x86_64 libXrandr.x86_64 GConf2.x86_64 alsa-lib.x86_64 atk.x86_64 gtk3.x86_64 <span class="nt">-y</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Fonts</span>
yum <span class="nb">install </span>ipa-gothic-fonts xorg-x11-fonts-100dpi xorg-x11-fonts-75dpi xorg-x11-utils xorg-x11-fonts-cyrillic xorg-x11-fonts-Type1 xorg-x11-fonts-misc <span class="nt">-y</span>
</code></pre></div></div>

<ul>
  <li>On Windows, puppeteer download failure</li>
</ul>

<p>Link: <a href="https://pan.baidu.com/s/1YF09nELpO-4KZh3D2nAOhA">https://pan.baidu.com/s/1YF09nELpO-4KZh3D2nAOhA</a><br />
Extraction code: 0mrz<br />
Put the downloaded file in the path shown below and extract it to the current folder.</p>

<p><img src="/assets/2019/koa-wechaty-8.webp" alt="image" /></p>

<ol>
  <li>Does it support red packets, transfers, Moments…?</li>
</ol>

<p>Payment related - red packets, transfers, receiving payments, etc. are not supported.</p>

<ol>
  <li>More Wechaty feature-related interfaces</li>
</ol>

<p><a href="https://wechaty.js.org/v/zh/">Refer to Wechaty official documentation</a></p>

<ol>
  <li>
    <p>Other problem solutions</p>

    <ul>
      <li>First check if Node version is greater than 10</li>
      <li>Confirm npm or yarn has been configured with Taobao mirror</li>
      <li>If package-lock.json file exists, delete it first</li>
      <li>Delete <code class="language-plaintext highlighter-rouge">node_modules</code> and re-run <code class="language-plaintext highlighter-rouge">npm install</code> or <code class="language-plaintext highlighter-rouge">cnpm install</code></li>
    </ul>
  </li>
</ol>

<h2 id="notice">Notice</h2>

<p>This project is developed out of personal interest and is open-sourced for technical exchange. Please do not use this project to violate WeChat regulations or do other illegal things.
It’s recommended to use a secondary account for testing. There is a risk of web login being banned by WeChat (client not affected). Please ensure you use it voluntarily. The author is not responsible for web login bans caused by improper personal use. Thank you for your understanding.</p>

<h2 id="finally">Finally</h2>

<p>Since I added auto-add friend and group invitation features to this WeChat bot, interested friends can add my WeChat for testing. Remember to include the code word <code class="language-plaintext highlighter-rouge">WeChat Daily Talk</code> when adding friends. After adding, send <code class="language-plaintext highlighter-rouge">join group</code> and it will automatically send the group QR code.</p>

<p><strong>Note</strong>: When adding friends, please fill in <code class="language-plaintext highlighter-rouge">WeChat Daily Talk</code> in the verification to auto-add friends.</p>

<p><img src="/assets/2019/koa-wechaty-9.webp" alt="image" /></p>

<p>Come try it yourself—I believe you’ll discover more fun features!</p>

<p>GitHub: <a href="https://github.com/gengchen528/wechatBot">https://github.com/gengchen528/wechatBot</a></p>

<p>Also, my official account has integrated Microsoft Xiaoice. After following, sending voice messages will get you a young lady’s voice chatting with you. You can also text chat with her. If you’re interested, give it a try. Singles are welcome to flirt!</p>

<p><img src="/assets/2019/koa-wechaty-10.webp" alt="image" /></p>

<blockquote>
  <p>Author: <a href="https://github.com/leochen-g/">Leo_chen</a>, Frontend Engineer, enjoys using Node for various small projects, works at a big data company. This article was first published on Juejin: <a href="https://juejin.im/post/5c77c6bef265da2de6611cff">用Node+wechaty写一个爬虫脚本每天定时给女(男)朋友发微信暖心话</a></p>
</blockquote>

			</article>

			<!-- Tags -->
			<div class="mb-4">
				<span class="taglist">
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#code">code</a>
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#featured">featured</a>
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#social">social</a>
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#entertainment">entertainment</a>
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#ecosystem">ecosystem</a>
				
				</span>
			</div>

            <!-- Mailchimp Subscribe Form -->
            
			<div class="border p-5 bg-lightblue">
				<div class="row justify-content-between">
					<div class="col-md-6 mb-2 mb-md-0">
						<h5 class="font-weight-bold">Join Newsletter</h5>
						 Get the latest news right in your inbox. We never spam!
					</div>
					<div class="col-md-6">
						<div class="row">
              <form action="https://zixia.us4.list-manage.com/subscribe/post?u=a8584b55dea5aa8bbc14bd1a0&amp;id=d9899f0d70" method="post" name="mc-embedded-subscribe-form" class="wj-contact-form validate w-100" target="_blank" novalidate>
                <input type="email" placeholder="Enter e-mail address" name="EMAIL" class="required email form-control w-100" id="mce-EMAIL" autocomplete="on" required>
                <input type="text"  placeholder="Name"                 name="FNAME" class="required form-control w-100"       id="mce-FNAME" autocomplete="on" required>
                <button type="submit" value="Subscribe" name="subscribe" class="heart btn btn-success btn-block w-100 mt-2">Subscribe</button>
              </form>
						</div>
					</div>
				</div>
			</div>
            


             <!-- Author Box -->
                
				<div class="row mt-5">
					<div class="col-md-2 align-self-center">
                        
                          <a href="/contributors/leochen-g">
                            <img class="rounded-circle" src="/assets/contributors/leochen-g/avatar.webp" alt="Leo chen" width="90"/>
                          </a>
                        
					</div>
					<div class="col-md-10">
                        <h5 class="font-weight-bold">Written by <a href="/contributors/leochen-g">Leo chen</a> </h5>
						高级前端工程师一枚，喜欢用node做各种项目，生命不止，折腾不息！
					</div>
				</div>
                

            <!-- Comments -->
            
                <!--  Giscus embeds GitHub Discussions for per-post comments. Configuration intentionally hard-coded. -->

<div id="comments" class="mt-5">
    <script src="https://giscus.app/client.js"
            data-repo="wechaty/js.org"
            data-repo-id="R_kgDOHF4w6Q"
            data-category="General"
            data-category-id="DIC_kwDOHF4w6c4Cx6g7"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="1"
            data-input-position="bottom"
            data-theme="light"
            data-lang="en"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>
        Comments require JavaScript. You can also join the discussion on our
        <a href="https://github.com/wechaty/js.org/discussions/categories/general" rel="noopener" target="_blank">GitHub Discussions</a> page.
    </noscript>
</div>

            

		</div>


	</div>
</div>


<!-- Aletbar Prev/Next -->
<div class="alertbar">
    <div class="container">
        <div class="row prevnextlinks small font-weight-bold">
          
            <div class="col-md-6 rightborder pl-0">
                <a class="text-dark" href="/2019/04/02/koa-wechaty-assistant/"> <img height="30px" class="mr-1" src="https://wechaty.js.org/assets/2019/koa-wechaty.webp">  使用koa2+wechaty打造个人微信小秘书</a>
            </div>
          
          
            <div class="col-md-6 text-right pr-0">
                <a class="text-dark" href="/2019/04/02/node-wechaty-spider/"> 用Node+wechaty写一个爬虫脚本每天定时给女(男)朋友发微信暖心话  <img height="30px" class="ml-1" src="https://wechaty.js.org/assets/2019/node-wechaty-1.webp"> </a>
            </div>
          
        </div>
    </div>
</div>

    </main>


    <!-- Scripts: popper, bootstrap, theme, lunr -->
    <script src="https://cdnjs.loli.net/ajax/libs/popper.js/1.14.6/umd/popper.min.js" crossorigin="anonymous"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" crossorigin="anonymous"></script>

    <script src="/assets/js/theme.js"></script>

  





    <!-- Footer -->
    <footer class="bg-white border-top p-3 text-muted small">
        <div class="container">
        <div class="row align-items-center justify-content-between">
            <div>
                <a href="#" class="text-muted navbar-brand mr-2 mb-0">
                  <strong>Wechaty</strong>
                </a>
                <span>Copyright © <script>document.write(new Date().getFullYear())</script></span>
                |
                <a
                  class="text-muted"
                  target="_blank"
                  href="/branding/"
                >
                  Branding
                </a>

                <!--  Github Repo Star Btn-->
                <a class="text-dark ml-1" target="_blank" href="https://github.com/wechaty"><i class="fab fa-github"></i> </a>

            </div>

            <div class="text-gray">
              Powered by
              <a
                class="text-gray font-weight-bold"
                target="_blank"
                href="https://www.wowthemes.net/mundana-jekyll-theme/"
              >
                Mundana Jekyll Theme
              </a>
              .
            </div>
        </div>
        </div>
    </footer>

    <!-- All this area goes before             <script>
                window.onload = function () {
                    var script = document.createElement('script');
                    var firstScript = document.getElementsByTagName('script')[0];
                    script.type = 'text/javascript';
                    script.async = true;
                    script.src = '/sw-register.js?v=' + Date.now();
                    firstScript.parentNode.insertBefore(script, firstScript);
                };
            </script>
            </body>
 closing tag -->


</body>

</html>
