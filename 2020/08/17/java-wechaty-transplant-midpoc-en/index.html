<!DOCTYPE html>
<html lang="en">
<head>
    <!-- https://github.com/t-richards/jekyll-google-tag-manager -->
    <!-- Begin Jekyll GTM tag v1.0.3 -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PD2PL84');</script>
<!-- End Jekyll GTM tag v1.0.3 -->


    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    

    <title>
      Wechaty Java Component Porting Development | Wechaty
    </title>

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Wechaty Java Component Porting Development | Wechaty</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Wechaty Java Component Porting Development" />
<meta name="author" content="cunkoulaocai" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This post is a mid-term report on porting Wechaty components to Java/Kotlin as part of the Summer 2020 Open Source Promotion Plan. It covers the development of memory-card and state-switch components, API porting, and challenges faced during the process." />
<meta property="og:description" content="This post is a mid-term report on porting Wechaty components to Java/Kotlin as part of the Summer 2020 Open Source Promotion Plan. It covers the development of memory-card and state-switch components, API porting, and challenges faced during the process." />
<link rel="canonical" href="https://wechaty.js.org/2020/08/17/java-wechaty-transplant-midpoc-en/" />
<meta property="og:url" content="https://wechaty.js.org/2020/08/17/java-wechaty-transplant-midpoc-en/" />
<meta property="og:site_name" content="Wechaty" />
<meta property="og:image" content="https://wechaty.js.org/assets/2020/08-java-wechaty-transplant-midpoc-en/java-wechaty-transplant-midpoc.webp" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-17T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://wechaty.js.org/assets/2020/08-java-wechaty-transplant-midpoc-en/java-wechaty-transplant-midpoc.webp" />
<meta property="twitter:title" content="Wechaty Java Component Porting Development" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"cunkoulaocai"},"dateModified":"2020-08-17T00:00:00+00:00","datePublished":"2020-08-17T00:00:00+00:00","description":"This post is a mid-term report on porting Wechaty components to Java/Kotlin as part of the Summer 2020 Open Source Promotion Plan. It covers the development of memory-card and state-switch components, API porting, and challenges faced during the process.","headline":"Wechaty Java Component Porting Development","image":"https://wechaty.js.org/assets/2020/08-java-wechaty-transplant-midpoc-en/java-wechaty-transplant-midpoc.webp","mainEntityOfPage":{"@type":"WebPage","@id":"https://wechaty.js.org/2020/08/17/java-wechaty-transplant-midpoc-en/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://wechaty.js.org/assets/images/logo.png"},"name":"cunkoulaocai"},"url":"https://wechaty.js.org/2020/08/17/java-wechaty-transplant-midpoc-en/"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico">

    <link rel="manifest" href="/manifest.json">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://s3.pstatp.com/cdn/expire-1-M/font-awesome/5.3.1/css/all.css" crossorigin="anonymous">

    <!-- Google Fonts in China Thanks @crossly @sidny -->
    <link href="https://fonts.loli.net/css?family=Lora" rel="stylesheet">

    <!-- Bootstrap Modified -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- Theme Stylesheet -->
    <link rel="stylesheet" href="/assets/css/theme.css">

    <!-- Highlight Stylesheet -->
    <link rel="stylesheet" href="/assets/css/highlight.css">

    <!-- Jquery on header to make sure everything works, the rest  of the scripts in footer for fast loading -->
    <script
    src="https://s0.pstatp.com/cdn/expire-1-M/jquery/3.3.1/jquery.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>

</head>

<body class="">
    <!-- https://github.com/t-richards/jekyll-google-tag-manager -->
    <!-- Begin Jekyll GTM tag v1.0.3 (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PD2PL84"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Jekyll GTM tag v1.0.3 (noscript) -->


    <!-- Navbar -->
    <nav id="MagicMenu" class="topnav navbar navbar-expand-lg navbar-light bg-white fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/"><strong>Wechaty</strong></a>
        <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-collapse collapse" id="navbarColor02">
            <ul class="navbar-nav mr-auto d-flex align-items-center">
               <!--  Replace menu links here -->

<li class="nav-item">
  <a class="nav-link" href="/news/">News</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="/blog/">Blog</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="/docs/">Docs</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="/contributors/">Contributors</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://github.com/wechaty/PMC#wechaty-committers" target="_blank">Talks</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://github.com/wechaty/wechaty#readme" target="_blank">GitHub</a>
</li>


            </ul>
            <ul class="navbar-nav ml-auto d-flex align-items-center">
                <li class="nav-item">
                  <a class="nav-link" href="/search/">Search</a>
                </li>
            </ul>
        </div>
    </div>
    </nav>

  <!-- Search results moved to a dedicated /search page -->

    <!-- Content -->
    <main role="main" class="site-content">
        

<div class="container">
<div class="jumbotron jumbotron-fluid mb-3 pl-0 pt-0 pb-0 bg-white position-relative">
		<div class="h-100 tofront">
			<div class="row  justify-content-between ">
				<div class=" col-md-6  pr-0 pr-md-4 pt-4 pb-4 align-self-center">
					<p class="text-uppercase font-weight-bold">
            <span class="catlist">

            
              <a class="sscroll text-danger" href="/categories.html#project">project</a><span class="sep">, </span>
            

            </span>
					</p>
					<h1 class="display-4 mb-4 article-headline">Wechaty Java Component Porting Development</h1>
					<div class="d-flex align-items-center">
                        
                          <a href="/contributors/cunkoulaocai">
                            <img class="rounded-circle" src="/assets/contributors/cunkoulaocai/avatar.webp" alt="cunkoulaocai" width="70"/>
                          </a>
                        
						<small class="ml-3"> cunkoulaocai <span><a target="_blank" href="" class="btn btn-outline-success btn-sm btn-round ml-1">Follow</a></span>
                            <span class="text-muted d-block mt-1">Aug 17, 2020 · <span class="reading-time">
  
  
    6 mins read
  
</span>
</span>
						</small>
					</div>
				</div>
                
				<div class="col-md-6 pr-0 align-self-center">
					<img class="rounded" src="/assets/2020/08-java-wechaty-transplant-midpoc-en/java-wechaty-transplant-midpoc.webp" alt="Wechaty Java Component Porting Development">
				</div>
                
			</div>
		</div>
	</div>
</div>





<div class="container-lg pt-4 pb-4">
	<div class="row justify-content-center">

    <!-- Share -->
<div class="col-lg-2 pr-4 mb-5 col-md-12">
  <div class="sticky-top sticky-top-offset text-center">
    <div class="text-muted">
    </div>
    <div class="share d-inline-block">
      <!-- AddToAny BEGIN -->
      <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
        <a class="a2a_button_wechat" title='Wechat'>
          <img id="qrcode" title="Wechat"
            src="/assets/contributors/wechaty/icon.png"
            width="64" height="64"
          />
        </a>
        <a class="a2a_button_wechat" title='Wechat'></a>
        <a class="a2a_button_sina_weibo" title='Weibo'></a>
        <a class="a2a_button_linkedin" title='LinkedIn'></a>
        <a class="a2a_button_facebook" title='FaceBook'></a>
        <a class="a2a_button_twitter" title='Twitter'></a>
        <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
        <!-- AddToAny BEGIN -->
      </div>
      <script async src="https://static.addtoany.com/menu/page.js"></script>
      <!-- AddToAny END -->
    </div>
  </div>
</div>

<script>
  var href = document.location.href
  var url = 'https://api.qrserver.com/v1/create-qr-code/?data='
            + href
            + '&size=512x512'
  var img = document.getElementById('qrcode')

  img.src=encodeURI(url)
</script>


		<div class="col-md-12 col-lg-8">

      <!-- Article -->
			<article class="article-post">
			<p>The “Open Source Promotion Plan - Summer 2020” (hereinafter referred to as Summer 2020) is a summer event for college students jointly organized by the Institute of Software, Chinese Academy of Sciences and the openEuler community. It aims to encourage students to actively participate in the development and maintenance of open source software and promote the vigorous development of outstanding open source software communities in China. Participants can also obtain bonuses and trophies from the “Open Source Promotion Plan - Summer 2020” event according to the difficulty and completion of the project.
Official website: <a href="https://isrc.iscas.ac.cn/summer2020">https://isrc.iscas.ac.cn/summer2020</a> Official news: <a href="http://www.iscas.ac.cn/xshd2016/xshy2016/202004/t20200426_5563484.html">http://www.iscas.ac.cn/xshd2016/xshy2016/202004/t20200426_5563484.html</a>
This project [Wechaty Java Component Porting] is an open source project supported by Summer 2020.</p>

<h2 id="summer-2020-wechaty-java-component-porting-poc-showcase">Summer 2020 [Wechaty Java Component Porting] POC Showcase</h2>

<h2 id="wechaty-java-component-porting-information">[Wechaty Java Component Porting] Information</h2>

<ul>
  <li>Mentor: Zhengxin Diao (刁政欣)</li>
  <li>Student: Yang Chen (陈炀)</li>
  <li>Project Name: Wechaty</li>
  <li>
    <p>Description: Port the typescript version of wechaty to the java/kotlin platform using java or kotlin</p>
  </li>
  <li>
    <p>Time planning:</p>

    <p>memory-card storage</p>

    <ul>
      <li>7.1 - 7.19</li>
      <li>This module porting is a basic requirement of the project. In order to meet the functions of the robot not needing to scan the code to log in again and saving the robot’s own information, this component is needed. This component separates the storage function from the storage data structure, so that the storage method can be easily replaced. It supports Alibaba Cloud OSS, Huawei Cloud OBS, Amazon S3, json storage, etc., and provides easy-to-use APIs.</li>
      <li>Basic functions</li>
    </ul>

    <p>state-switch state machine</p>

    <ul>
      <li>7.20 - 7.26</li>
      <li>state-switch is a monitor/protector for managing asynchronous operations. In the original ts version, it can be easily implemented through the characteristics of Promise. In kotlin, other APIs are needed to achieve it. The idea is relatively clear, but it is a bit troublesome to find a suitable implementation method.</li>
      <li>Basic functions</li>
    </ul>

    <p>(Optional) Other API porting and testing</p>

    <ul>
      <li>7.27 - 8.7</li>
      <li>There are still many APIs in java-wechaty that have not been implemented, and the style of the APIs is also imitated from js. In the follow-up, these APIs need to be gradually implemented and their API style modified to be more suitable for languages ​​such as java and kotlin.</li>
      <li>Extended functions</li>
    </ul>

    <p>(Optional) Understand the underlying principles and add some new functions</p>

    <ul>
      <li>8.8-8.15</li>
      <li>This part is optional. Wechaty has some functions about miniprogram, red envelopes, etc. that have not been implemented. It is necessary to understand the bottom layer for subsequent expansion and gradually enhance the functions of wechaty.</li>
      <li>Extended functions</li>
    </ul>
  </li>
</ul>

<h2 id="project-progress">Project progress</h2>

<ul>
  <li>Work completed:</li>
</ul>

<ol>
  <li>Completed the development of memory-card and states-witch components. Since a part of it involves aws, and aws requires a visa or other bank card to register, this part was written but not tested, but I added an Alibaba Cloud interface for easy use.</li>
  <li>Completed the porting of most of the typescript version of the API. At present, almost all the ts version of the API should have been ported. Of course, there will be some bugs, and the ease of use of the API has not yet reached a good requirement.</li>
  <li>Conducted some existing API tests and fixed some small bugs. Of course, there are still some bugs that have not been fixed. I look forward to the next stage of development.</li>
</ol>

<ul>
  <li>Problems encountered and solutions:</li>
</ul>

<blockquote>
  <p>Quickly learn kotlin and understand the program architecture and logic</p>
</blockquote>

<p>Although it is <code class="language-plaintext highlighter-rouge">java</code> porting development, according to the mentor’s suggestion and the integrity of the entire project, I still choose to use kotlin for development, but I have not written kotlin before, I must immediately spend some time to learn kotlin, for advanced features and possible errors can only be encountered and then said. The entire program logic architecture is still relatively clear, although it still took some time to understand the workflow.</p>

<blockquote>
  <p>Asynchronous support in java and kotlin</p>
</blockquote>

<p>Due to async, await, and Promise, js has better support for asynchrony, so we need to carefully consider the asynchronous operations during the porting process. Of course, since kotlin is used, you can also try to use coroutines for writing later.</p>

<blockquote>
  <p>Consideration of coroutines</p>
</blockquote>

<p>When writing state-switch, it took some time to understand the ts version, mainly because the understanding of promise was not in place. After understanding the working principle, because there is no similar api in kotlin to solve it, it took some time to explore. Finally, at the suggestion of the mentor, and considering that it was written in kotlin, you can use coroutines. It is temporarily decided to use coroutines plus a blocking queue to achieve it. It seems to have achieved the effect at present.</p>

<p>This coroutine is quite interesting. Some parts of kotlin’s coroutines are still difficult to understand.</p>

<p>Experience: In the second half of the project, there was a problem on my side, which slowed down the progress. Fortunately, the difficulty of the task was not very great, and the mentor was also very good. In the end, whether I passed the assessment or not, this experience of participating in an open source project is worthy of recollection.</p>

<blockquote>
  <p>I think porting is quite interesting</p>
</blockquote>

<p>Different programming languages ​​have different ways of thinking. It is also a very interesting thing to quickly learn a language and practice it in a few days. Although the main consideration for the entire porting is the porting of functions, we must also pay attention to the ease of use of the API. There are still many differences in the API styles of ts and java.</p>

<blockquote>
  <p>Simple experience of github development process</p>
</blockquote>

<p>It is a very interesting experience to participate in the open source community with github. Although I have cooperated on github in the same group before, the process is still different. I also experienced the CI/CD process of github for the first time. I also experienced the meeting discussion of the open source community for the first time.</p>

<blockquote>
  <p>High-quality unit testing</p>
</blockquote>

<p>To be honest, I still don’t know how to write high-quality unit tests, and I need to continue to learn in the future.</p>

<ul>
  <li>Follow-up work arrangement:</li>
</ul>

<p>From the current progress, there are still some things to be completed</p>

<ol>
  <li>Write a springboot starter to facilitate the integration of springboot projects, which should include storage configuration and token configuration</li>
  <li>Split the memory-card component (it feels okay not to split it)</li>
  <li>Continue to improve api testing, I tried it some apis can not achieve the desired effect, such as the tags interface has problems</li>
  <li>Develop new functions, some of the existing apis are still not finished, and some functions have not been realized</li>
  <li>Update and improve documentation (it seems that the documentation has been updated recently, but there are still some things that have not been improved), it seems that there is no Chinese documentation</li>
</ol>

<h2 id="demo-day-video">Demo Day Video</h2>

<p>YouTube link: <a href="https://www.youtube.com/watch?v=ipRq3kT32wI">https://www.youtube.com/watch?v=ipRq3kT32wI</a></p>

<div style="
    position: relative;
    padding-bottom: 56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
">
  <iframe src="https://www.youtube.com/embed/ipRq3kT32wI" allowfullscreen="" webkitallowfullscreen="" frameborder="0" style="
      position: absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
    ">
</iframe>

</div>

<h2 id="contact-us">Contact Us</h2>

<ul>
  <li>Project link: <a href="https://github.com/cunkoulaocai/java-wechaty">https://github.com/cunkoulaocai/java-wechaty</a></li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>Contact: +86 15806082601</td>
          <td>e: <a href="mailto:1184016190@qq.com">1184016190@qq.com</a></td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<hr />

<blockquote>
  <p>This is a translated version of the original Chinese post. You can find the original post <a href="/2020/08/17/java-wechaty-transplant-midpoc/">here</a>.</p>
</blockquote>

			</article>

			<!-- Tags -->
			<div class="mb-4">
				<span class="taglist">
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#java">java</a>
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#soc">soc</a>
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#soc2020">soc2020</a>
				
				  <a class="sscroll btn btn-light btn-sm font-weight-bold" href="/tags.html#ecosystem">ecosystem</a>
				
				</span>
			</div>

            <!-- Mailchimp Subscribe Form -->
            
			<div class="border p-5 bg-lightblue">
				<div class="row justify-content-between">
					<div class="col-md-6 mb-2 mb-md-0">
						<h5 class="font-weight-bold">Join Newsletter</h5>
						 Get the latest news right in your inbox. We never spam!
					</div>
					<div class="col-md-6">
						<div class="row">
              <form action="https://zixia.us4.list-manage.com/subscribe/post?u=a8584b55dea5aa8bbc14bd1a0&amp;id=d9899f0d70" method="post" name="mc-embedded-subscribe-form" class="wj-contact-form validate w-100" target="_blank" novalidate>
                <input type="email" placeholder="Enter e-mail address" name="EMAIL" class="required email form-control w-100" id="mce-EMAIL" autocomplete="on" required>
                <input type="text"  placeholder="Name"                 name="FNAME" class="required form-control w-100"       id="mce-FNAME" autocomplete="on" required>
                <button type="submit" value="Subscribe" name="subscribe" class="heart btn btn-success btn-block w-100 mt-2">Subscribe</button>
              </form>
						</div>
					</div>
				</div>
			</div>
            


             <!-- Author Box -->
                
				<div class="row mt-5">
					<div class="col-md-2 align-self-center">
                        
                          <a href="/contributors/cunkoulaocai">
                            <img class="rounded-circle" src="/assets/contributors/cunkoulaocai/avatar.webp" alt="cunkoulaocai" width="90"/>
                          </a>
                        
					</div>
					<div class="col-md-10">
                        <h5 class="font-weight-bold">Written by cunkoulaocai </h5>
						Java Developer.
					</div>
				</div>
                

            <!-- Comments -->
            
                <!--  Don't edit anything here. Set your disqus id in _config.yml -->

<div id="comments" class="mt-5">
    <div id="disqus_thread">
    </div>
    <script type="text/javascript">
        var disqus_shortname = 'wechaty'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>
    Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
</div>
            

		</div>


	</div>
</div>


<!-- Aletbar Prev/Next -->
<div class="alertbar">
    <div class="container">
        <div class="row prevnextlinks small font-weight-bold">
          
            <div class="col-md-6 rightborder pl-0">
                <a class="text-dark" href="/2020/08/17/java-wechaty-bot/"> <img height="30px" class="mr-1" src="https://wechaty.js.org/assets/2020/smwsk-java-wechaty-bot/home.webp">  SpringBoot搭建wechaty智能聊天机器</a>
            </div>
          
          
            <div class="col-md-6 text-right pr-0">
                <a class="text-dark" href="/2020/08/17/java-wechaty-transplant-midpoc/"> Wechaty Java 移植组件开发  <img height="30px" class="ml-1" src="https://wechaty.js.org/assets/2020/08-java-wechaty-transplant-midpoc-en/java-wechaty-transplant-midpoc.webp"> </a>
            </div>
          
        </div>
    </div>
</div>

    </main>


    <!-- Scripts: popper, bootstrap, theme, lunr -->
    <script src="https://cdnjs.loli.net/ajax/libs/popper.js/1.14.6/umd/popper.min.js" crossorigin="anonymous"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" crossorigin="anonymous"></script>

    <script src="/assets/js/theme.js"></script>


    <!-- Footer -->
    <footer class="bg-white border-top p-3 text-muted small">
        <div class="container">
        <div class="row align-items-center justify-content-between">
            <div>
                <a href="#" class="text-muted navbar-brand mr-2 mb-0">
                  <strong>Wechaty</strong>
                </a>
                <span>Copyright © <script>document.write(new Date().getFullYear())</script></span>
                |
                <a
                  class="text-muted"
                  target="_blank"
                  href="/branding/"
                >
                  Branding
                </a>

                <!--  Github Repo Star Btn-->
                <a class="text-dark ml-1" target="_blank" href="https://github.com/wechaty"><i class="fab fa-github"></i> </a>

            </div>

            <div class="text-gray">
              Powered by
              <a
                class="text-gray font-weight-bold"
                target="_blank"
                href="https://www.wowthemes.net/mundana-jekyll-theme/"
              >
                Mundana Jekyll Theme
              </a>
              .
            </div>
        </div>
        </div>
    </footer>

    <!-- All this area goes before             <script>
                window.onload = function () {
                    var script = document.createElement('script');
                    var firstScript = document.getElementsByTagName('script')[0];
                    script.type = 'text/javascript';
                    script.async = true;
                    script.src = '/sw-register.js?v=' + Date.now();
                    firstScript.parentNode.insertBefore(script, firstScript);
                };
            </script>
            </body>
 closing tag -->


</body>

</html>
